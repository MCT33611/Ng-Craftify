import{a as s,b as h}from"./chunk-RXNGEOLM.js";import{a as n}from"./chunk-MKSDRPFF.js";import"./chunk-QFBWRPON.js";import"./chunk-RGNDWIHZ.js";import{a as l}from"./chunk-74CHJCYH.js";import{c as U}from"./chunk-PS6BIUUN.js";import{c as k,n as T,p as B,s as A,t as d,u as f}from"./chunk-WEBSOFYO.js";import{$ as m,Bb as x,D as c,V as R,Vc as $,Xa as a,_ as w,da as N,ea as S,f as g,ja as p,ka as u,pb as C}from"./chunk-JPTIIQB7.js";import{a as j,b as q,j as I}from"./chunk-YIRVVMYZ.js";var y=(()=>{let e=class e{constructor(r,t){this._http=r,this.token=t}getAllRequest(){let r=this.token.getUserId();return this._http.get(`${d.API_BASE_URL}/api/Booking?userId=${r}`).pipe(c(f))}getRequest(r){return this._http.get(`${d.API_BASE_URL}/api/Booking/${r}`).pipe(c(f))}rescheduleBooking(r){return this._http.put(`${d.API_BASE_URL}/api/Booking/${r.id}`,r).pipe(c(f))}};e.\u0275fac=function(t){return new(t||e)(N(k),N(U))},e.\u0275prov=w({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var D=(()=>{let e=class e{constructor(){this.requestService=S(y),this.alertService=S(l),this.data=[],this.columns=[{key:"status",type:s.Text,header:"Status"},{key:"date",type:s.Text,header:"Date"},{key:"locationName",type:s.Text,header:"Location"},{key:"workingTime",type:s.Text,header:"Working Time"},{key:"customerName",type:s.Text,header:"Customer"},{key:"providerName",type:s.Text,header:"Provider"},{key:"action",type:s.Action,header:"Reject"}],this.destroy$=new g}ngOnInit(){this.requestService.getAllRequest().pipe(R(this.destroy$)).subscribe({next:r=>{r&&Array.isArray(r.$values)?this.data=r.$values.map(t=>q(j({},t),{locationName:t.locationName?.split(",")[5]||"N/A",status:n[t.status]||"Unknown",customerName:t.customer?.firstName||"N/A",providerName:t.provider?.user?.firstName||"N/A",action:`/admin/request/reject/${t.id}`})):Array.isArray(r)?this.data=r.map(t=>q(j({},t),{locationName:t.locationName?.split(",")[5]||"N/A",status:n[t.status]||"Unknown",customerName:t.customer?.firstName||"N/A",providerName:t.provider?.user?.firstName||"N/A",action:`/admin/request/reject/${t.id}`})):(console.error("Unexpected response format:",r),this.alertService.error("Unexpected response format from server"))},error:r=>{this.alertService.error(r.message)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}};e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=p({type:e,selectors:[["app-request-list"]],decls:1,vars:2,consts:[[3,"data","columns"]],template:function(t,o){t&1&&x(0,"app-ui-datatable",0),t&2&&C("data",o.data)("columns",o.columns)},dependencies:[h]});let i=e;return i})();var _=(()=>{let e=class e{constructor(r,t,o,L){this._requestService=r,this._route=t,this._router=o,this._alertService=L}ngOnInit(){this.reject()}reject(){return I(this,null,function*(){if(yield this._alertService.confirm("Reject this Request","Are you sure you want to reject this request?")){let t=this._route.snapshot.paramMap.get("id");if(t)try{let o=yield this._requestService.getRequest(t).toPromise();if(o)o.status=n.Rejected,yield this._requestService.rescheduleBooking(o).toPromise(),this._alertService.success("Request rejected successfully"),this._router.navigate(["/admin/request"]);else throw new Error("Request details not found")}catch(o){this._alertService.error(o.error?.title||"An error occurred while rejecting the service request"),this._router.navigate(["/admin/request"])}else this._alertService.error("Booking ID is not found"),this._router.navigate(["/admin/request"])}else this._alertService.error("Confirmation denied"),this._router.navigate(["/admin/request"])})}};e.\u0275fac=function(t){return new(t||e)(a(y),a(T),a(B),a(l))},e.\u0275cmp=p({type:e,selectors:[["app-request-reject"]],decls:0,vars:0,template:function(t,o){},encapsulation:2});let i=e;return i})();var P=[{path:"",pathMatch:"full",redirectTo:"list"},{path:"list",component:D},{path:"reject/:id",component:_}],E=(()=>{let e=class e{};e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=u({type:e}),e.\u0275inj=m({imports:[A.forChild(P),A]});let i=e;return i})();var ye=(()=>{let e=class e{};e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=u({type:e}),e.\u0275inj=m({imports:[$,E,h]});let i=e;return i})();export{ye as RequestManagementModule};
