import{c as p,t as f}from"./chunk-WEBSOFYO.js";import{_ as c,ba as m,da as l,n as u}from"./chunk-JPTIIQB7.js";import{a as h,b as d}from"./chunk-YIRVVMYZ.js";var g=new m("JWT_OPTIONS"),E=(()=>{class n{constructor(t=null){this.tokenGetter=t&&t.tokenGetter||function(){}}urlBase64Decode(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:{e+="==";break}case 3:{e+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(e)}b64decode(t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="";if(t=String(t).replace(/=+$/,""),t.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let s=0,a,o,_=0;o=t.charAt(_++);~o&&(a=s%4?a*64+o:o,s++%4)?r+=String.fromCharCode(255&a>>(-2*s&6)):0)o=e.indexOf(o);return r}b64DecodeUnicode(t){return decodeURIComponent(Array.prototype.map.call(this.b64decode(t),e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(t=this.tokenGetter()){return t instanceof Promise?t.then(e=>this._decodeToken(e)):this._decodeToken(t)}_decodeToken(t){if(!t||t==="")return null;let e=t.split(".");if(e.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let r=this.urlBase64Decode(e[1]);if(!r)throw new Error("Cannot decode the token.");return JSON.parse(r)}getTokenExpirationDate(t=this.tokenGetter()){return t instanceof Promise?t.then(e=>this._getTokenExpirationDate(e)):this._getTokenExpirationDate(t)}_getTokenExpirationDate(t){let e;if(e=this.decodeToken(t),!e||!e.hasOwnProperty("exp"))return null;let r=new Date(0);return r.setUTCSeconds(e.exp),r}isTokenExpired(t=this.tokenGetter(),e){return t instanceof Promise?t.then(r=>this._isTokenExpired(r,e)):this._isTokenExpired(t,e)}_isTokenExpired(t,e){if(!t||t==="")return!0;let r=this.getTokenExpirationDate(t);return e=e||0,r===null?!1:!(r.valueOf()>new Date().valueOf()+e*1e3)}getAuthScheme(t,e){return typeof t=="function"?t(e):t}}return n.\u0275fac=function(t){return new(t||n)(l(g))},n.\u0275prov=c({token:n,factory:n.\u0275fac}),n})();var x=(()=>{let i=class i{constructor(e,r){this._jwtHelper=e,this._http=r,this._AUTH_TOKEN_KEY="auth_token",this._PASSWORD_RESET_TOKEN_KEY="password_reset_token",this._REFRESH_TOKEN_KEY="refresh_token",this._REMEMBER_ME_KEY="remember_me"}setToken(e){this.getRememberMe()?localStorage.setItem(this._AUTH_TOKEN_KEY,e):sessionStorage.setItem(this._AUTH_TOKEN_KEY,e)}getToken(){return this.getRememberMe()?localStorage.getItem(this._AUTH_TOKEN_KEY):sessionStorage.getItem(this._AUTH_TOKEN_KEY)}removeToken(){this.getRememberMe()?localStorage.removeItem(this._AUTH_TOKEN_KEY):sessionStorage.removeItem(this._AUTH_TOKEN_KEY)}setRememberMe(e){localStorage.setItem(this._REMEMBER_ME_KEY,e)}getRememberMe(){return localStorage.getItem(this._REMEMBER_ME_KEY)==="true"}clearRememberMe(){localStorage.removeItem(this._REMEMBER_ME_KEY)}setRefreshToken(e){let r=new Date;r.setDate(r.getDate()+30),document.cookie=`${this._REFRESH_TOKEN_KEY}=${e}; expires=${r.toUTCString()}; path=/; Secure; SameSite=Strict`}removeRefreshToken(){document.cookie=`${this._REFRESH_TOKEN_KEY}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; Secure; SameSite=Strict`}getRefreshToken(){let e=this._REFRESH_TOKEN_KEY+"=",s=decodeURIComponent(document.cookie).split(";");for(let a=0;a<s.length;a++){let o=s[a];for(;o.charAt(0)==" ";)o=o.substring(1);if(o.indexOf(e)==0)return o.substring(e.length,o.length)}return null}isTokenExpired(){let e=this.getToken();if(!e)return!0;let r=JSON.parse(atob(e.split(".")[1])).exp;return Math.floor(new Date().getTime()/1e3)>=r}getUserInfo(){let e=this.getToken();if(!e)return null;let r=this._jwtHelper.decodeToken(e);return d(h({},r),{role:r["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]})}getUserId(){let e=this.getUserInfo();return e?e.sub:null}getWorkerId(){let e=this.getUserInfo();return e?e.WorkerId:null}getUserEmail(){let e=this.getUserInfo();return e?e.email:null}getUserRole(){let e=this.getUserInfo();return e?e.role:null}setPasswordResetToken(e){sessionStorage.setItem(this._PASSWORD_RESET_TOKEN_KEY,e)}getPasswordResetToken(){return sessionStorage.getItem(this._PASSWORD_RESET_TOKEN_KEY)}removePasswordResetToken(){sessionStorage.removeItem(this._PASSWORD_RESET_TOKEN_KEY)}refreshToken(){let e=this.getRefreshToken(),r=this.getToken(),s=this.getUserEmail();return!e||!s?(console.log("No refresh token or email available"),u(()=>new Error("No refresh token or email available"))):this._http.post(`${f.API_BASE_URL}/api/Authentication/refresh`,{email:s,accessToken:r,refreshToken:e})}};i.\u0275fac=function(r){return new(r||i)(l(E),l(p))},i.\u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();export{g as a,E as b,x as c};
