import{a as p,b as g,e as wt,g as fs,i as xt,j as b}from"./chunk-YIRVVMYZ.js";function Ct(i){for(let t in i){let e=[...t].reduce((r,o)=>(o.toUpperCase()===o&&(o="-"+o.toLowerCase()),r+=o),"");e.startsWith("-")&&(e=e.replace("-","")),e.startsWith("lr-")||(e="lr-"+e),i[t].reg&&i[t].reg(e)}}var tl={};fs(tl,{ActivityBlock:()=>v,ActivityHeader:()=>ar,BaseComponent:()=>Ee,Block:()=>_,CameraSource:()=>Fo,CloudImageEditor:()=>lr,CloudImageEditorActivity:()=>sr,CloudImageEditorBlock:()=>$e,Config:()=>uo,ConfirmationDialog:()=>Do,Copyright:()=>ds,CropFrame:()=>qo,Data:()=>A,DropArea:()=>Hr,EditorCropButtonControl:()=>Ze,EditorFilterControl:()=>rr,EditorImageCropper:()=>Ko,EditorImageFader:()=>ir,EditorOperationControl:()=>Ke,EditorScroller:()=>Jo,EditorSlider:()=>Xo,EditorToolbar:()=>vt,ExternalSource:()=>as,FileItem:()=>qe,FilePreview:()=>Zr,FileUploaderInline:()=>ps,FileUploaderMinimal:()=>us,FileUploaderRegular:()=>hs,FormInput:()=>nr,Icon:()=>Ur,Img:()=>Yt,LineLoaderUi:()=>Qo,LrBtnUi:()=>Je,Modal:()=>Uo,PACKAGE_NAME:()=>at,PACKAGE_VERSION:()=>lt,PresenceToggle:()=>es,ProgressBar:()=>Vo,ProgressBarCommon:()=>No,Select:()=>ls,SimpleBtn:()=>Nr,SliderUi:()=>ts,SourceBtn:()=>jr,SourceList:()=>Jt,StartFrom:()=>go,Tabs:()=>Qe,UID:()=>Ae,UploadCtxProvider:()=>zo,UploadList:()=>Po,UploaderBlock:()=>k,UrlSource:()=>Ro,Video:()=>Yr,connectBlocksFrom:()=>ms,defineLocale:()=>Tr,registerBlocks:()=>Ct,toKebabCase:()=>He});var gs=Object.defineProperty,bs=(i,t,e)=>t in i?gs(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,dr=(i,t,e)=>(bs(i,typeof t!="symbol"?t+"":t,e),e);function vs(i){let t=e=>{var r;for(let o in e)((r=e[o])==null?void 0:r.constructor)===Object&&(e[o]=t(e[o]));return p({},e)};return t(i)}var A=class{constructor(i){i.constructor===Object?this.store=vs(i):(this._storeIsProxy=!0,this.store=i),this.callbackMap=Object.create(null)}static warn(i,t){console.warn(`Symbiote Data: cannot ${i}. Prop name: `+t)}read(i){return!this._storeIsProxy&&!this.store.hasOwnProperty(i)?(A.warn("read",i),null):this.store[i]}has(i){return this._storeIsProxy?this.store[i]!==void 0:this.store.hasOwnProperty(i)}add(i,t,e=!1){!e&&Object.keys(this.store).includes(i)||(this.store[i]=t,this.notify(i))}pub(i,t){if(!this._storeIsProxy&&!this.store.hasOwnProperty(i)){A.warn("publish",i);return}this.store[i]=t,this.notify(i)}multiPub(i){for(let t in i)this.pub(t,i[t])}notify(i){this.callbackMap[i]&&this.callbackMap[i].forEach(t=>{t(this.store[i])})}sub(i,t,e=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(i)?(A.warn("subscribe",i),null):(this.callbackMap[i]||(this.callbackMap[i]=new Set),this.callbackMap[i].add(t),e&&t(this.store[i]),{remove:()=>{this.callbackMap[i].delete(t),this.callbackMap[i].size||delete this.callbackMap[i]},callback:t})}static registerCtx(i,t=Symbol()){let e=A.globalStore.get(t);return e?console.warn('State: context UID "'+t+'" already in use'):(e=new A(i),A.globalStore.set(t,e)),e}static deleteCtx(i){A.globalStore.delete(i)}static getCtx(i,t=!0){return A.globalStore.get(i)||(t&&console.warn('State: wrong context UID - "'+i+'"'),null)}};A.globalStore=new Map;var C=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),ti="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",_s=ti.length-1,Ae=class{static generate(i="XXXXXXXXX-XXX"){let t="";for(let e=0;e<i.length;e++)t+=i[e]==="-"?i[e]:ti.charAt(Math.random()*_s);return t}};function ri(i,t,e){let r=!0,o,s=t.split(".");return s.forEach((n,a)=>{a<s.length-1?i=i[n]:o=n}),i?i[o]=e:r=!1,r}function ys(i){return i.split("-").map((t,e)=>t&&e?t[0].toUpperCase()+t.slice(1):t).join("").split("_").map((t,e)=>t&&e?t.toUpperCase():t).join("")}function ws(i,t){[...i.querySelectorAll(`[${C.REPEAT_ATTR}]`)].forEach(e=>{let r=e.getAttribute(C.REPEAT_ITEM_TAG_ATTR),o;if(r&&(o=window.customElements.get(r)),!o){o=class extends t.BaseComponent{constructor(){super(),r||(this.style.display="contents")}};let n=e.innerHTML;o.template=n,o.reg(r)}for(;e.firstChild;)e.firstChild.remove();let s=e.getAttribute(C.REPEAT_ATTR);t.sub(s,n=>{if(!n){for(;e.firstChild;)e.firstChild.remove();return}let a=[...e.children],l,c=d=>{d.forEach((u,f)=>{if(a[f])if(a[f].set$)setTimeout(()=>{a[f].set$(u)});else for(let m in u)a[f][m]=u[m];else{l||(l=new DocumentFragment);let m=new o;Object.assign(m.init$,u),l.appendChild(m)}}),l&&e.appendChild(l);let h=a.slice(d.length,a.length);for(let u of h)u.remove()};if(n.constructor===Array)c(n);else if(n.constructor===Object){let d=[];for(let h in n){let u=n[h];Object.defineProperty(u,"_KEY_",{value:h,enumerable:!0}),d.push(u)}c(d)}else console.warn("Symbiote repeat data type error:"),console.log(n)}),e.removeAttribute(C.REPEAT_ATTR),e.removeAttribute(C.REPEAT_ITEM_TAG_ATTR)})}var Qr="__default__";function xs(i,t){if(t.shadowRoot)return;let e=[...i.querySelectorAll("slot")];if(!e.length)return;let r={};e.forEach(o=>{let s=o.getAttribute("name")||Qr;r[s]={slot:o,fr:document.createDocumentFragment()}}),t.initChildren.forEach(o=>{var s;let n=Qr;o instanceof Element&&o.hasAttribute("slot")&&(n=o.getAttribute("slot"),o.removeAttribute("slot")),(s=r[n])==null||s.fr.appendChild(o)}),Object.values(r).forEach(o=>{if(o.fr.childNodes.length)o.slot.parentNode.replaceChild(o.fr,o.slot);else if(o.slot.childNodes.length){let s=document.createDocumentFragment();s.append(...o.slot.childNodes),o.slot.parentNode.replaceChild(s,o.slot)}else o.slot.remove()})}function Cs(i,t){[...i.querySelectorAll(`[${C.EL_REF_ATTR}]`)].forEach(e=>{let r=e.getAttribute(C.EL_REF_ATTR);t.ref[r]=e,e.removeAttribute(C.EL_REF_ATTR)})}function As(i,t){[...i.querySelectorAll(`[${C.BIND_ATTR}]`)].forEach(e=>{let o=e.getAttribute(C.BIND_ATTR).split(";");[...e.attributes].forEach(s=>{if(s.name.startsWith("-")&&s.value){let n=ys(s.name.replace("-",""));o.push(n+":"+s.value),e.removeAttribute(s.name)}}),o.forEach(s=>{if(!s)return;let n=s.split(":").map(d=>d.trim()),a=n[0],l;a.indexOf(C.ATTR_BIND_PRFX)===0&&(l=!0,a=a.replace(C.ATTR_BIND_PRFX,""));let c=n[1].split(",").map(d=>d.trim());for(let d of c){let h;d.startsWith("!!")?(h="double",d=d.replace("!!","")):d.startsWith("!")&&(h="single",d=d.replace("!","")),t.sub(d,u=>{h==="double"?u=!!u:h==="single"&&(u=!u),l?u?.constructor===Boolean?u?e.setAttribute(a,""):e.removeAttribute(a):e.setAttribute(a,u):ri(e,a,u)||(e[C.SET_LATER_KEY]||(e[C.SET_LATER_KEY]=Object.create(null)),e[C.SET_LATER_KEY][a]=u)})}}),e.removeAttribute(C.BIND_ATTR)})}var At="{{",tt="}}",Es="skip-text";function ks(i){let t,e=[],r=document.createTreeWalker(i,NodeFilter.SHOW_TEXT,{acceptNode:o=>{var s;return!((s=o.parentElement)!=null&&s.hasAttribute(Es))&&o.textContent.includes(At)&&o.textContent.includes(tt)&&1}});for(;t=r.nextNode();)e.push(t);return e}var Ts=function(i,t){ks(i).forEach(r=>{let o=[],s;for(;r.textContent.includes(tt);)r.textContent.startsWith(At)?(s=r.textContent.indexOf(tt)+tt.length,r.splitText(s),o.push(r)):(s=r.textContent.indexOf(At),r.splitText(s)),r=r.nextSibling;o.forEach(n=>{let a=n.textContent.replace(At,"").replace(tt,"");n.textContent="",t.sub(a,l=>{n.textContent=l})})})},Ss=[ws,xs,Cs,As,Ts],Et="'",Pe='"',Is=/\\([0-9a-fA-F]{1,6} ?)/g;function $s(i){return(i[0]===Pe||i[0]===Et)&&(i[i.length-1]===Pe||i[i.length-1]===Et)}function Os(i){return(i[0]===Pe||i[0]===Et)&&(i=i.slice(1)),(i[i.length-1]===Pe||i[i.length-1]===Et)&&(i=i.slice(0,-1)),i}function Ls(i){let t="",e="";for(var r=0;r<i.length;r++){let o=i[r+1];i[r]==="\\"&&o==='"'?(t+='\\"',r++):i[r]==='"'&&e!=="\\"?t+='\\"':t+=i[r],e=i[r]}return t}function Ms(i){let t=i;$s(i)&&(t=Os(t),t=t.replace(Is,(e,r)=>String.fromCodePoint(parseInt(r.trim(),16))),t=t.replaceAll(`\\
`,"\\n"),t=Ls(t),t=Pe+t+Pe);try{return JSON.parse(t)}catch{throw new Error(`Failed to parse CSS property value: ${t}. Original input: ${i}`)}}var ei=0,Ue=null,se=null,me=class extends HTMLElement{constructor(){super(),dr(this,"updateCssData",()=>{var i;this.dropCssDataCache(),(i=this.__boundCssProps)==null||i.forEach(t=>{let e=this.getCssData(this.__extractCssName(t),!0);e!==null&&this.$[t]!==e&&(this.$[t]=e)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return me}initCallback(){}__initCallback(){var i;this.__initialized||(this.__initialized=!0,(i=this.initCallback)==null||i.call(this))}render(i,t=this.renderShadow){let e;if((t||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let o=this.getAttribute(C.USE_TPL);if(o){let s=this.getRootNode(),n=s?.querySelector(o)||document.querySelector(o);n?i=n.content.cloneNode(!0):console.warn(`Symbiote template "${o}" is not found...`)}}if(this.processInnerHtml)for(let o of this.tplProcessors)o(this,this);if(i||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),i?.constructor===DocumentFragment)e=i;else if(i?.constructor===String){let o=document.createElement("template");o.innerHTML=i,e=o.content.cloneNode(!0)}else this.constructor.__tpl&&(e=this.constructor.__tpl.content.cloneNode(!0));for(let o of this.tplProcessors)o(e,this)}let r=()=>{e&&(t&&this.shadowRoot.appendChild(e)||this.appendChild(e)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){t=!0;let o=document.createElement("link");o.rel="stylesheet",o.href=this.constructor.__shadowStylesUrl,o.onload=r,this.shadowRoot.prepend(o)}else r()}addTemplateProcessor(i){this.tplProcessors.add(i)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=Ae.generate(),this.style.setProperty(C.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(C.CSS_CTX_PROP,!0)}get ctxName(){var i;let t=((i=this.getAttribute(C.CTX_NAME_ATTR))==null?void 0:i.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=t,t}get localCtx(){return this.__localCtx||(this.__localCtx=A.registerCtx({},this)),this.__localCtx}get nodeCtx(){return A.getCtx(this.ctxName,!1)||A.registerCtx({},this.ctxName)}static __parseProp(i,t){let e,r;if(i.startsWith(C.EXT_DATA_CTX_PRFX))e=t.nodeCtx,r=i.replace(C.EXT_DATA_CTX_PRFX,"");else if(i.includes(C.NAMED_DATA_CTX_SPLTR)){let o=i.split(C.NAMED_DATA_CTX_SPLTR);e=A.getCtx(o[0]),r=o[1]}else e=t.localCtx,r=i;return{ctx:e,name:r}}sub(i,t,e=!0){let r=s=>{this.isConnected&&t(s)},o=me.__parseProp(i,this);o.ctx.has(o.name)?this.allSubs.add(o.ctx.sub(o.name,r,e)):window.setTimeout(()=>{this.allSubs.add(o.ctx.sub(o.name,r,e))})}notify(i){let t=me.__parseProp(i,this);t.ctx.notify(t.name)}has(i){let t=me.__parseProp(i,this);return t.ctx.has(t.name)}add(i,t,e=!1){let r=me.__parseProp(i,this);r.ctx.add(r.name,t,e)}add$(i,t=!1){for(let e in i)this.add(e,i[e],t)}get $(){if(!this.__stateProxy){let i=Object.create(null);this.__stateProxy=new Proxy(i,{set:(t,e,r)=>{let o=me.__parseProp(e,this);return o.ctx.pub(o.name,r),!0},get:(t,e)=>{let r=me.__parseProp(e,this);return r.ctx.read(r.name)}})}return this.__stateProxy}set$(i,t=!1){for(let e in i){let r=i[e];t||![String,Number,Boolean].includes(r?.constructor)?this.$[e]=r:this.$[e]!==r&&(this.$[e]=r)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(C.CTX_OWNER_ATTR)&&this.getAttribute(C.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let i=this.constructor.__attrDesc;if(i)for(let t of Object.values(i))Object.keys(this.init$).includes(t)||(this.init$[t]="");for(let t in this.init$)if(t.startsWith(C.EXT_DATA_CTX_PRFX))this.nodeCtx.add(t.replace(C.EXT_DATA_CTX_PRFX,""),this.init$[t],this.__ctxOwner);else if(t.includes(C.NAMED_DATA_CTX_SPLTR)){let e=t.split(C.NAMED_DATA_CTX_SPLTR),r=e[0].trim(),o=e[1].trim();if(r&&o){let s=A.getCtx(r,!1);s||(s=A.registerCtx({},r)),s.add(o,this.init$[t])}}else this.localCtx.add(t,this.init$[t]);for(let t in this.cssInit$)this.bindCssData(t,this.cssInit$[t]);this.__dataCtxInitialized=!0}connectedCallback(){var i;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let t=(i=this.getAttribute(C.CTX_NAME_ATTR))==null?void 0:i.trim();if(t&&this.style.setProperty(C.CSS_CTX_PROP,`'${t}'`),this.__initDataCtx(),this[C.SET_LATER_KEY]){for(let e in this[C.SET_LATER_KEY])ri(this,e,this[C.SET_LATER_KEY][e]);delete this[C.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let e of Ss)this.addTemplateProcessor(e);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let e=this.getRootNode();if(!e)return;if(e?.querySelector(`link[${C.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let o=this.constructor.__rootStylesLink.cloneNode(!0);o.setAttribute(C.ROOT_STYLE_ATTR_NAME,this.constructor.is),o.onload=()=>{this.render()},e.nodeType===Node.DOCUMENT_NODE?e.head.appendChild(o):e.prepend(o)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let i of this.allSubs)i.remove(),this.allSubs.delete(i);for(let i of this.tplProcessors)this.tplProcessors.delete(i);se?.delete(this.updateCssData),se?.size||(Ue?.disconnect(),Ue=null,se=null)},100)))}static reg(i,t=!1){i||(ei++,i=`${C.AUTO_TAG_PRFX}-${ei}`),this.__tag=i;let e=window.customElements.get(i);if(e){!t&&e!==this&&console.warn([`Element with tag name "${i}" already registered.`,`You're trying to override it with another class "${this.name}".`,"This is most likely a mistake.","New element will not be registered."].join(`
`));return}window.customElements.define(i,t?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(i){this.observedAttributes=Object.keys(i),this.__attrDesc=i}attributeChangedCallback(i,t,e){var r;if(t===e)return;let o=(r=this.constructor.__attrDesc)==null?void 0:r[i];o?this.__dataCtxInitialized?this.$[o]=e:this.init$[o]=e:this[i]=e}getCssData(i,t=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(i)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let e=this.__computedStyle.getPropertyValue(i).trim();try{this.__cssDataCache[i]=Ms(e)}catch{!t&&console.warn(`CSS Data error: ${i}`),this.__cssDataCache[i]=null}}return this.__cssDataCache[i]}__extractCssName(i){return i.split("--").map((t,e)=>e===0?"":t).join("--")}__initStyleAttrObserver(){se||(se=new Set),se.add(this.updateCssData),Ue||(Ue=new MutationObserver(i=>{i[0].type==="attributes"&&se.forEach(t=>{t()})}),Ue.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(i,t=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(i);let e=this.getCssData(this.__extractCssName(i),!0);e===null&&(e=t),this.add(i,e),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(i,t,e){let r="__"+i;this[r]=this[i],Object.defineProperty(this,i,{set:o=>{this[r]=o,e?window.setTimeout(()=>{t?.(o)}):t?.(o)},get:()=>this[r]}),this[i]=this[r]}static set shadowStyles(i){let t=new Blob([i],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(t)}static set rootStyles(i){if(!this.__rootStylesLink){let t=new Blob([i],{type:"text/css"}),e=URL.createObjectURL(t),r=document.createElement("link");r.href=e,r.rel="stylesheet",this.__rootStylesLink=r}}},Ee=me;dr(Ee,"template");var cr=class{static _print(i){console.warn(i)}static setDefaultTitle(i){this.defaultTitle=i}static setRoutingMap(i){Object.assign(this.appMap,i);for(let t in this.appMap)!this.defaultRoute&&this.appMap[t].default===!0?this.defaultRoute=t:!this.errorRoute&&this.appMap[t].error===!0&&(this.errorRoute=t)}static set routingEventName(i){this.__routingEventName=i}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let i={route:null,options:{}};return window.location.search.split(this.separator).forEach(e=>{if(e.includes("?"))i.route=e.replace("?","");else if(e.includes("=")){let r=e.split("=");i.options[r[0]]=decodeURI(r[1])}else i.options[e]=!0}),i}static notify(){let i=this.readAddressBar(),t=this.appMap[i.route];if(t&&t.title&&(document.title=t.title),i.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!t&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!t&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!t){this._print(`Route "${i.route}" not found...`);return}let e=new CustomEvent(cr.routingEventName,{detail:{route:i.route,options:Object.assign(t||{},i.options)}});window.dispatchEvent(e)}static reflect(i,t={}){let e=this.appMap[i];if(!e){this._print("Wrong route: "+i);return}let r="?"+i;for(let s in t)t[s]===!0?r+=this.separator+s:r+=this.separator+s+`=${t[s]}`;let o=e.title||this.defaultTitle||"";window.history.pushState(null,o,r),document.title=o}static applyRoute(i,t={}){this.reflect(i,t),this.notify()}static setSeparator(i){this._separator=i}static get separator(){return this._separator||"&"}static createRouterData(i,t){this.setRoutingMap(t);let e=A.registerCtx({route:null,options:null,title:null},i);return window.addEventListener(this.routingEventName,r=>{var o;e.multiPub({route:r.detail.route,options:r.detail.options,title:((o=r.detail.options)==null?void 0:o.title)||this.defaultTitle||""})}),cr.notify(),this.initPopstateListener(),e}static initPopstateListener(){this.__onPopstate||(this.__onPopstate=()=>{this.notify()},window.addEventListener("popstate",this.__onPopstate))}static removePopstateListener(){window.removeEventListener("popstate",this.__onPopstate),this.__onPopstate=null}};cr.appMap=Object.create(null);function hr(i,t){for(let e in t)e.includes("-")?i.style.setProperty(e,t[e]):i.style[e]=t[e]}function Us(i,t){for(let e in t)t[e].constructor===Boolean?t[e]?i.setAttribute(e,""):i.removeAttribute(e):i.setAttribute(e,t[e])}function rt(i={tag:"div"}){let t=document.createElement(i.tag);if(i.attributes&&Us(t,i.attributes),i.styles&&hr(t,i.styles),i.properties)for(let e in i.properties)t[e]=i.properties[e];return i.processors&&i.processors.forEach(e=>{e(t)}),i.children&&i.children.forEach(e=>{let r=rt(e);t.appendChild(r)}),t}var ii="idb-store-ready",Ps="symbiote-db",Rs="symbiote-idb-update_",Fs=class{_notifyWhenReady(i=null){window.dispatchEvent(new CustomEvent(ii,{detail:{dbName:this.name,storeName:this.storeName,event:i}}))}get _updEventName(){return Rs+this.name}_getUpdateEvent(i){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:i}})}_notifySubscribers(i){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,i),window.dispatchEvent(this._getUpdateEvent(i))}constructor(i,t){this.name=i,this.storeName=t,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=e=>{this.db=e.target.result,this.objStore=this.db.createObjectStore(t,{keyPath:"_key"}),this.objStore.transaction.oncomplete=r=>{this._notifyWhenReady(r)}},this.request.onsuccess=e=>{this.db=e.target.result,this._notifyWhenReady(e)},this.request.onerror=e=>{console.error(e)},this._subscriptionsMap={},this._updateHandler=e=>{e.key===this.name&&this._subscriptionsMap[e.newValue]&&this._subscriptionsMap[e.newValue].forEach(o=>b(this,null,function*(){o(yield this.read(e.newValue))}))},this._localUpdateHandler=e=>{this._updateHandler(e.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(i){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(i);return new Promise((r,o)=>{e.onsuccess=s=>{var n;(n=s.target.result)!=null&&n._value?r(s.target.result._value):(r(null),console.warn(`IDB: cannot read "${i}"`))},e.onerror=s=>{o(s)}})}write(i,t,e=!1){let r={_key:i,_value:t},s=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(r);return new Promise((n,a)=>{s.onsuccess=l=>{e||this._notifySubscribers(i),n(l.target.result)},s.onerror=l=>{a(l)}})}delete(i,t=!1){let r=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(i);return new Promise((o,s)=>{r.onsuccess=n=>{t||this._notifySubscribers(i),o(n)},r.onerror=n=>{s(n)}})}getAll(){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((e,r)=>{t.onsuccess=o=>{let s=o.target.result;e(s.map(n=>n._value))},t.onerror=o=>{r(o)}})}subscribe(i,t){this._subscriptionsMap[i]||(this._subscriptionsMap[i]=new Set);let e=this._subscriptionsMap[i];return e.add(t),{remove:()=>{e.delete(t),e.size||delete this._subscriptionsMap[i]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,oi.clear(this.name)}},oi=class{static get readyEventName(){return ii}static open(i=Ps,t="store"){let e=i+"/"+t;return this._reg[e]||(this._reg[e]=new Fs(i,t)),this._reg[e]}static clear(i){window.indexedDB.deleteDatabase(i);for(let t in this._reg)t.split("/")[0]===i&&delete this._reg[t]}};dr(oi,"_reg",Object.create(null));var $=Object.freeze({FILE_ADDED:"file-added",FILE_REMOVED:"file-removed",FILE_UPLOAD_START:"file-upload-start",FILE_UPLOAD_PROGRESS:"file-upload-progress",FILE_UPLOAD_SUCCESS:"file-upload-success",FILE_UPLOAD_FAILED:"file-upload-failed",FILE_URL_CHANGED:"file-url-changed",MODAL_OPEN:"modal-open",MODAL_CLOSE:"modal-close",DONE_CLICK:"done-click",UPLOAD_CLICK:"upload-click",ACTIVITY_CHANGE:"activity-change",COMMON_UPLOAD_START:"common-upload-start",COMMON_UPLOAD_PROGRESS:"common-upload-progress",COMMON_UPLOAD_SUCCESS:"common-upload-success",COMMON_UPLOAD_FAILED:"common-upload-failed",CHANGE:"change",GROUP_CREATED:"group-created"}),kt=class{_timeoutStore=new Map;_targets=new Set;_debugPrint=null;constructor(t){this._debugPrint=t}bindTarget(t){this._targets.add(t)}unbindTarget(t){this._targets.delete(t)}_dispatch(t,e){for(let r of this._targets)r.dispatchEvent(new CustomEvent(t,{detail:e}));this._debugPrint?.(()=>{let r=e&&typeof e=="object"?p({},e):e;return[`event "${t}"`,r]})}emit(t,e,{debounce:r}={}){if(typeof r!="number"&&!r){this._dispatch(t,typeof e=="function"?e():e);return}this._timeoutStore.has(t)&&window.clearTimeout(this._timeoutStore.get(t));let o=typeof r=="number"?r:20,s=window.setTimeout(()=>{this._dispatch(t,typeof e=="function"?e():e),this._timeoutStore.delete(t)},o);this._timeoutStore.set(t,s)}};function M(i,t){let e,r=(...o)=>{clearTimeout(e),e=setTimeout(()=>i(...o),t)};return r.cancel=()=>{clearTimeout(e)},r}var si="--uploadcare-blocks-window-height",it=class{static clientsRegistry=new Set;static flush=M(()=>{document.documentElement.style.setProperty(si,`${window.innerHeight}px`)},100);static registerClient(t){this.clientsRegistry.size===0&&this.attachTracker(),this.clientsRegistry.add(t)}static unregisterClient(t){this.clientsRegistry.delete(t),this.clientsRegistry.size===0&&this.detachTracker()}static attachTracker(){window.addEventListener("resize",this.flush,{passive:!0,capture:!0}),this.flush()}static detachTracker(){window.removeEventListener("resize",this.flush,{capture:!0}),document.documentElement.style.removeProperty(si)}};var ni=i=>{let t=new Intl.Locale(i),e="ltr";return typeof t.getTextInfo=="function"&&t.getTextInfo().direction?e=t.getTextInfo().direction:"textInfo"in t&&t.textInfo?.direction&&(e=t.textInfo.direction),e};var Tt=(i,t)=>new Intl.PluralRules(i).select(t);var zs=i=>i,ur="{{",li="}}",ai="plural:";function ot(i,t,e={}){let{openToken:r=ur,closeToken:o=li,transform:s=zs}=e;for(let n in t){let a=t[n]?.toString();i=i.replaceAll(r+n+o,typeof a=="string"?s(a):a)}return i}function ci(i){let t=[],e=i.indexOf(ur);for(;e!==-1;){let r=i.indexOf(li,e),o=i.substring(e+2,r);if(o.startsWith(ai)){let s=i.substring(e+2,r).replace(ai,""),n=s.substring(0,s.indexOf("(")),a=s.substring(s.indexOf("(")+1,s.indexOf(")"));t.push({variable:o,pluralKey:n,countVariable:a})}e=i.indexOf(ur,r)}return t}var di=({element:i,attribute:t,onSuccess:e,onTimeout:r,timeout:o=300})=>{let s=i.getAttribute(t);if(s!==null){e(s);return}let n=new MutationObserver(c=>{let d=c[c.length-1];l(d)});n.observe(i,{attributes:!0,attributeFilter:[t]});let a=setTimeout(()=>{n.disconnect(),r()},o),l=c=>{let d=i.getAttribute(t);c.type==="attributes"&&c.attributeName===t&&d!==null&&(clearTimeout(a),n.disconnect(),e(d))}};function hi(i){return Object.prototype.toString.call(i)==="[object Object]"}var Ds=/\W|_/g;function Ns(i){return i.split(Ds).map((t,e)=>t.charAt(0)[e>0?"toUpperCase":"toLowerCase"]()+t.slice(1)).join("")}function ui(i,{ignoreKeys:t}={ignoreKeys:[]}){return Array.isArray(i)?i.map(e=>le(e,{ignoreKeys:t})):i}function le(i,{ignoreKeys:t}={ignoreKeys:[]}){if(Array.isArray(i))return ui(i,{ignoreKeys:t});if(!hi(i))return i;let e={};for(let r of Object.keys(i)){let o=i[r];if(t.includes(r)){e[r]=o;continue}hi(o)?o=le(o,{ignoreKeys:t}):Array.isArray(o)&&(o=ui(o,{ignoreKeys:t})),e[Ns(r)]=o}return e}var Vs=i=>new Promise(t=>setTimeout(t,i));function vr({libraryName:i,libraryVersion:t,userAgent:e,publicKey:r="",integration:o=""}){let s="JavaScript";if(typeof e=="string")return e;if(typeof e=="function")return e({publicKey:r,libraryName:i,libraryVersion:t,languageName:s,integration:o});let n=[i,t,r].filter(Boolean).join("/"),a=[s,o].filter(Boolean).join("; ");return`${n} (${a})`}var Bs={factor:2,time:100};function Hs(i,t=Bs){let e=0;function r(o){let s=Math.round(t.time*t.factor**e);return o({attempt:e,retry:a=>Vs(a??s).then(()=>(e+=1,r(o)))})}return r(i)}var st=class extends Error{},Re=class i extends st{originalProgressEvent;constructor(t){super(),this.name="NetworkError",this.message="Network error",Object.setPrototypeOf(this,i.prototype),this.originalProgressEvent=t}},It=(i,t)=>{i&&(i.aborted?Promise.resolve().then(t):i.addEventListener("abort",()=>t(),{once:!0}))},fe=class i extends st{isCancel=!0;constructor(t="Request canceled"){super(t),this.name="CancelError",Object.setPrototypeOf(this,i.prototype)}},js=500,mi=({check:i,interval:t=js,timeout:e,signal:r})=>new Promise((o,s)=>{let n,a;It(r,()=>{n&&clearTimeout(n),s(new fe("Poll cancelled"))}),e&&(a=setTimeout(()=>{n&&clearTimeout(n),s(new fe("Timed out"))},e));let l=()=>{try{Promise.resolve(i(r)).then(c=>{c?(a&&clearTimeout(a),o(c)):n=setTimeout(l,t)}).catch(c=>{a&&clearTimeout(a),s(c)})}catch(c){a&&clearTimeout(a),s(c)}};n=setTimeout(l,0)}),I={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},$t="application/octet-stream",fi="original",ge=({method:i,url:t,data:e,headers:r={},signal:o,onProgress:s})=>new Promise((n,a)=>{let l=new XMLHttpRequest,c=i?.toUpperCase()||"GET",d=!1;l.open(c,t,!0),r&&Object.entries(r).forEach(h=>{let[u,f]=h;typeof f<"u"&&!Array.isArray(f)&&l.setRequestHeader(u,f)}),l.responseType="text",It(o,()=>{d=!0,l.abort(),a(new fe)}),l.onload=()=>{if(l.status!=200)a(new Error(`Error ${l.status}: ${l.statusText}`));else{let h={method:c,url:t,data:e,headers:r||void 0,signal:o,onProgress:s},u=l.getAllResponseHeaders().trim().split(/[\r\n]+/),f={};u.forEach(function(S){let E=S.split(": "),w=E.shift(),T=E.join(": ");w&&typeof w<"u"&&(f[w]=T)});let m=l.response,y=l.status;n({request:h,data:m,headers:f,status:y})}},l.onerror=h=>{d||a(new Re(h))},s&&typeof s=="function"&&(l.upload.onprogress=h=>{h.lengthComputable?s({isComputable:!0,value:h.loaded/h.total}):s({isComputable:!1})}),e?l.send(e):l.send()});function Gs(i,...t){return i}var Ws=({name:i})=>i?[i]:[],qs=Gs,Xs=()=>new FormData,gi=i=>!1,Ot=i=>typeof Blob<"u"&&i instanceof Blob,Lt=i=>typeof File<"u"&&i instanceof File,Mt=i=>!!i&&typeof i=="object"&&!Array.isArray(i)&&"uri"in i&&typeof i.uri=="string",Fe=i=>Ot(i)||Lt(i)||gi()||Mt(i),Zs=i=>typeof i=="string"||typeof i=="number"||typeof i>"u",Ks=i=>!!i&&typeof i=="object"&&!Array.isArray(i),Ys=i=>!!i&&typeof i=="object"&&"data"in i&&Fe(i.data);function bi(i,t,e){if(Array.isArray(e))for(let r of e)bi(i,`${t}[]`,r);else if(Ys(e)){let{name:r,contentType:o}=e,s=qs(e.data,r,o??$t),n=Ws({name:r,contentType:o});i.push([t,s,...n])}else if(Ks(e))for(let[r,o]of Object.entries(e))typeof o<"u"&&i.push([`${t}[${r}]`,String(o)]);else Zs(e)&&e&&i.push([t,e.toString()])}function Js(i){let t=[];for(let[e,r]of Object.entries(i))bi(t,e,r);return t}function Ut(i){let t=Xs(),e=Js(i);for(let r of e){let[o,s,...n]=r;t.append(o,s,...n)}return t}var D=class i extends st{code;request;response;headers;constructor(t,e,r,o,s){super(),this.name="UploadError",this.message=t,this.code=e,this.request=r,this.response=o,this.headers=s,Object.setPrototypeOf(this,i.prototype)}},Qs=i=>{let t=new URLSearchParams;for(let[e,r]of Object.entries(i))r&&typeof r=="object"&&!Array.isArray(r)?Object.entries(r).filter(o=>o[1]??!1).forEach(o=>t.set(`${e}[${o[0]}]`,String(o[1]))):Array.isArray(r)?r.forEach(o=>{t.append(`${e}[]`,o)}):typeof r=="string"&&r?t.set(e,r):typeof r=="number"&&t.set(e,r.toString());return t.toString()},ne=(i,t,e)=>{let r=new URL(i);return r.pathname=(r.pathname+t).replace("//","/"),e&&(r.search=Qs(e)),r.toString()},en="6.14.1",tn="UploadcareUploadClient",rn=en;function ke(i){return vr(p({libraryName:tn,libraryVersion:rn},i))}var on="RequestThrottledError",pi=15e3,sn=1e3;function nn(i){let{headers:t}=i||{};if(!t||typeof t["retry-after"]!="string")return pi;let e=parseInt(t["retry-after"],10);return Number.isFinite(e)?e*1e3:pi}function be(i,t){let{retryThrottledRequestMaxTimes:e,retryNetworkErrorMaxTimes:r}=t;return Hs(({attempt:o,retry:s})=>i().catch(n=>{if("response"in n&&n?.code===on&&o<e)return s(nn(n));if(n instanceof Re&&o<r)return s((o+1)*sn);throw n}))}var vi=i=>{let t="";return(Ot(i)||Lt(i)||Mt(i))&&(t=i.type),t||$t},_i=i=>{let t="";return Lt(i)&&i.name?t=i.name:Ot(i)||gi()?t="":Mt(i)&&i.name&&(t=i.name),t||fi};function _r(i){return typeof i>"u"||i==="auto"?"auto":i?"1":"0"}function an(i,{publicKey:t,fileName:e,contentType:r,baseURL:o=I.baseURL,secureSignature:s,secureExpire:n,store:a,signal:l,onProgress:c,source:d="local",integration:h,userAgent:u,retryThrottledRequestMaxTimes:f=I.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=I.retryNetworkErrorMaxTimes,metadata:y}){return be(()=>ge({method:"POST",url:ne(o,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":ke({publicKey:t,integration:h,userAgent:u})},data:Ut({file:{data:i,name:e||_i(i),contentType:r||vi(i)},UPLOADCARE_PUB_KEY:t,UPLOADCARE_STORE:_r(a),signature:s,expire:n,source:d,metadata:y}),signal:l,onProgress:c}).then(({data:S,headers:E,request:w})=>{let T=le(JSON.parse(S));if("error"in T)throw new D(T.error.content,T.error.errorCode,w,T,E);return T}),{retryNetworkErrorMaxTimes:m,retryThrottledRequestMaxTimes:f})}var yi=function(i){return i.Token="token",i.FileInfo="file_info",i}(yi||{});function ln(i,{publicKey:t,baseURL:e=I.baseURL,store:r,fileName:o,checkForUrlDuplicates:s,saveUrlForRecurrentUploads:n,secureSignature:a,secureExpire:l,source:c="url",signal:d,integration:h,userAgent:u,retryThrottledRequestMaxTimes:f=I.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=I.retryNetworkErrorMaxTimes,metadata:y}){return be(()=>ge({method:"POST",headers:{"X-UC-User-Agent":ke({publicKey:t,integration:h,userAgent:u})},url:ne(e,"/from_url/",{jsonerrors:1,pub_key:t,source_url:i,store:_r(r),filename:o,check_URL_duplicates:s?1:void 0,save_URL_duplicates:n?1:void 0,signature:a,expire:l,source:c,metadata:y}),signal:d}).then(({data:S,headers:E,request:w})=>{let T=le(JSON.parse(S));if("error"in T)throw new D(T.error.content,T.error.errorCode,w,T,E);return T}),{retryNetworkErrorMaxTimes:m,retryThrottledRequestMaxTimes:f})}var W=function(i){return i.Unknown="unknown",i.Waiting="waiting",i.Progress="progress",i.Error="error",i.Success="success",i}(W||{}),cn=i=>"status"in i&&i.status===W.Error;function dn(i,{publicKey:t,baseURL:e=I.baseURL,signal:r,integration:o,userAgent:s,retryThrottledRequestMaxTimes:n=I.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=I.retryNetworkErrorMaxTimes}={}){return be(()=>ge({method:"GET",headers:t?{"X-UC-User-Agent":ke({publicKey:t,integration:o,userAgent:s})}:void 0,url:ne(e,"/from_url/status/",{jsonerrors:1,token:i}),signal:r}).then(({data:l,headers:c,request:d})=>{let h=le(JSON.parse(l));if("error"in h&&!cn(h))throw new D(h.error.content,h.error.errorCode,d,h,c);return h}),{retryNetworkErrorMaxTimes:a,retryThrottledRequestMaxTimes:n})}function hn(i,{publicKey:t,baseURL:e=I.baseURL,jsonpCallback:r,secureSignature:o,secureExpire:s,signal:n,source:a,integration:l,userAgent:c,retryThrottledRequestMaxTimes:d=I.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:h=I.retryNetworkErrorMaxTimes}){return be(()=>ge({method:"POST",headers:{"X-UC-User-Agent":ke({publicKey:t,integration:l,userAgent:c})},url:ne(e,"/group/",{jsonerrors:1}),data:Ut({files:i,callback:r,pub_key:t,signature:o,expire:s,source:a}),signal:n}).then(({data:u,headers:f,request:m})=>{let y=le(JSON.parse(u));if("error"in y)throw new D(y.error.content,y.error.errorCode,m,y,f);return y}),{retryNetworkErrorMaxTimes:h,retryThrottledRequestMaxTimes:d})}function wi(i,{publicKey:t,baseURL:e=I.baseURL,signal:r,source:o,integration:s,userAgent:n,retryThrottledRequestMaxTimes:a=I.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=I.retryNetworkErrorMaxTimes}){return be(()=>ge({method:"GET",headers:{"X-UC-User-Agent":ke({publicKey:t,integration:s,userAgent:n})},url:ne(e,"/info/",{jsonerrors:1,pub_key:t,file_id:i,source:o}),signal:r}).then(({data:c,headers:d,request:h})=>{let u=le(JSON.parse(c));if("error"in u)throw new D(u.error.content,u.error.errorCode,h,u,d);return u}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function un(i,{publicKey:t,contentType:e,fileName:r,multipartChunkSize:o=I.multipartChunkSize,baseURL:s="",secureSignature:n,secureExpire:a,store:l,signal:c,source:d="local",integration:h,userAgent:u,retryThrottledRequestMaxTimes:f=I.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=I.retryNetworkErrorMaxTimes,metadata:y}){return be(()=>ge({method:"POST",url:ne(s,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":ke({publicKey:t,integration:h,userAgent:u})},data:Ut({filename:r||fi,size:i,content_type:e||$t,part_size:o,UPLOADCARE_STORE:_r(l),UPLOADCARE_PUB_KEY:t,signature:n,expire:a,source:d,metadata:y}),signal:c}).then(({data:S,headers:E,request:w})=>{let T=le(JSON.parse(S));if("error"in T)throw new D(T.error.content,T.error.errorCode,w,T,E);return T.parts=Object.keys(T.parts).map(Y=>T.parts[Number(Y)]),T}),{retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m})}function pn(i,t,{contentType:e,signal:r,onProgress:o,retryThrottledRequestMaxTimes:s=I.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:n=I.retryNetworkErrorMaxTimes}){return be(()=>ge({method:"PUT",url:t,data:i,onProgress:o,signal:r,headers:{"Content-Type":e||$t}}).then(a=>(o&&o({isComputable:!0,value:1}),a)).then(({status:a})=>({code:a})),{retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:n})}function mn(i,{publicKey:t,baseURL:e=I.baseURL,source:r="local",signal:o,integration:s,userAgent:n,retryThrottledRequestMaxTimes:a=I.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=I.retryNetworkErrorMaxTimes}){return be(()=>ge({method:"POST",url:ne(e,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":ke({publicKey:t,integration:s,userAgent:n})},data:Ut({uuid:i,UPLOADCARE_PUB_KEY:t,source:r}),signal:o}).then(({data:c,headers:d,request:h})=>{let u=le(JSON.parse(c));if("error"in u)throw new D(u.error.content,u.error.errorCode,h,u,d);return u}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function yr(i,{publicKey:t,baseURL:e,source:r,integration:o,userAgent:s,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:a,signal:l,onProgress:c}){return mi({check:d=>wi(i,{publicKey:t,baseURL:e,signal:d,source:r,integration:o,userAgent:s,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:a}).then(h=>h.isReady?h:(c&&c({isComputable:!0,value:1}),!1)),signal:l})}function fn(i){return"defaultEffects"in i}var ae=class{uuid;name=null;size=null;isStored=null;isImage=null;mimeType=null;cdnUrl=null;s3Url=null;originalFilename=null;imageInfo=null;videoInfo=null;contentInfo=null;metadata=null;s3Bucket=null;defaultEffects=null;constructor(t,{baseCDN:e=I.baseCDN,fileName:r}={}){let{uuid:o,s3Bucket:s}=t,n=ne(e,`${o}/`),a=s?ne(`https://${s}.s3.amazonaws.com/`,`${o}/${t.filename}`):null;this.uuid=o,this.name=r||t.filename,this.size=t.size,this.isStored=t.isStored,this.isImage=t.isImage,this.mimeType=t.mimeType,this.cdnUrl=n,this.originalFilename=t.originalFilename,this.imageInfo=t.imageInfo,this.videoInfo=t.videoInfo,this.contentInfo=t.contentInfo,this.metadata=t.metadata||null,this.s3Bucket=s||null,this.s3Url=a,fn(t)&&(this.defaultEffects=t.defaultEffects)}},gn=(i,{publicKey:t,fileName:e,baseURL:r,secureSignature:o,secureExpire:s,store:n,contentType:a,signal:l,onProgress:c,source:d,integration:h,userAgent:u,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,baseCDN:y,metadata:S})=>an(i,{publicKey:t,fileName:e,contentType:a,baseURL:r,secureSignature:o,secureExpire:s,store:n,signal:l,onProgress:c,source:d,integration:h,userAgent:u,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,metadata:S}).then(({file:E})=>yr(E,{publicKey:t,baseURL:r,source:d,integration:h,userAgent:u,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,onProgress:c,signal:l})).then(E=>new ae(E,{baseCDN:y})),bn=(i,{publicKey:t,fileName:e,baseURL:r,signal:o,onProgress:s,source:n,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:d,baseCDN:h})=>wi(i,{publicKey:t,baseURL:r,signal:o,source:n,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:d}).then(u=>new ae(u,{baseCDN:h,fileName:e})).then(u=>(s&&s({isComputable:!0,value:1}),u)),vn=(i,{signal:t}={})=>{let e=null,r=null,o=i.map(()=>new AbortController),s=n=>()=>{r=n,o.forEach((a,l)=>l!==n&&a.abort())};return It(t,()=>{o.forEach(n=>n.abort())}),Promise.all(i.map((n,a)=>{let l=s(a);return Promise.resolve().then(()=>n({stopRace:l,signal:o[a].signal})).then(c=>(l(),c)).catch(c=>(e=c,null))})).then(n=>{if(r===null)throw e;return n[r]})},_n=window.WebSocket,fr=class{events=Object.create({});emit(t,e){this.events[t]?.forEach(r=>r(e))}on(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}off(t,e){e?this.events[t]=this.events[t].filter(r=>r!==e):this.events[t]=[]}},yn=(i,t)=>p(i==="success"?{status:W.Success}:i==="progress"?{status:W.Progress}:{status:W.Error},t),gr=class{key;disconnectTime;ws=void 0;queue=[];isConnected=!1;subscribers=0;emmitter=new fr;disconnectTimeoutId=null;constructor(t,e=3e4){this.key=t,this.disconnectTime=e}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){let t=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new _n(t),this.ws.addEventListener("error",e=>{this.emmitter.emit("error",new Error(e.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(e=>this.send(e.event,e.data)),this.queue=[]}),this.ws.addEventListener("message",e=>{let r=JSON.parse(e.data.toString());switch(r.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(r.channel,yn(r.event,JSON.parse(r.data)))}})}}disconnect(){let t=()=>{this.ws?.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{t()},this.disconnectTime):t()}send(t,e){let r=JSON.stringify({event:t,data:e});this.ws?.send(r)}subscribe(t,e){this.subscribers+=1,this.connect();let r=`task-status-${t}`,o={event:"pusher:subscribe",data:{channel:r}};this.emmitter.on(r,e),this.isConnected?this.send(o.event,o.data):this.queue.push(o)}unsubscribe(t){this.subscribers-=1;let e=`task-status-${t}`,r={event:"pusher:unsubscribe",data:{channel:e}};this.emmitter.off(e),this.isConnected?this.send(r.event,r.data):this.queue=this.queue.filter(o=>o.data.channel!==e),this.subscribers===0&&this.disconnect()}onError(t){return this.emmitter.on("error",t),()=>this.emmitter.off("error",t)}},pr=null,wr=i=>{if(!pr){let t=typeof window>"u"?0:3e4;pr=new gr(i,t)}return pr},wn=i=>{wr(i).connect()};function xn({token:i,publicKey:t,baseURL:e,integration:r,userAgent:o,retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:n,onProgress:a,signal:l}){return mi({check:c=>dn(i,{publicKey:t,baseURL:e,integration:r,userAgent:o,retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:n,signal:c}).then(d=>{switch(d.status){case W.Error:return new D(d.error,d.errorCode);case W.Waiting:return!1;case W.Unknown:return new D(`Token "${i}" was not found.`);case W.Progress:return a&&(d.total==="unknown"?a({isComputable:!1}):a({isComputable:!0,value:d.done/d.total})),!1;case W.Success:return a&&a({isComputable:!0,value:d.done/d.total}),d;default:throw new Error("Unknown status")}}),signal:l})}var Cn=({token:i,pusherKey:t,signal:e,onProgress:r})=>new Promise((o,s)=>{let n=wr(t),a=n.onError(s),l=()=>{a(),n.unsubscribe(i)};It(e,()=>{l(),s(new fe("pusher cancelled"))}),n.subscribe(i,c=>{switch(c.status){case W.Progress:{r&&(c.total==="unknown"?r({isComputable:!1}):r({isComputable:!0,value:c.done/c.total}));break}case W.Success:{l(),r&&r({isComputable:!0,value:c.done/c.total}),o(c);break}case W.Error:l(),s(new D(c.msg,c.error_code))}})}),An=(i,{publicKey:t,fileName:e,baseURL:r,baseCDN:o,checkForUrlDuplicates:s,saveUrlForRecurrentUploads:n,secureSignature:a,secureExpire:l,store:c,signal:d,onProgress:h,source:u,integration:f,userAgent:m,retryThrottledRequestMaxTimes:y,pusherKey:S=I.pusherKey,metadata:E})=>Promise.resolve(wn(S)).then(()=>ln(i,{publicKey:t,fileName:e,baseURL:r,checkForUrlDuplicates:s,saveUrlForRecurrentUploads:n,secureSignature:a,secureExpire:l,store:c,signal:d,source:u,integration:f,userAgent:m,retryThrottledRequestMaxTimes:y,metadata:E})).catch(w=>(wr(S)?.disconnect(),Promise.reject(w))).then(w=>w.type===yi.FileInfo?w:vn([({signal:T})=>xn({token:w.token,publicKey:t,baseURL:r,integration:f,userAgent:m,retryThrottledRequestMaxTimes:y,onProgress:h,signal:T}),({signal:T})=>Cn({token:w.token,pusherKey:S,signal:T,onProgress:h})],{signal:d})).then(w=>{if(w instanceof D)throw w;return w}).then(w=>yr(w.uuid,{publicKey:t,baseURL:r,integration:f,userAgent:m,retryThrottledRequestMaxTimes:y,onProgress:h,signal:d})).then(w=>new ae(w,{baseCDN:o})),mr=new WeakMap,En=i=>b(void 0,null,function*(){if(mr.has(i))return mr.get(i);let t=yield fetch(i.uri).then(e=>e.blob());return mr.set(i,t),t}),xi=i=>b(void 0,null,function*(){if(Lt(i)||Ot(i))return i.size;if(Mt(i))return(yield En(i)).size;throw new Error("Unknown file type. Cannot determine file size.")}),kn=(i,t=I.multipartMinFileSize)=>i>=t,Ci=i=>{let t="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",e=new RegExp(t);return!Fe(i)&&e.test(i)},xr=i=>{let t="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",e=new RegExp(t);return!Fe(i)&&e.test(i)},Tn=(i,t)=>new Promise((e,r)=>{let o=[],s=!1,n=t.length,a=[...t],l=()=>{let c=t.length-a.length,d=a.shift();d&&d().then(h=>{s||(o[c]=h,n-=1,n?l():e(o))}).catch(h=>{s=!0,r(h)})};for(let c=0;c<i;c++)l()}),Sn=(i,t,e,r)=>{let o=r*t,s=Math.min(o+r,e);return i.slice(o,s)},In=(i,t,e)=>b(void 0,null,function*(){return r=>Sn(i,r,t,e)}),$n=(i,t,{publicKey:e,contentType:r,onProgress:o,signal:s,integration:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})=>pn(i,t,{publicKey:e,contentType:r,onProgress:o,signal:s,integration:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l}),On=(Y,_t)=>b(void 0,[Y,_t],function*(i,{publicKey:t,fileName:e,fileSize:r,baseURL:o,secureSignature:s,secureExpire:n,store:a,signal:l,onProgress:c,source:d,integration:h,userAgent:u,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,contentType:y,multipartChunkSize:S=I.multipartChunkSize,maxConcurrentRequests:E=I.maxConcurrentRequests,baseCDN:w,metadata:T}){let he=r??(yield xi(i)),Le,J=(O,ue)=>{if(!c)return;Le||(Le=Array(O).fill(0));let Me=pe=>pe.reduce((et,yt)=>et+yt,0);return pe=>{pe.isComputable&&(Le[ue]=pe.value,c({isComputable:!0,value:Me(Le)/O}))}};return y||=vi(i),un(he,{publicKey:t,contentType:y,fileName:e||_i(i),baseURL:o,secureSignature:s,secureExpire:n,store:a,signal:l,source:d,integration:h,userAgent:u,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,metadata:T}).then(Me=>b(void 0,[Me],function*({uuid:O,parts:ue}){let pe=yield In(i,he,S);return Promise.all([O,Tn(E,ue.map((et,yt)=>()=>$n(pe(yt),et,{publicKey:t,contentType:y,onProgress:J(ue.length,yt),signal:l,integration:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m})))])})).then(([O])=>mn(O,{publicKey:t,baseURL:o,source:d,integration:h,userAgent:u,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m})).then(O=>O.isReady?O:yr(O.uuid,{publicKey:t,baseURL:o,source:d,integration:h,userAgent:u,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,onProgress:c,signal:l})).then(O=>new ae(O,{baseCDN:w}))});function Cr(Le,J){return b(this,arguments,function*(i,{publicKey:t,fileName:e,baseURL:r=I.baseURL,secureSignature:o,secureExpire:s,store:n,signal:a,onProgress:l,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:f,contentType:m,multipartMinFileSize:y,multipartChunkSize:S,maxConcurrentRequests:E,baseCDN:w=I.baseCDN,checkForUrlDuplicates:T,saveUrlForRecurrentUploads:Y,pusherKey:_t,metadata:he}){if(Fe(i)){let O=yield xi(i);return kn(O,y)?On(i,{publicKey:t,contentType:m,multipartChunkSize:S,fileSize:O,fileName:e,baseURL:r,secureSignature:o,secureExpire:s,store:n,signal:a,onProgress:l,source:c,integration:d,userAgent:h,maxConcurrentRequests:E,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:f,baseCDN:w,metadata:he}):gn(i,{publicKey:t,fileName:e,contentType:m,baseURL:r,secureSignature:o,secureExpire:s,store:n,signal:a,onProgress:l,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:f,baseCDN:w,metadata:he})}if(xr(i))return An(i,{publicKey:t,fileName:e,baseURL:r,baseCDN:w,checkForUrlDuplicates:T,saveUrlForRecurrentUploads:Y,secureSignature:o,secureExpire:s,store:n,signal:a,onProgress:l,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:f,pusherKey:_t,metadata:he});if(Ci(i))return bn(i,{publicKey:t,fileName:e,baseURL:r,signal:a,onProgress:l,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:f,baseCDN:w});throw new TypeError(`File uploading from "${i}" is not supported`)})}var br=class{uuid;filesCount;totalSize;isStored;isImage;cdnUrl;files;createdAt;storedAt=null;constructor(t,{baseCDN:e=I.baseCDN}={}){this.uuid=t.id,this.filesCount=t.filesCount;let r=t.files.filter(Boolean);this.totalSize=Object.values(r).reduce((o,s)=>o+s.size,0),this.isStored=!!t.datetimeStored,this.isImage=!!Object.values(r).filter(o=>o.isImage).length,this.cdnUrl=t.cdnUrl,this.files=r.map(o=>new ae(o,{baseCDN:e})),this.createdAt=t.datetimeCreated,this.storedAt=t.datetimeStored}},Ln=i=>{for(let t of i)if(!Fe(t))return!1;return!0},Mn=i=>{for(let t of i)if(!Ci(t))return!1;return!0},Un=i=>{for(let t of i)if(!xr(t))return!1;return!0};function Ai(i,{publicKey:t,fileName:e,baseURL:r=I.baseURL,secureSignature:o,secureExpire:s,store:n,signal:a,onProgress:l,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:f,contentType:m,multipartChunkSize:y=I.multipartChunkSize,baseCDN:S=I.baseCDN,checkForUrlDuplicates:E,saveUrlForRecurrentUploads:w,jsonpCallback:T}){if(!Ln(i)&&!Un(i)&&!Mn(i))throw new TypeError(`Group uploading from "${i}" is not supported`);let Y,_t=!0,he=i.length,Le=(J,O)=>{if(!l)return;Y||(Y=Array(J).fill(0));let ue=Me=>Me.reduce((pe,et)=>pe+et)/J;return Me=>{if(!Me.isComputable||!_t){_t=!1,l({isComputable:!1});return}Y[O]=Me.value,l({isComputable:!0,value:ue(Y)})}};return Promise.all(i.map((J,O)=>Fe(J)||xr(J)?Cr(J,{publicKey:t,fileName:e,baseURL:r,secureSignature:o,secureExpire:s,store:n,signal:a,onProgress:Le(he,O),source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:f,contentType:m,multipartChunkSize:y,baseCDN:S,checkForUrlDuplicates:E,saveUrlForRecurrentUploads:w}).then(ue=>ue.uuid):J)).then(J=>hn(J,{publicKey:t,baseURL:r,jsonpCallback:T,secureSignature:o,secureExpire:s,signal:a,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:f}).then(O=>new br(O,{baseCDN:S})).then(O=>(l&&l({isComputable:!0,value:1}),O)))}var St=class{_concurrency=1;_pending=[];_running=0;_resolvers=new Map;_rejectors=new Map;constructor(t){this._concurrency=t}_run(){let t=this._concurrency-this._running;for(let e=0;e<t;e++){let r=this._pending.shift();if(!r)return;let o=this._resolvers.get(r),s=this._rejectors.get(r);if(!o||!s)throw new Error("Unexpected behavior: resolver or rejector is undefined");this._running+=1,r().finally(()=>{this._resolvers.delete(r),this._rejectors.delete(r),this._running-=1,this._run()}).then(n=>o(n)).catch(n=>s(n))}}add(t){return new Promise((e,r)=>{this._resolvers.set(t,e),this._rejectors.set(t,r),this._pending.push(t),this._run()})}get pending(){return this._pending.length}get running(){return this._running}set concurrency(t){this._concurrency=t,this._run()}get concurrency(){return this._concurrency}};var Ar=()=>({}),Er=i=>g(p({},Ar()),{"*currentActivity":"","*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{i.set$({"*modalActive":!1,"*currentActivity":""})}}),Pt=i=>g(p({},Er(i)),{"*commonProgress":0,"*uploadList":[],"*focusedEntry":null,"*uploadMetadata":null,"*uploadQueue":new St(1),"*uploadCollection":null,"*collectionErrors":[],"*collectionState":null,"*groupInfo":null,"*uploadTrigger":new Set});var nt={"locale-id":"en","social-source-lang":"en","upload-file":"Upload file","upload-files":"Upload files","choose-file":"Choose file","choose-files":"Choose files","drop-files-here":"Drop files here","select-file-source":"Select file source",selected:"Selected",upload:"Upload","add-more":"Add more",cancel:"Cancel","start-from-cancel":"Cancel",clear:"Clear","camera-shot":"Shot","upload-url":"Import","upload-url-placeholder":"Paste link here","edit-image":"Edit image","edit-detail":"Details",back:"Back",done:"Done",ok:"Ok","remove-from-list":"Remove",no:"No",yes:"Yes","confirm-your-action":"Confirm your action","are-you-sure":"Are you sure?","selected-count":"Selected:","upload-error":"Upload error","validation-error":"Validation error","no-files":"No files selected",browse:"Browse","not-uploaded-yet":"Not uploaded yet...",file__one:"file",file__other:"files",error__one:"error",error__other:"errors","header-uploading":"Uploading {{count}} {{plural:file(count)}}","header-failed":"{{count}} {{plural:error(count)}}","header-succeed":"{{count}} {{plural:file(count)}} uploaded","header-total":"{{count}} {{plural:file(count)}} selected","src-type-local":"From device","src-type-from-url":"From link","src-type-camera":"Camera","src-type-draw":"Draw","src-type-facebook":"Facebook","src-type-dropbox":"Dropbox","src-type-gdrive":"Google Drive","src-type-gphotos":"Google Photos","src-type-instagram":"Instagram","src-type-flickr":"Flickr","src-type-vk":"VK","src-type-evernote":"Evernote","src-type-box":"Box","src-type-onedrive":"Onedrive","src-type-huddle":"Huddle","src-type-other":"Other","caption-from-url":"Import from link","caption-camera":"Camera","caption-draw":"Draw","caption-edit-file":"Edit file","file-no-name":"No name...","toggle-fullscreen":"Toggle fullscreen","toggle-guides":"Toggle guides",rotate:"Rotate","flip-vertical":"Flip vertical","flip-horizontal":"Flip horizontal",apply:"Apply",brightness:"Brightness",contrast:"Contrast",saturation:"Saturation",exposure:"Exposure",gamma:"Gamma",vibrance:"Vibrance",warmth:"Warmth",enhance:"Enhance",original:"Original",resize:"Resize image",crop:"Crop","select-color":"Select color",text:"Text",draw:"Draw","cancel-edit":"Cancel edit","tab-view":"Preview","tab-details":"Details","file-name":"Name","file-size":"Size","cdn-url":"CDN URL","file-size-unknown":"Unknown","camera-permissions-denied":"Camera access denied","camera-permissions-prompt":"Please allow access to the camera","camera-permissions-request":"Request access","files-count-limit-error-title":"Files count limit overflow","files-count-limit-error-too-few":"You\u2019ve chosen {{total}} {{plural:file(total)}}. At least {{min}} {{plural:file(min)}} required.","files-count-limit-error-too-many":"You\u2019ve chosen too many files. {{max}} {{plural:file(max)}} is maximum.","files-max-size-limit-error":"File is too big. Max file size is {{maxFileSize}}.","has-validation-errors":"File validation error ocurred. Please, check your files before upload.","images-only-accepted":"Only image files are accepted.","file-type-not-allowed":"Uploading of these file types is not allowed.","some-files-were-not-uploaded":"Some files were not uploaded."};var Rt=new Map,kr=new Map,Ei=(i,t)=>{Rt.has(i)&&console.log(`Locale ${i} is already defined. Overwriting...`),Rt.set(i,p(p({},nt),t))},Pn=(i,t)=>{kr.set(i,t)},Tr=(i,t)=>{typeof t=="function"?Pn(i,t):Ei(i,t)},ki=i=>b(void 0,null,function*(){if(!Rt.has(i)){if(!kr.has(i))throw new Error(`Locale ${i} is not defined`);let e=yield kr.get(i)();Ei(i,e)}return Rt.get(i)});Tr("en",nt);var ce=i=>`*l10n/${i}`,Rn="en",Ft=class{_blockInstance=null;_localeName="";_callbacks=new Set;_boundBlocks=new Map;constructor(t){this._blockInstance=t;for(let[e,r]of Object.entries(nt))this._blockInstance.add(ce(e),r,!1);setTimeout(()=>{t.subConfigValue("localeName",e=>b(this,null,function*(){if(!this._blockInstance||!e)return;this._localeName=e;let r=yield ki(e);if(e!==Rn&&this._localeName!==e)return;let o=this._blockInstance.cfg.localeDefinitionOverride?.[e];for(let[s,n]of Object.entries(r)){let a=o?.[s];this._blockInstance.add(ce(s),a??n,!0);for(let l of this._callbacks)l()}})),t.subConfigValue("localeDefinitionOverride",e=>{if(!e)return;let r=e[this._localeName];if(r)for(let[o,s]of Object.entries(r)){this._blockInstance?.add(ce(o),s,!0);for(let n of this._callbacks)n()}})})}onLocaleChange(t){let e=M(t,0);return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}bindL10n(t,e,r){t.$[e]=r(),this._boundBlocks.has(t)||this._boundBlocks.set(t,new Map),this._boundBlocks.get(t)?.get(e)?.();let o=this.onLocaleChange(()=>{t.$[e]=r()});this._boundBlocks.get(t)?.set(e,o)}destroyL10nBindings(t){let e=this._boundBlocks.get(t);if(e){for(let r of e.values())r();this._boundBlocks.delete(t)}}destroy(){this._callbacks.clear()}};function Ti(i,t){[...i.querySelectorAll("[l10n]")].forEach(e=>{let r=e.getAttribute("l10n");if(!r)return;let o="textContent",s=!1;if(r.includes(":")){let l=r.split(":");o=l[0],r=l[1],o.startsWith("@")&&(o=o.slice(1),s=!0)}let n=r;t.has(n)&&t.sub(n,l=>{if(!l)return;t.l10nProcessorSubs.has(n)||t.l10nProcessorSubs.set(n,new Set);let c=t.l10nProcessorSubs.get(n);c?.forEach(u=>{u.remove(),c.delete(u),t.allSubs.delete(u)});let d=ce(l).replace("*",""),h=t.nodeCtx.sub(d,()=>{e[o]=t.l10n(l)});c?.add(h),t.allSubs.add(h),e.removeAttribute("l10n")});let a=ce(r);t.has(a)||t.add(a,""),t.sub(a,()=>{r=r,s?e.setAttribute(o,t.l10n(r)):e[o]=t.l10n(r)}),e.removeAttribute("l10n")})}var B=i=>`*cfg/${i}`;var at="blocks",lt="0.39.0";var Si=i=>{if(typeof i!="string"||!i)return"";let t=i.trim();return t.startsWith("-/")?t=t.slice(2):t.startsWith("/")&&(t=t.slice(1)),t.endsWith("/")&&(t=t.slice(0,t.length-1)),t},zt=(...i)=>i.filter(t=>typeof t=="string"&&t).map(t=>Si(t)).join("/-/"),N=(...i)=>{let t=zt(...i);return t?`-/${t}/`:""};function Ii(i){let t=new URL(i),e=t.pathname+t.search+t.hash,r=e.lastIndexOf("http"),o=e.lastIndexOf("/"),s="";return r>=0?s=e.slice(r):o>=0&&(s=e.slice(o+1)),s}function $i(i){let t=new URL(i),{pathname:e}=t,r=e.indexOf("/"),o=e.indexOf("/",r+1);return e.substring(r+1,o)}function Oi(i){let t=Li(i),e=new URL(t),r=e.pathname.indexOf("/-/");return r===-1?[]:e.pathname.substring(r).split("/-/").filter(Boolean).map(s=>Si(s))}function Li(i){let t=new URL(i),e=Ii(i),r=Mi(e)?Ui(e).pathname:e;return t.pathname=t.pathname.replace(r,""),t.search="",t.hash="",t.toString()}function Mi(i){return i.startsWith("http")}function Ui(i){let t=new URL(i);return{pathname:t.origin+t.pathname||"",search:t.search||"",hash:t.hash||""}}var U=(i,t,e)=>{let r=new URL(Li(i));if(e=e||Ii(i),r.pathname.startsWith("//")&&(r.pathname=r.pathname.replace("//","/")),Mi(e)){let o=Ui(e);r.pathname=r.pathname+(t||"")+(o.pathname||""),r.search=o.search,r.hash=o.hash}else r.pathname=r.pathname+(t||"")+(e||"");return r.toString()},ve=(i,t)=>{let e=new URL(i);return e.pathname=t+"/",e.toString()};var R=(i,t=",")=>i.trim().split(t).map(e=>e.trim()).filter(e=>e.length>0);var q=Object.freeze({brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0,mirror:!1,flip:!1,crop:void 0}),Ri=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function Fn(i,t){if(typeof t=="number"){let e=t;return q[i]!==e?`${i}/${e}`:""}if(typeof t=="boolean"){let e=t;return q[i]!==e?`${i}`:""}if(i==="filter"&&t){let{name:e,amount:r}=t;return q.filter===r?"":`${i}/${e}/${r}`}if(i==="crop"&&t){let{dimensions:e,coords:r}=t;return`${i}/${e.join("x")}/${r.join(",")}`}return""}function _e(i){return zt(...Ri.filter(t=>typeof i[t]<"u"&&i[t]!==null).map(t=>{let e=i[t];return Fn(t,e)}).filter(t=>!!t))}var Dt=zt("format/auto","progressive/yes"),de=([i])=>typeof i<"u"?Number(i):void 0,Pi=()=>!0,zn=([i,t])=>({name:i,amount:typeof t<"u"?Number(t):100}),Dn=([i,t])=>{if(!/\d+x\d+/.test(i)||!/\d+,\d+/.test(t))throw new Error("Crop by aspect ratio, percentage or alignment shortcuts is not supported.");return{dimensions:R(i,"x").map(Number),coords:R(t).map(Number)}},Nn=Object.freeze({enhance:de,brightness:de,exposure:de,gamma:de,contrast:de,saturation:de,vibrance:de,warmth:de,filter:zn,mirror:Pi,flip:Pi,rotate:de,crop:Dn});function Fi(i){let t={};for(let e of i){let[r,...o]=e.split("/");if(!Ri.includes(r))continue;let s=r,n=Nn[s];try{let a=n(o);t[s]=a}catch(a){console.warn([`Failed to parse URL operation "${e}". It will be ignored.`,a instanceof Error?`Error message: "${a.message}"`:a,"If you need this functionality, please feel free to open an issue at https://github.com/uploadcare/blocks/issues/new"].join(`
`))}}return t}var P=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),H=[P.CROP,P.TUNING,P.FILTERS],zi=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],Di=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],Ni=["rotate","mirror","flip"],ee=Object.freeze({brightness:{zero:q.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:q.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:q.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:q.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:q.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:q.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:q.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:q.enhance,range:[0,100],keypointsNumber:1},filter:{zero:q.filter,range:[0,100],keypointsNumber:1}});var Vi=i=>i?i.split(",").map(t=>t.trim()):[],ze=i=>i?i.join(","):"";var Vn="https://ucarecdn.com",Bn="https://upload.uploadcare.com",Hn="https://social.uploadcare.com",Q={pubkey:"",multiple:!0,multipleMin:0,multipleMax:Number.MAX_SAFE_INTEGER,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",store:"auto",cameraMirror:!1,cameraCapture:"",sourceList:"local, url, camera, dropbox, gdrive",cloudImageEditorTabs:ze(H),maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",imageShrink:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:Vn,baseUrl:Bn,socialBaseUrl:Hn,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:1,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",debug:!1,metadata:null,localeName:"en",localeDefinitionOverride:null};var Sr="lr-",_=(()=>{class i extends Ee{static StateConsumerScope=null;static className="";requireCtxName=!1;allowCustomTemplate=!0;activityType=null;init$=Ar();l10n(e,r={}){if(!e)return"";let o=this.$[ce(e)]||e,s=ci(o);for(let a of s)r[a.variable]=this.pluralize(a.pluralKey,Number(r[a.countVariable]));return ot(o,r)}pluralize(e,r){let o=this.l10n("locale-id")||"en",s=Tt(o,r);return this.l10n(`${e}__${s}`)}bindL10n(e,r){this.localeManager?.bindL10n(this,e,r)}constructor(){super(),this.l10nProcessorSubs=new Map,this.addTemplateProcessor(Ti)}emit(e,r,o){let s=this.has("*eventEmitter")&&this.$["*eventEmitter"];s&&s.emit(e,r,o)}hasBlockInCtx(e){let r=this.$["*blocksRegistry"];for(let o of r)if(e(o))return!0;return!1}setOrAddState(e,r){this.add$({[e]:r},!0)}setActivity(e){if(this.hasBlockInCtx(r=>r.activityType===e)){this.$["*currentActivity"]=e;return}console.warn(`Activity type "${e}" not found in the context`)}connectedCallback(){let e=this.constructor.className;e&&this.classList.toggle(`${Sr}${e}`,!0),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?di({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback(),it.registerClient(this)}disconnectedCallback(){super.disconnectedCallback(),it.unregisterClient(this)}initCallback(){this.has("*blocksRegistry")||this.add("*blocksRegistry",new Set),this.$["*blocksRegistry"].add(this),this.has("*eventEmitter")||this.add("*eventEmitter",new kt(this.debugPrint.bind(this))),this.has("*localeManager")||this.add("*localeManager",new Ft(this)),this.sub(ce("locale-id"),r=>{this.style.direction=ni(r)})}get localeManager(){return this.has("*localeManager")?this.$["*localeManager"]:null}destroyCallback(){let e=this.$["*blocksRegistry"];e.delete(this),this.localeManager?.destroyL10nBindings(this),this.l10nProcessorSubs=new Map,A.deleteCtx(this),e.size===0&&setTimeout(()=>{this.destroyCtxCallback()},0)}destroyCtxCallback(){A.deleteCtx(this.ctxName),this.localeManager?.destroy()}fileSizeFmt(e,r=2){let o=["B","KB","MB","GB","TB"];if(e===0)return`0 ${o[0]}`;let s=1024,n=r<0?0:r,a=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/s**a).toFixed(n))+" "+o[a]}proxyUrl(e){let r=this.cfg.secureDeliveryProxy;return r?ot(r,{previewUrl:e},{transform:o=>window.encodeURIComponent(o)}):e}get cfg(){if(!this.__cfgProxy){let e=Object.create(null);this.__cfgProxy=new Proxy(e,{set:(r,o,s)=>{if(typeof o!="string")return!1;let n=B(o);return this.has(n)||this.add(n,Q[o]),this.$[n]=s,!0},get:(r,o)=>{let s=B(o);return this.has(s)||this.add(s,Q[o]),this.$[B(o)]}})}return this.__cfgProxy}subConfigValue(e,r){let o=B(e);this.has(o)||this.add(o,Q[e]),this.sub(o,r)}debugPrint(...e){if(!this.cfg.debug)return;let r=e;if(typeof e?.[0]=="function"){let o=e[0];r=o()}console.log(`[${this.ctxName}]`,...r)}static reg(e){if(!e){super.reg();return}super.reg(e.startsWith(Sr)?e:Sr+e)}}return i})();var Bi="active",ct="___ACTIVITY_IS_ACTIVE___",v=class i extends _{historyTracked=!1;init$=Er(this);_debouncedHistoryFlush=M(this._historyFlush.bind(this),10);_deactivate(){let t=i._activityCallbacks.get(this);this[ct]=!1,this.removeAttribute(Bi),t?.deactivateCallback?.()}_activate(){let t=i._activityCallbacks.get(this);this.$["*historyBack"]=this.historyBack.bind(this),this[ct]=!0,this.setAttribute(Bi,""),t?.activateCallback?.(),this._debouncedHistoryFlush(),this.emit($.ACTIVITY_CHANGE,{activity:this.activityType})}initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",t=>{this.setAttribute("current-activity",t)}),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",t=>{this.activityType!==t&&this[ct]?this._deactivate():this.activityType===t&&!this[ct]&&this._activate(),t||(this.$["*history"]=[])}),this.has("*modalActive")&&this.sub("*modalActive",t=>{!t&&this.activityType===this.$["*currentActivity"]&&(this.$["*currentActivity"]=null)}))}_historyFlush(){let t=this.$["*history"];t&&(t.length>10&&(t=t.slice(t.length-11,t.length-1)),this.historyTracked&&t[t.length-1]!==this.activityType&&t.push(this.activityType),this.$["*history"]=t)}_isActivityRegistered(){return this.activityType&&i._activityCallbacks.has(this)}static _activityCallbacks=new Map;get isActivityActive(){return this[ct]}get couldOpenActivity(){return!0}registerActivity(t,e={}){let{onActivate:r,onDeactivate:o}=e;i._activityCallbacks.set(this,{activateCallback:r,deactivateCallback:o})}unregisterActivity(){this.isActivityActive&&this._deactivate(),i._activityCallbacks.delete(this)}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity();let t=this.$["*currentActivity"];!![...this.$["*blocksRegistry"]].find(o=>o instanceof i&&o.activityType===t)||(this.$["*currentActivity"]=null)}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let t=this.$["*history"];if(t){let e=t.pop();for(;e===this.activityType;)e=t.pop();let r=!!e;e&&(r=[...this.$["*blocksRegistry"]].find(n=>n.activityType===e)?.couldOpenActivity??!1),e=r?e:void 0,this.$["*currentActivity"]=e,this.$["*history"]=t,e||this.setOrAddState("*modalActive",!1)}}};v.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});var dt=33.333333333333336,x=1,Ir=24,Hi=6;function Te(i,t){for(let e in t)i.setAttributeNS(null,e,t[e].toString())}function Z(i,t={}){let e=document.createElementNS("http://www.w3.org/2000/svg",i);return Te(e,t),e}function ji(i,t,e){let{x:r,y:o,width:s,height:n}=i,a=t.includes("w")?0:1,l=t.includes("n")?0:1,c=[-1,1][a],d=[-1,1][l],h=[r+a*s+1.5*c,o+l*n+1.5*d-24*e*d],u=[r+a*s+1.5*c,o+l*n+1.5*d],f=[r+a*s-24*e*c+1.5*c,o+l*n+1.5*d];return{d:`M ${h[0]} ${h[1]} L ${u[0]} ${u[1]} L ${f[0]} ${f[1]}`,center:u}}function Gi(i,t,e){let{x:r,y:o,width:s,height:n}=i,a=["n","s"].includes(t)?.5:{w:0,e:1}[t],l=["w","e"].includes(t)?.5:{n:0,s:1}[t],c=[-1,1][a],d=[-1,1][l],h,u;["n","s"].includes(t)?(h=[r+a*s-34*e/2,o+l*n+1.5*d],u=[r+a*s+34*e/2,o+l*n+1.5*d]):(h=[r+a*s+1.5*c,o+l*n-34*e/2],u=[r+a*s+1.5*c,o+l*n+34*e/2]);let f=`M ${h[0]} ${h[1]} L ${u[0]} ${u[1]}`,m=[u[0]-(u[0]-h[0])/2,u[1]-(u[1]-h[1])/2];return{d:f,center:m}}function Wi(i){return i===""?"move":["e","w"].includes(i)?"ew-resize":["n","s"].includes(i)?"ns-resize":["nw","se"].includes(i)?"nwse-resize":"nesw-resize"}function qi({rect:i,delta:[t,e],imageBox:r}){return Ne(g(p({},i),{x:i.x+t,y:i.y+e}),r)}function Ne(i,t){let{x:e}=i,{y:r}=i;return i.x<t.x?e=t.x:i.x+i.width>t.x+t.width&&(e=t.x+t.width-i.width),i.y<t.y?r=t.y:i.y+i.height>t.y+t.height&&(r=t.y+t.height-i.height),g(p({},i),{x:e,y:r})}function jn({rect:i,delta:t,aspectRatio:e,imageBox:r}){let[,o]=t,{y:s,width:n,height:a}=i;s+=o,a-=o,e&&(n=a*e);let l=i.x+i.width/2-n/2;return s<=r.y&&(s=r.y,a=i.y+i.height-s,e&&(n=a*e,l=i.x+i.width/2-n/2)),l<=r.x&&(l=r.x,s=i.y+i.height-a),l+n>=r.x+r.width&&(l=Math.max(r.x,r.x+r.width-n),n=r.x+r.width-l,e&&(a=n/e),s=i.y+i.height-a),a<x&&(a=x,e&&(n=a*e,l=i.x+i.width/2-n/2),s=i.y+i.height-a),n<x&&(n=x,e&&(a=n/e,l=i.x+i.width/2-n/2),s=i.y+i.height-a),{x:l,y:s,width:n,height:a}}function Gn({rect:i,delta:t,aspectRatio:e,imageBox:r}){let[o]=t,{x:s,width:n,height:a}=i;s+=o,n-=o,e&&(a=n/e);let l=i.y+i.height/2-a/2;return s<=r.x&&(s=r.x,n=i.x+i.width-s,e&&(a=n/e,l=i.y+i.height/2-a/2)),l<=r.y&&(l=r.y,s=i.x+i.width-n),l+a>=r.y+r.height&&(l=Math.max(r.y,r.y+r.height-a),a=r.y+r.height-l,e&&(n=a*e),s=i.x+i.width-n),a<x&&(a=x,e&&(n=a*e),l=i.y+i.height/2-a/2,s=i.x+i.width-n),n<x&&(n=x,e&&(a=n/e),l=i.y+i.height/2-a/2,s=i.x+i.width-n),{x:s,y:l,width:n,height:a}}function Wn({rect:i,delta:t,aspectRatio:e,imageBox:r}){let[,o]=t,{y:s,width:n,height:a}=i;a+=o,e&&(n=a*e);let l=i.x+i.width/2-n/2;return s+a>=r.y+r.height&&(a=r.y+r.height-s,e&&(n=a*e),l=i.x+i.width/2-n/2),l<=r.x&&(l=r.x,s=i.y),l+n>=r.x+r.width&&(l=Math.max(r.x,r.x+r.width-n),n=r.x+r.width-l,e&&(a=n/e),s=i.y),a<x&&(a=x,e&&(n=a*e),l=i.x+i.width/2-n/2),n<x&&(n=x,e&&(a=n/e),l=i.x+i.width/2-n/2),{x:l,y:s,width:n,height:a}}function qn({rect:i,delta:t,aspectRatio:e,imageBox:r}){let[o]=t,{x:s,width:n,height:a}=i;n+=o,e&&(a=n/e);let l=i.y+i.height/2-a/2;return s+n>=r.x+r.width&&(n=r.x+r.width-s,e&&(a=n/e),l=i.y+i.height/2-a/2),l<=r.y&&(l=r.y,s=i.x),l+a>=r.y+r.height&&(l=Math.max(r.y,r.y+r.height-a),a=r.y+r.height-l,e&&(n=a*e),s=i.x),a<x&&(a=x,e&&(n=a*e),l=i.y+i.height/2-a/2),n<x&&(n=x,e&&(a=n/e),l=i.y+i.height/2-a/2),{x:s,y:l,width:n,height:a}}function Xn({rect:i,delta:t,aspectRatio:e,imageBox:r}){let[o,s]=t,{x:n,y:a,width:l,height:c}=i;return n+o<r.x&&(o=r.x-n),a+s<r.y&&(s=r.y-a),n+=o,l-=o,a+=s,c-=s,e&&Math.abs(l/c)>e?(s=l/e-c,c+=s,a-=s,a<=r.y&&(c=c-(r.y-a),l=c*e,n=i.x+i.width-l,a=r.y)):e&&(o=c*e-l,l=l+o,n-=o,n<=r.x&&(l=l-(r.x-n),c=l/e,n=r.x,a=i.y+i.height-c)),c<x&&(c=x,e&&(l=c*e),n=i.x+i.width-l,a=i.y+i.height-c),l<x&&(l=x,e&&(c=l/e),n=i.x+i.width-l,a=i.y+i.height-c),{x:n,y:a,width:l,height:c}}function Zn({rect:i,delta:t,aspectRatio:e,imageBox:r}){let[o,s]=t,{x:n,y:a,width:l,height:c}=i;return n+l+o>r.x+r.width&&(o=r.x+r.width-n-l),a+s<r.y&&(s=r.y-a),l+=o,a+=s,c-=s,e&&Math.abs(l/c)>e?(s=l/e-c,c+=s,a-=s,a<=r.y&&(c=c-(r.y-a),l=c*e,n=i.x,a=r.y)):e&&(o=c*e-l,l+=o,n+l>=r.x+r.width&&(l=r.x+r.width-n,c=l/e,n=r.x+r.width-l,a=i.y+i.height-c)),c<x&&(c=x,e&&(l=c*e),a=i.y+i.height-c),l<x&&(l=x,e&&(c=l/e),a=i.y+i.height-c),{x:n,y:a,width:l,height:c}}function Kn({rect:i,delta:t,aspectRatio:e,imageBox:r}){let[o,s]=t,{x:n,y:a,width:l,height:c}=i;return n+o<r.x&&(o=r.x-n),a+c+s>r.y+r.height&&(s=r.y+r.height-a-c),n+=o,l-=o,c+=s,e&&Math.abs(l/c)>e?(s=l/e-c,c+=s,a+c>=r.y+r.height&&(c=r.y+r.height-a,l=c*e,n=i.x+i.width-l,a=r.y+r.height-c)):e&&(o=c*e-l,l+=o,n-=o,n<=r.x&&(l=l-(r.x-n),c=l/e,n=r.x,a=i.y)),c<x&&(c=x,e&&(l=c*e),n=i.x+i.width-l),l<x&&(l=x,e&&(c=l/e),n=i.x+i.width-l),{x:n,y:a,width:l,height:c}}function Yn({rect:i,delta:t,aspectRatio:e,imageBox:r}){let[o,s]=t,{x:n,y:a,width:l,height:c}=i;return n+l+o>r.x+r.width&&(o=r.x+r.width-n-l),a+c+s>r.y+r.height&&(s=r.y+r.height-a-c),l+=o,c+=s,e&&Math.abs(l/c)>e?(s=l/e-c,c+=s,a+c>=r.y+r.height&&(c=r.y+r.height-a,l=c*e,n=i.x,a=r.y+r.height-c)):e&&(o=c*e-l,l+=o,n+l>=r.x+r.width&&(l=r.x+r.width-n,c=l/e,n=r.x+r.width-l,a=i.y)),c<x&&(c=x,e&&(l=c*e)),l<x&&(l=x,e&&(c=l/e)),{x:n,y:a,width:l,height:c}}function Xi(e){var r=e,{direction:i}=r,t=wt(r,["direction"]);switch(i){case"n":return jn(t);case"w":return Gn(t);case"s":return Wn(t);case"e":return qn(t);case"nw":return Xn(t);case"ne":return Zn(t);case"sw":return Kn(t);case"se":return Yn(t);default:return t.rect}}function Zi(i,[t,e]){return i.x<=t&&t<=i.x+i.width&&i.y<=e&&e<=i.y+i.height}function Ki(i,t){return i.x>=t.x&&i.y>=t.y&&i.x+i.width<=t.x+t.width&&i.y+i.height<=t.y+t.height}function Yi(i,t){return Math.abs(i.width/i.height-t)<.1}function Ve({width:i,height:t},e){let r=e/90%2!==0;return{width:r?t:i,height:r?i:t}}function Ji(i,t,e){let r=i/t,o,s;r>e?(o=Math.round(t*e),s=t):(o=i,s=Math.round(i/e));let n=Math.round((i-o)/2),a=Math.round((t-s)/2);return n+o>i&&(o=i-n),a+s>t&&(s=t-a),{x:n,y:a,width:o,height:s}}function Be(i){return{x:Math.round(i.x),y:Math.round(i.y),width:Math.round(i.width),height:Math.round(i.height)}}function ye(i,t,e){return Math.min(Math.max(i,t),e)}var Vt=i=>{if(!i)return[];let[t,e]=i.split(":").map(Number);if(!Number.isFinite(t)||!Number.isFinite(e)){console.error(`Invalid crop preset: ${i}`);return}return[{type:"aspect-ratio",width:t,height:e}]};var j=Object.freeze({LOCAL:"local",DROP_AREA:"drop-area",URL_TAB:"url-tab",CAMERA:"camera",EXTERNAL:"external",API:"js-api"});function Qi(i){return vr(g(p({},i),{libraryName:at,libraryVersion:lt}))}var eo=r=>{var o=r,{type:i,message:t}=o,e=wt(o,["type","message"]);return p({type:i,message:t},e)},Se=eo,Bt=eo;var Ht=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],$r=i=>i?i.filter(t=>typeof t=="string").map(t=>R(t)).flat():[],Or=(i,t)=>t.some(e=>e.endsWith("*")?(e=e.replace("*",""),i.startsWith(e)):i===e),to=(i,t)=>t.some(e=>e.startsWith(".")?i.toLowerCase().endsWith(e.toLowerCase()):!1),Lr=i=>{let t=i?.type;return t?Or(t,Ht):!1};var re=1e3,Ie=Object.freeze({AUTO:"auto",BYTE:"byte",KB:"kb",MB:"mb",GB:"gb",TB:"tb",PB:"pb"}),ht=i=>Math.ceil(i*100)/100,ro=(i,t=Ie.AUTO)=>{let e=t===Ie.AUTO;if(t===Ie.BYTE||e&&i<re**1){let r=Tt("en-US",i),o={one:"byte",other:"bytes"}[r];return`${i} ${o}`}return t===Ie.KB||e&&i<re**2?`${ht(i/re**1)} KB`:t===Ie.MB||e&&i<re**3?`${ht(i/re**2)} MB`:t===Ie.GB||e&&i<re**4?`${ht(i/re**3)} GB`:t===Ie.TB||e&&i<re**5?`${ht(i/re**4)} TB`:`${ht(i/re**5)} PB`};var io=new Set;function jt(i){io.has(i)||(io.add(i),console.warn(i))}var oo="[Typed State] Wrong property name: ",Jn="[Typed State] Wrong property type: ",Gt=class{constructor(t,e){this.__typedSchema=t,this.__ctxId=e||Ae.generate(),this.__schema=Object.keys(t).reduce((r,o)=>(r[o]=t[o].value,r),{}),this.__data=A.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(t,e){if(!this.__typedSchema.hasOwnProperty(t)){console.warn(oo+t);return}let r=this.__typedSchema[t];if(e?.constructor===r.type||e instanceof r.type||r.nullable&&e===null){this.__data.pub(t,e);return}console.warn(Jn+t)}setMultipleValues(t){for(let e in t)this.setValue(e,t[e])}getValue(t){if(!this.__typedSchema.hasOwnProperty(t)){console.warn(oo+t);return}return this.__data.read(t)}subscribe(t,e){return this.__data.sub(t,e)}remove(){A.deleteCtx(this.__ctxId)}};var Wt=class{constructor(t){this.__typedSchema=t.typedSchema,this.__ctxId=t.ctxName||Ae.generate(),this.__data=A.registerCtx({},this.__ctxId),this.__watchList=t.watchList||[],this.__subsMap=Object.create(null),this.__propertyObservers=new Set,this.__collectionObservers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let e=Object.create(null);this.__notifyObservers=(r,o)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),e[r]||(e[r]=new Set),e[r].add(o),this.__observeTimeout=window.setTimeout(()=>{Object.keys(e).length!==0&&(this.__propertyObservers.forEach(s=>{s(p({},e))}),e=Object.create(null))})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{let t=new Set(this.__added),e=new Set(this.__removed);this.__added.clear(),this.__removed.clear();for(let r of this.__collectionObservers)r?.([...this.__items],t,e)})}observeCollection(t){return this.__collectionObservers.add(t),this.__items.size>0&&this.notify(),()=>{this.unobserveCollection(t)}}unobserveCollection(t){this.__collectionObservers?.delete(t)}add(t){let e=new Gt(this.__typedSchema);for(let r in t)e.setValue(r,t[r]);return this.__items.add(e.uid),this.notify(),this.__data.add(e.uid,e),this.__added.add(e),this.__watchList.forEach(r=>{this.__subsMap[e.uid]||(this.__subsMap[e.uid]=[]),this.__subsMap[e.uid].push(e.subscribe(r,()=>{this.__notifyObservers(r,e.uid)}))}),e.uid}read(t){return this.__data.read(t)}readProp(t,e){return this.read(t).getValue(e)}publishProp(t,e,r){this.read(t).setValue(e,r)}remove(t){this.__removed.add(this.__data.read(t)),this.__items.delete(t),this.notify(),this.__data.pub(t,null),delete this.__subsMap[t]}clearAll(){this.__items.forEach(t=>{this.remove(t)})}observeProperties(t){return this.__propertyObservers.add(t),()=>{this.unobserveProperties(t)}}unobserveProperties(t){this.__propertyObservers?.delete(t)}findItems(t){let e=[];return this.__items.forEach(r=>{let o=this.read(r);t(o)&&e.push(r)}),e}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){A.deleteCtx(this.__ctxId),this.__propertyObservers=null,this.__collectionObservers=null;for(let t in this.__subsMap)this.__subsMap[t].forEach(e=>{e.remove()}),delete this.__subsMap[t]}};var so=i=>{let t=new Map;return(...e)=>{let r=JSON.stringify(e);if(t.has(r))return t.get(r);let o=i(...e);return t.set(r,o),o}};function Qn(i){let t=!1;return setTimeout(()=>{t=!0},0),r=>(...o)=>(t&&jt(i),r(...o))}function no(i){let t={progress:()=>i.$["*commonProgress"],errors:()=>i.$["*collectionErrors"],group:()=>i.$["*groupInfo"],totalCount:()=>i.uploadCollection.size,failedCount:()=>e.failedEntries.length,successCount:()=>e.successEntries.length,uploadingCount:()=>e.uploadingEntries.length,status:()=>e.isFailed?"failed":e.isUploading?"uploading":e.isSuccess?"success":"idle",isSuccess:()=>e.errors.length===0&&e.successEntries.length===e.allEntries.length,isUploading:()=>e.allEntries.some(o=>o.status==="uploading"),isFailed:()=>e.errors.length>0||e.failedEntries.length>0,allEntries:()=>i.getOutputData(),successEntries:()=>e.allEntries.filter(o=>o.status==="success"),failedEntries:()=>e.allEntries.filter(o=>o.status==="failed"),uploadingEntries:()=>e.allEntries.filter(o=>o.status==="uploading"),idleEntries:()=>e.allEntries.filter(o=>o.status==="idle")},e={},r=Qn("You're trying to access the OutputCollectionState asynchronously. In this case, the data you retrieve will be newer than it was when the OutputCollectionState was created or when the event was dispatched. If you want to retain the state at a specific moment in time, you should use the spread operator like this: `{...outputCollectionState}` or `{...e.detail}`");for(let[o,s]of Object.entries(t)){let n=o,l=so(r(s));Object.defineProperty(e,n,{get:l,enumerable:!0})}return e}var ao=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null,nullable:!0},fileSize:{type:Number,value:null,nullable:!0},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:ae,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0},silent:{type:Boolean,value:!1},source:{type:String,value:!1,nullable:!0},fullPath:{type:String,value:null,nullable:!0},metadata:{type:Object,value:null,nullable:!0},errors:{type:Array,value:[]},uploadError:{type:Error,value:null,nullable:!0},isRemoved:{type:Boolean,value:!1}});var ea=/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/i,ta=new RegExp(`^/?(${ea.source})(?:/(-/(?:[^/]+/)+)?([^/]*))?$`,"i"),lo=({url:i,cdnBase:t})=>{let e=new URL(t),r=new URL(i);if(e.host!==r.host)return null;let[,o,s,n]=ta.exec(r.pathname);return{uuid:o,cdnUrlModifiers:s||"",filename:n||null}};var k=class i extends v{couldBeCtxOwner=!1;isCtxOwner=!1;init$=Pt(this);__initialUploadMetadata=null;_fileValidators=[this._validateIsImage.bind(this),this._validateFileType.bind(this),this._validateMaxSizeLimit.bind(this),this._validateUploadError.bind(this)];_collectionValidators=[t=>{let e=t.size,r=this.cfg.multiple?this.cfg.multipleMin:0,o=this.cfg.multiple?this.cfg.multipleMax:1;if(r&&e<r){let s=this.l10n("files-count-limit-error-too-few",{min:r,max:o,total:e});return Bt({type:"TOO_FEW_FILES",message:s,total:e,min:r,max:o})}if(o&&e>o){let s=this.l10n("files-count-limit-error-too-many",{min:r,max:o,total:e});return Bt({type:"TOO_MANY_FILES",message:s,total:e,min:r,max:o})}},t=>{if(t.items().some(e=>t.readProp(e,"errors").length>0))return Bt({type:"SOME_FILES_HAS_ERRORS",message:this.l10n("some-files-were-not-uploaded")})}];setUploadMetadata(t){jt("setUploadMetadata is deprecated. Use `metadata` instance property on `lr-config` block instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.connectedOnce?this.$["*uploadMetadata"]=t:this.__initialUploadMetadata=t}get hasCtxOwner(){return this.hasBlockInCtx(t=>t instanceof i?t.isCtxOwner&&t.isConnected&&t!==this:!1)}initCallback(){if(super.initCallback(),!this.$["*uploadCollection"]){let t=new Wt({typedSchema:ao,watchList:["uploadProgress","uploadError","fileInfo","errors","cdnUrl","isUploading"]});this.$["*uploadCollection"]=t}!this.hasCtxOwner&&this.couldBeCtxOwner&&this.initCtxOwner()}destroyCtxCallback(){this._unobserveCollectionProperties?.(),this._unobserveCollection?.(),this.uploadCollection.destroy(),this.$["*uploadCollection"]=null,super.destroyCtxCallback()}initCtxOwner(){this.isCtxOwner=!0,this._unobserveCollection=this.uploadCollection.observeCollection(this._handleCollectionUpdate),this._unobserveCollectionProperties=this.uploadCollection.observeProperties(this._handleCollectionPropertiesUpdate);let t=()=>{this._runFileValidators(),this._runCollectionValidators()};this.subConfigValue("maxLocalFileSizeBytes",t),this.subConfigValue("multipleMin",t),this.subConfigValue("multipleMax",t),this.subConfigValue("multiple",t),this.subConfigValue("imgOnly",t),this.subConfigValue("accept",t),this.subConfigValue("maxConcurrentRequests",e=>{this.$["*uploadQueue"].concurrency=Number(e)||1}),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata)}addFileFromUrl(t,{silent:e,fileName:r,source:o}={}){let s=this.uploadCollection.add({externalUrl:t,fileName:r??null,silent:e??!1,source:o??j.API});return this.getOutputItem(s)}addFileFromUuid(t,{silent:e,fileName:r,source:o}={}){let s=this.uploadCollection.add({uuid:t,fileName:r??null,silent:e??!1,source:o??j.API});return this.getOutputItem(s)}addFileFromCdnUrl(t,{silent:e,fileName:r,source:o}={}){let s=lo({url:t,cdnBase:this.cfg.cdnCname});if(!s)throw new Error("Invalid CDN URL");let n=this.uploadCollection.add({uuid:s.uuid,cdnUrl:t,cdnUrlModifiers:s.cdnUrlModifiers,fileName:r??s.filename??null,silent:e??!1,source:o??j.API});return this.getOutputItem(n)}addFileFromObject(t,{silent:e,fileName:r,source:o,fullPath:s}={}){let n=this.uploadCollection.add({file:t,isImage:Lr(t),mimeType:t.type,fileName:r??t.name,fileSize:t.size,silent:e??!1,source:o??j.API,fullPath:s??null});return this.getOutputItem(n)}addFiles(t){return console.warn("`addFiles` method is deprecated. Please use `addFileFromObject`, `addFileFromUrl` or `addFileFromUuid` instead."),t.map(e=>{let r=this.uploadCollection.add({file:e,isImage:Lr(e),mimeType:e.type,fileName:e.name,fileSize:e.size});return this.getOutputItem(r)})}removeFileByInternalId(t){if(!this.uploadCollection.read(t))throw new Error(`File with internalId ${t} not found`);this.uploadCollection.remove(t)}removeAllFiles(){this.uploadCollection.clearAll()}uploadAll=()=>{let t=this.uploadCollection.items().filter(e=>{let r=this.uploadCollection.read(e);return!r.getValue("isRemoved")&&!r.getValue("isUploading")&&!r.getValue("fileInfo")});t.length!==0&&(this.$["*uploadTrigger"]=new Set(t),this.emit($.COMMON_UPLOAD_START,this.getOutputCollectionState()))};openSystemDialog(t={}){let e=ze($r([this.cfg.accept??"",...this.cfg.imgOnly?Ht:[]]));this.cfg.accept&&this.cfg.imgOnly&&console.warn("There could be a mistake.\nBoth `accept` and `imgOnly` parameters are set.\nThe value of `accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=this.cfg.multiple,t.captureCamera?(this.fileInput.capture=this.cfg.cameraCapture,this.fileInput.accept="image/*"):this.fileInput.accept=e,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{[...this.fileInput.files].forEach(r=>this.addFileFromObject(r,{source:t.captureCamera?j.CAMERA:j.LOCAL})),this.$["*currentActivity"]=v.activities.UPLOAD_LIST,this.setOrAddState("*modalActive",!0),this.fileInput.value="",this.fileInput=null}}get sourceList(){let t=[];return this.cfg.sourceList&&(t=R(this.cfg.sourceList)),t}initFlow(t=!1){if(this.uploadCollection.size>0&&!t)this.set$({"*currentActivity":v.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0);else if(this.sourceList?.length===1){let e=this.sourceList[0];if(e==="local"){this.$["*currentActivity"]=v.activities.UPLOAD_LIST,this?.openSystemDialog();return}let r=this.$["*blocksRegistry"],o=n=>"type"in n&&n.type===e;[...r].find(o)?.activate(),this.$["*currentActivity"]&&this.setOrAddState("*modalActive",!0)}else this.set$({"*currentActivity":v.activities.START_FROM}),this.setOrAddState("*modalActive",!0)}doneFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setOrAddState("*modalActive",!1)}get uploadCollection(){return this.$["*uploadCollection"]}_validateFileType(t){let e=this.cfg.imgOnly,r=this.cfg.accept,o=$r([...e?Ht:[],r]);if(!o.length)return;let s=t.mimeType,n=t.name;if(!s||!n)return;let a=Or(s,o),l=to(n,o);if(!a&&!l)return Se({type:"FORBIDDEN_FILE_TYPE",message:this.l10n("file-type-not-allowed"),entry:t})}_validateMaxSizeLimit(t){let e=this.cfg.maxLocalFileSizeBytes,r=t.size;if(e&&r&&r>e)return Se({type:"FILE_SIZE_EXCEEDED",message:this.l10n("files-max-size-limit-error",{maxFileSize:ro(e)}),entry:t})}_validateUploadError(t,e){let r=e?.getValue("uploadError");if(r){if(r instanceof D)return Se({type:"UPLOAD_ERROR",message:r.message,entry:t,error:r});if(r instanceof Re)return Se({type:"NETWORK_ERROR",message:r.message,entry:t,error:r});{let o=r instanceof Error?r:new Error("Unknown error",{cause:r});return Se({type:"UNKNOWN_ERROR",message:o.message,entry:t,error:o})}}}_validateIsImage(t){let e=this.cfg.imgOnly,r=t.isImage;if(!(!e||r)&&!(!t.fileInfo&&t.externalUrl)&&!(!t.fileInfo&&!t.mimeType))return Se({type:"NOT_AN_IMAGE",message:this.l10n("images-only-accepted"),entry:t})}_runFileValidatorsForEntry(t){let e=this.getOutputItem(t.uid),r=[];for(let o of this._fileValidators){let s=o(e,t);s&&r.push(s)}t.setValue("errors",r)}_runFileValidators(t){let e=t??this.uploadCollection.items();for(let r of e){let o=this.uploadCollection.read(r);o&&this._runFileValidatorsForEntry(o)}}_runCollectionValidators(){let t=this.uploadCollection,e=[];for(let r of this._collectionValidators){let o=r(t);o&&(Array.isArray(o)?e.push(...o):e.push(o))}this.$["*collectionErrors"]=e,e.length>0&&this.emit($.COMMON_UPLOAD_FAILED,()=>this.getOutputCollectionState(),{debounce:!0})}_createGroup(t){return b(this,null,function*(){let e=this.getUploadClientOptions(),r=t.allEntries.map(a=>a.uuid+(a.cdnUrlModifiers?`/${a.cdnUrlModifiers}`:"")),o=new AbortController,s=yield Ai(r,g(p({},e),{signal:o.signal}));if(this.$["*collectionState"]!==t){o.abort();return}this.$["*groupInfo"]=s;let n=this.getOutputCollectionState();this.emit($.GROUP_CREATED,n),this.emit($.CHANGE,()=>this.getOutputCollectionState(),{debounce:!0}),this.$["*collectionState"]=n})}_flushOutputItems=M(()=>b(this,null,function*(){if(this.getOutputData().length!==this.uploadCollection.size)return;let e=this.getOutputCollectionState();this.$["*collectionState"]=e,this.emit($.CHANGE,()=>this.getOutputCollectionState(),{debounce:!0}),this.cfg.groupOutput&&e.totalCount>0&&e.status==="success"&&this._createGroup(e)}),300);_handleCollectionUpdate=(t,e,r)=>{(e.size||r.size)&&(this.$["*groupInfo"]=null),this._runFileValidators(),this._runCollectionValidators();for(let o of e)o.getValue("silent")||this.emit($.FILE_ADDED,this.getOutputItem(o.uid));for(let o of r)this.$["*uploadTrigger"].delete(o.uid),o.getValue("abortController")?.abort(),o.setMultipleValues({isRemoved:!0,abortController:null,isUploading:!1,uploadProgress:0}),URL.revokeObjectURL(o?.getValue("thumbUrl")),this.emit($.FILE_REMOVED,this.getOutputItem(o.uid));this.$["*uploadList"]=t.map(o=>({uid:o})),this._flushCommonUploadProgress(),this._flushOutputItems()};_handleCollectionPropertiesUpdate=t=>{this._flushOutputItems();let e=this.uploadCollection,r=[...new Set(Object.entries(t).filter(([o])=>["uploadError","fileInfo"].includes(o)).map(([,o])=>[...o]).flat())];if(r.length>0&&setTimeout(()=>{this._runFileValidators(r)}),t.uploadProgress){for(let o of t.uploadProgress){let{isUploading:s,silent:n}=A.getCtx(o).store;s&&!n&&this.emit($.FILE_UPLOAD_PROGRESS,this.getOutputItem(o))}this._flushCommonUploadProgress()}if(t.isUploading)for(let o of t.isUploading){let{isUploading:s,silent:n}=A.getCtx(o).store;s&&!n&&this.emit($.FILE_UPLOAD_START,this.getOutputItem(o))}if(t.fileInfo){for(let n of t.fileInfo){let{fileInfo:a,silent:l}=A.getCtx(n).store;a&&!l&&this.emit($.FILE_UPLOAD_SUCCESS,this.getOutputItem(n))}this.cfg.cropPreset&&this.setInitialCrop();let o=e.findItems(n=>!!n.getValue("fileInfo"));e.findItems(n=>n.getValue("errors").length>0).length===0&&e.size===o.length&&this.emit($.COMMON_UPLOAD_SUCCESS,this.getOutputCollectionState())}if(t.errors)for(let o of t.errors){let{errors:s}=A.getCtx(o).store;s.length>0&&(this.emit($.FILE_UPLOAD_FAILED,this.getOutputItem(o)),this.emit($.COMMON_UPLOAD_FAILED,()=>this.getOutputCollectionState(),{debounce:!0}))}t.cdnUrl&&([...t.cdnUrl].filter(s=>!!this.uploadCollection.read(s)?.getValue("cdnUrl")).forEach(s=>{this.emit($.FILE_URL_CHANGED,this.getOutputItem(s))}),this.$["*groupInfo"]=null)};_flushCommonUploadProgress=()=>{let t=0,r=[...this.$["*uploadTrigger"]].filter(s=>!!this.uploadCollection.read(s));r.forEach(s=>{let n=this.uploadCollection.readProp(s,"uploadProgress");t+=n});let o=r.length?Math.round(t/r.length):0;this.$["*commonProgress"]!==o&&(this.$["*commonProgress"]=o,this.emit($.COMMON_UPLOAD_PROGRESS,this.getOutputCollectionState()))};setInitialCrop(){let t=Vt(this.cfg.cropPreset);if(t){let[e]=t,r=this.uploadCollection.findItems(o=>o.getValue("fileInfo")&&o.getValue("isImage")&&!o.getValue("cdnUrlModifiers")?.includes("/crop/")).map(o=>this.uploadCollection.read(o));for(let o of r){let s=o.getValue("fileInfo"),{width:n,height:a}=s.imageInfo,l=e.width/e.height,c=Ji(n,a,l),d=N(`crop/${c.width}x${c.height}/${c.x},${c.y}`,"preview");o.setMultipleValues({cdnUrlModifiers:d,cdnUrl:U(o.getValue("cdnUrl"),d)}),this.uploadCollection.size===1&&this.cfg.useCloudImageEditor&&this.hasBlockInCtx(h=>h.activityType===v.activities.CLOUD_IMG_EDIT)&&(this.$["*focusedEntry"]=o,this.$["*currentActivity"]=v.activities.CLOUD_IMG_EDIT)}}}getMetadataFor(t){return b(this,null,function*(){let e=this.cfg.metadata??this.$["*uploadMetadata"];if(typeof e=="function"){let r=this.getOutputItem(t);return yield e(r)}return e})}getUploadClientOptions(){return{store:this.cfg.store,publicKey:this.cfg.pubkey,baseCDN:this.cfg.cdnCname,baseURL:this.cfg.baseUrl,userAgent:Qi,integration:this.cfg.userAgentIntegration,secureSignature:this.cfg.secureSignature,secureExpire:this.cfg.secureExpire,retryThrottledRequestMaxTimes:this.cfg.retryThrottledRequestMaxTimes,multipartMinFileSize:this.cfg.multipartMinFileSize,multipartChunkSize:this.cfg.multipartChunkSize,maxConcurrentRequests:this.cfg.multipartMaxConcurrentRequests,multipartMaxAttempts:this.cfg.multipartMaxAttempts,checkForUrlDuplicates:!!this.cfg.checkForUrlDuplicates,saveUrlForRecurrentUploads:!!this.cfg.saveUrlForRecurrentUploads}}getOutputItem(t){let e=A.getCtx(t).store,r=e.fileInfo,o=e.isRemoved?"removed":e.errors.length>0?"failed":e.fileInfo?"success":e.isUploading?"uploading":"idle";return{uuid:r?.uuid??e.uuid??null,internalId:t,name:r?.originalFilename??e.fileName,size:r?.size??e.fileSize,isImage:r?.isImage??e.isImage,mimeType:r?.mimeType??e.mimeType,file:e.file,externalUrl:e.externalUrl,cdnUrlModifiers:e.cdnUrlModifiers,cdnUrl:e.cdnUrl??r?.cdnUrl??null,fullPath:e.fullPath,uploadProgress:e.uploadProgress,fileInfo:r??null,metadata:e.metadata??r?.metadata??null,isSuccess:o==="success",isUploading:o==="uploading",isFailed:o==="failed",isRemoved:o==="removed",errors:e.errors,status:o}}getOutputData(t){return(t?this.uploadCollection.findItems(t):this.uploadCollection.items()).map(o=>this.getOutputItem(o))}getOutputCollectionState(){return no(this)}};k.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});k.sourceTypes=Object.freeze(p({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw"},k.extSrcList));var He=i=>i.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g)?.map(t=>t.toLowerCase()).join("-");var F=i=>String(i),ie=i=>{let t=Number(i);if(Number.isNaN(t))throw new Error(`Invalid number: "${i}"`);return t},L=i=>{if(typeof i>"u"||i===null)return!1;if(typeof i=="boolean")return i;if(i==="true"||i==="")return!0;if(i==="false")return!1;throw new Error(`Invalid boolean: "${i}"`)},ra=i=>i==="auto"?i:L(i),ia=i=>{let t=F(i);if(t!=="user"&&t!=="environment"&&t!=="")throw new Error(`Invalid "cameraCapture" value: "${t}"`);return t},oa=i=>{if(typeof i=="object"&&!Array.isArray(i)||typeof i=="function")return i;throw new Error("Invalid metadata value. Must be an object or function.")},sa=i=>{if(typeof i=="object")return i;throw new Error("Invalid localeDefinitionOverride value. Must be an object.")},na={pubkey:F,multiple:L,multipleMin:ie,multipleMax:ie,confirmUpload:L,imgOnly:L,accept:F,externalSourcesPreferredTypes:F,store:ra,cameraMirror:L,cameraCapture:ia,sourceList:F,maxLocalFileSizeBytes:ie,thumbSize:ie,showEmptyList:L,useLocalImageEditor:L,useCloudImageEditor:L,cloudImageEditorTabs:F,removeCopyright:L,cropPreset:F,imageShrink:F,modalScrollLock:L,modalBackdropStrokes:L,sourceListWrap:L,remoteTabSessionKey:F,cdnCname:F,baseUrl:F,socialBaseUrl:F,secureSignature:F,secureExpire:F,secureDeliveryProxy:F,retryThrottledRequestMaxTimes:ie,multipartMinFileSize:ie,multipartChunkSize:ie,maxConcurrentRequests:ie,multipartMaxConcurrentRequests:ie,multipartMaxAttempts:ie,checkForUrlDuplicates:L,saveUrlForRecurrentUploads:L,groupOutput:L,userAgentIntegration:F,debug:L,localeName:F,metadata:oa,localeDefinitionOverride:sa},co=(i,t)=>{if(!(typeof t>"u"||t===null))try{return na[i](t)}catch(e){return console.error(`Invalid value for config key "${i}".`,e),Q[i]}};var Mr=[...new Set(["debug",...Object.keys(Q)])],aa=["metadata","localeDefinitionOverride"],la=i=>aa.includes(i),je=Mr.filter(i=>!la(i)),ca=p(p({},Object.fromEntries(je.map(i=>[He(i),i]))),Object.fromEntries(je.map(i=>[i.toLowerCase(),i]))),da=p(p({},Object.fromEntries(je.map(i=>[He(i),B(i)]))),Object.fromEntries(je.map(i=>[i.toLowerCase(),B(i)]))),ho=i=>"__"+i,ut=class extends _{requireCtxName=!0;constructor(){super(),this.init$=p(p({},this.init$),Object.fromEntries(Object.entries(Q).map(([t,e])=>[B(t),e])))}_flushValueToAttribute(t,e){if(je.includes(t)){let r=[...new Set([He(t),t.toLowerCase()])];for(let o of r)typeof e>"u"||e===null?this.removeAttribute(o):this.getAttribute(o)!==e.toString()&&this.setAttribute(o,e.toString())}}_flushValueToState(t,e){this.$[B(t)]!==e&&(typeof e>"u"||e===null?this.$[B(t)]=Q[t]:this.$[B(t)]=e)}_setValue(t,e){let r=this,o=co(t,e),s=ho(t);r[s]!==o&&(this._assertSameValueDifferentReference(t,r[s],o),r[s]=o,this._flushValueToAttribute(t,o),this._flushValueToState(t,o),this.debugPrint(`[lr-config] "${t}"`,o))}_getValue(t){let e=this,r=ho(t);return e[r]}_assertSameValueDifferentReference(t,e,r){this.cfg.debug&&JSON.stringify(r)===JSON.stringify(e)&&(console.warn(`[lr-config] Option "${t}" value is the same as the previous one but the reference is different`),console.warn("[lr-config] You should avoid changing the reference of the object to prevent unnecessary calculations"),console.warn(`[lr-config] "${t}" previous value:`,e),console.warn(`[lr-config] "${t}" new value:`,r))}initCallback(){super.initCallback();let t=this;for(let e of je)this.sub(B(e),r=>{this._setValue(e,r)},!1);for(let e of Mr){let r=t[e]??this.$[B(e)];r!==Q[e]&&this._setValue(e,r),Object.defineProperty(this,e,{set:o=>{this._setValue(e,o)},get:()=>this._getValue(e)})}}attributeChangedCallback(t,e,r){if(e===r)return;let o=this,s=ca[t];o[s]=r}};ut.bindAttributes(da);for(let i of Mr)ut.prototype[i]=void 0;var uo=ut;var Ur=(()=>{class i extends _{init$=g(p({},this.init$),{name:"",path:"",size:"24",viewBox:""});initCallback(){super.initCallback(),this.sub("name",e=>{if(!e)return;let r=this.getCssData(`--icon-${e}`);r&&(this.$.path=r)}),this.sub("path",e=>{if(!e)return;e.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=e):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${e}"></path>`)}),this.sub("size",e=>{this.$.viewBox=`0 0 ${e} ${e}`})}}return i.template=`
  <svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>
`,i})();Ur.bindAttributes({name:"name",size:"size"});var po=i=>[...new Set(i)];var mo=i=>Object.entries(i).filter(([t,e])=>e!==void 0&&e!=="").map(([t,e])=>t==="cdn-operations"||t==="analytics"?e:`${t}/${e}`);var ha="https://ucarecdn.com",pt=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:ha},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{},"cdn-operations":{},progressive:{},quality:{},"is-background-for":{},"is-preview-blur":{default:1}});var Ge="--lr-img-",Pr="unresolved";var Rr=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),Fr=3e3,zr=5e3,Dr=Object.freeze({PREVIEW:"PREVIEW",MAIN:"MAIN"});var fo=Object.create(null);for(let i in pt)fo[Ge+i]=pt[i]?.default||"";var qt=class extends Ee{cssInit$=fo;$$(t){return this.$[Ge+t]}set$$(t){for(let e in t)this.$[Ge+e]=t[e]}sub$$(t,e){this.sub(Ge+t,r=>{r===null||r===""||e(r)})}analyticsParams(){return`-/@clib/${at}/${lt}/lr-img/`}initAttributes(t){[...this.attributes].forEach(e=>{pt[e.name]||t.setAttribute(e.name,e.value)})}initIntersection(t,e){let r={root:null,rootMargin:"0px"};this._isnObserver=new IntersectionObserver(o=>{o.forEach(s=>{s.isIntersecting&&(e(),this._isnObserver.unobserve(t))})},r),this._isnObserver.observe(t),this._observed||(this._observed=new Set),this._observed.add(t)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach(t=>{this._isnObserver.unobserve(t)}),this._isnObserver=null),A.deleteCtx(this)}static get observedAttributes(){return Object.keys(pt)}attributeChangedCallback(t,e,r){window.setTimeout(()=>{this.$[Ge+t]=r})}};var Kt=class extends qt{_img=new Image;_imgPreview=new Image;_fmtAbs(t){return!t.includes("//")&&!Rr&&(t=new URL(t,document.baseURI).href),t}_validateSize(t){if(t?.trim()!==""){let e=t.match(/\d+/)[0],r=t.match(/[a-zA-Z]+/)[0],o=parseInt(e,10);if(Number(o)>zr&&this.hasFormatJPG)return zr+r;if(Number(o)>Fr&&!this.hasFormatJPG)return Fr+r}return t}_getCdnModifiers(t,e){let r={format:this.$$("format"),quality:this.$$("quality"),resize:this._validateSize(t),blur:e,"cdn-operations":this.$$("cdn-operations"),analytics:this.analyticsParams()};return N(...mo(r))}_getUrlBase(t="",e=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(Rr&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let r=this._getCdnModifiers(t,e);if(this.$$("src").startsWith(this.$$("cdn-cname")))return U(this.$$("src"),r);if(this.$$("cdn-cname")&&this.$$("uuid"))return this._proxyUrl(U(ve(this.$$("cdn-cname"),this.$$("uuid")),r));if(this.$$("uuid"))return this._proxyUrl(U(ve(this.$$("cdn-cname"),this.$$("uuid")),r));if(this.$$("proxy-cname"))return this._proxyUrl(U(this.$$("proxy-cname"),r,this._fmtAbs(this.$$("src"))));if(this.$$("pubkey"))return this._proxyUrl(U(`https://${this.$$("pubkey")}.ucr.io/`,r,this._fmtAbs(this.$$("src"))))}_proxyUrl(t){return this.$$("secure-delivery-proxy")?ot(this.$$("secure-delivery-proxy"),{previewUrl:t},{transform:r=>window.encodeURIComponent(r)}):t}_getElSize(t,e=1,r=!0){let o=t.getBoundingClientRect(),s=e*Math.round(o.width),n=r?"":e*Math.round(o.height);return s||n?`${s||""}x${n||""}`:null}_setupEventProxy(t){let e=o=>{o.stopPropagation();let s=new Event(o.type,o);this.dispatchEvent(s)},r=["load","error"];for(let o of r)t.addEventListener(o,e)}get img(){return this.hasPreviewImage||(this._setupConfigForImage({elNode:this._img}),this.appendChild(this._img)),this._img}get currentImg(){return this.hasPreviewImage?{type:Dr.PREVIEW,img:this._imgPreview}:{type:Dr.MAIN,img:this.img}}get hasPreviewImage(){return this.$$("is-preview-blur")}get bgSelector(){return this.$$("is-background-for")}get breakpoints(){if(this.$$("breakpoints")){let t=R(this.$$("breakpoints"));return po(t.map(e=>parseInt(e,10)))}else return null}get hasFormatJPG(){return this.$$("format").toLowerCase()==="jpeg"}renderBg(t){let e=new Set;e.add(`url("${this._getUrlBase(this._getElSize(t))}") 1x`),this.$$("hi-res-support")&&e.add(`url("${this._getUrlBase(this._getElSize(t,2))}") ${2}x`),this.$$("ultra-res-support")&&e.add(`url("${this._getUrlBase(this._getElSize(t,3))}") ${3}x`);let r=`image-set(${[...e].join(", ")})`;t.style.setProperty("background-image",r),t.style.setProperty("background-image","-webkit-"+r)}getSrcset(){let t=new Set;return this.breakpoints?this.breakpoints.forEach(e=>{t.add(this._getUrlBase(e+"x")+` ${this._validateSize(e+"w")}`),this.$$("hi-res-support")&&t.add(this._getUrlBase(e*2+"x")+` ${this._validateSize(e*2+"w")}`),this.$$("ultra-res-support")&&t.add(this._getUrlBase(e*3+"x")+` ${this._validateSize(e*3+"w")}`)}):(t.add(this._getUrlBase(this._getElSize(this.currentImg.img))+" 1x"),this.$$("hi-res-support")&&t.add(this._getUrlBase(this._getElSize(this.currentImg.img,2))+" 2x"),this.$$("ultra-res-support")&&t.add(this._getUrlBase(this._getElSize(this.currentImg.img,3))+" 3x")),[...t].join()}getSrc(){return this._getUrlBase()}get srcUrlPreview(){return this._getUrlBase("100x","100")}renderBackground(){[...document.querySelectorAll(this.bgSelector)].forEach(t=>{this.$$("intersection")?this.initIntersection(t,()=>{this.renderBg(t)}):this.renderBg(t)})}_appendURL({elNode:t,src:e,srcset:r}){e&&(t.src=e),r&&(t.srcset=r)}_setupConfigForImage({elNode:t}){this._setupEventProxy(t),this.initAttributes(t)}loaderImage({src:t,srcset:e,elNode:r}){return new Promise((o,s)=>{this._setupConfigForImage({elNode:r}),r.setAttribute(Pr,""),r.addEventListener("load",()=>{r.removeAttribute(Pr),o(r)}),r.addEventListener("error",()=>{s(!1)}),this._appendURL({elNode:r,src:t,srcset:e})})}renderImage(){return b(this,null,function*(){if(this.$$("intersection")){this.hasPreviewImage&&(this._setupConfigForImage({elNode:this._imgPreview}),this.appendChild(this._imgPreview)),this.initIntersection(this.currentImg.img,()=>b(this,null,function*(){this.hasPreviewImage&&(this._imgPreview.src=this.srcUrlPreview);try{yield this.loaderImage({src:this.getSrc(),srcset:this.getSrcset(),elNode:this._img}),this.hasPreviewImage&&(yield this._imgPreview.remove()),this.appendChild(this._img)}catch{this.hasPreviewImage&&(yield this._imgPreview?.remove()),this.appendChild(this._img)}}));return}try{this.hasPreviewImage&&(yield this.loaderImage({src:this.srcUrlPreview,elNode:this._imgPreview}),this.appendChild(this._imgPreview)),yield this.loaderImage({src:this.getSrc(),srcset:this.getSrcset(),elNode:this._img}),this.hasPreviewImage&&(yield this._imgPreview?.remove()),this.appendChild(this._img)}catch{this.hasPreviewImage&&(yield this._imgPreview?.remove()),this.appendChild(this._img)}})}init(){this.bgSelector?this.renderBackground():this.renderImage()}};var Yt=class extends Kt{initCallback(){super.initCallback(),this.sub$$("src",()=>{this.init()}),this.sub$$("uuid",()=>{this.init()}),this.sub$$("lazy",t=>{!this.$$("is-background-for")&&!this.$$("is-preview-blur")&&(this.img.loading=t?"lazy":"eager")})}};var Nr=(()=>{class i extends k{couldBeCtxOwner=!0;constructor(){super(),this.init$=g(p({},this.init$),{withDropZone:!0,onClick:()=>{this.initFlow()},"button-text":""})}initCallback(){super.initCallback(),this.defineAccessor("dropzone",e=>{typeof e>"u"||(this.$.withDropZone=L(e))}),this.subConfigValue("multiple",e=>{this.$["button-text"]=e?"upload-files":"upload-file"})}}return i.template=`
  <lr-drop-area set="@disabled: !withDropZone">
    <button type="button" set="onclick: onClick">
      <lr-icon name="upload"></lr-icon>
      <span l10n="button-text"></span>
      <slot></slot>
      <div class="visual-drop-area" l10n="drop-files-here"></div>
    </button>
  </lr-drop-area>
`,i})();Nr.bindAttributes({dropzone:null});var go=(()=>{class i extends v{historyTracked=!0;activityType="start-from";initCallback(){super.initCallback(),this.registerActivity(this.activityType)}}return i.template=' <div class="content"><slot></slot></div> ',i})();function ua(i){return new Promise(t=>{typeof window.FileReader!="function"&&t(!1);try{let e=new FileReader;e.onerror=()=>{t(!0)};let r=o=>{o.type!=="loadend"&&e.abort(),t(!1)};e.onloadend=r,e.onprogress=r,e.readAsDataURL(i)}catch{t(!1)}})}function pa(i,t){return new Promise(e=>{let r=0,o=[],s=a=>{a||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),e(null)),a.isFile?(r++,a.file(l=>{r--;let c=new File([l],l.name,{type:l.type||t});o.push({type:"file",file:c,fullPath:a.fullPath}),r===0&&e(o)})):a.isDirectory&&n(a.createReader())},n=a=>{r++,a.readEntries(l=>{r--;for(let c of l)s(c);r===0&&e(o)})};s(i)})}function bo(i){let t=[],e=[];for(let r=0;r<i.items.length;r++){let o=i.items[r];if(o)if(o.kind==="file"){let s=o.type;if(typeof o.webkitGetAsEntry=="function"||typeof o.getAsEntry=="function"){let a=typeof o.webkitGetAsEntry=="function"?o.webkitGetAsEntry():o.getAsEntry();e.push(pa(a,s).then(l=>{l&&t.push(...l)}));continue}let n=o.getAsFile();n&&e.push(ua(n).then(a=>{a||t.push({type:"file",file:n})}))}else o.kind==="string"&&o.type.match("^text/uri-list")&&e.push(new Promise(s=>{o.getAsString(n=>{t.push({type:"url",url:n}),s(void 0)})}))}return Promise.all(e).then(()=>t)}var V={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3},vo=["focus"],ma=100,Vr=new Map;function fa(i,t){let e=Math.max(Math.min(i[0],t.x+t.width),t.x),r=Math.max(Math.min(i[1],t.y+t.height),t.y);return Math.sqrt((i[0]-e)*(i[0]-e)+(i[1]-r)*(i[1]-r))}function Br(i){let t=0,e=document.body,r=new Set,o=m=>r.add(m),s=V.INACTIVE,n=m=>{i.shouldIgnore()&&m!==V.INACTIVE||(s!==m&&r.forEach(y=>y(m)),s=m)},a=()=>t>0;o(m=>i.onChange(m));let l=()=>{t=0,n(V.INACTIVE)},c=()=>{t+=1,s===V.INACTIVE&&n(V.ACTIVE)},d=()=>{t-=1,a()||n(V.INACTIVE)},h=m=>{m.preventDefault(),t=0,n(V.INACTIVE)},u=m=>{if(i.shouldIgnore())return;a()||(t+=1);let y=[m.x,m.y],S=i.element.getBoundingClientRect(),E=Math.floor(fa(y,S)),w=E<ma,T=m.composedPath().includes(i.element);Vr.set(i.element,E);let Y=Math.min(...Vr.values())===E;T&&Y?(m.preventDefault(),n(V.OVER)):n(w&&Y?V.NEAR:V.ACTIVE)},f=m=>b(this,null,function*(){if(i.shouldIgnore())return;m.preventDefault();let y=yield bo(m.dataTransfer);i.onItems(y),n(V.INACTIVE)});return e.addEventListener("drop",h),e.addEventListener("dragleave",d),e.addEventListener("dragenter",c),e.addEventListener("dragover",u),i.element.addEventListener("drop",f),vo.forEach(m=>{window.addEventListener(m,l)}),()=>{Vr.delete(i.element),e.removeEventListener("drop",h),e.removeEventListener("dragleave",d),e.removeEventListener("dragenter",c),e.removeEventListener("dragover",u),i.element.removeEventListener("drop",f),vo.forEach(m=>{window.removeEventListener(m,l)})}}var _o="lr-drop-area",We=`${_o}/registry`,Hr=(()=>{class i extends k{constructor(){super(),this.init$=g(p({},this.init$),{state:V.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isEnabled:!0,isVisible:!0,text:"",[We]:null})}isActive(){if(!this.$.isEnabled)return!1;let e=this.getBoundingClientRect(),r=e.width>0&&e.height>0,o=e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth),s=window.getComputedStyle(this),n=s.visibility!=="hidden"&&s.display!=="none";return r&&n&&o}initCallback(){super.initCallback(),this.bindL10n("text",()=>this.l10n("drop-files-here")),this.$[We]||(this.$[We]=new Set),this.$[We].add(this),this.defineAccessor("disabled",r=>{this.set$({isEnabled:!L(r)})}),this.defineAccessor("clickable",r=>{this.set$({isClickable:L(r)})}),this.defineAccessor("with-icon",r=>{this.set$({withIcon:L(r)})}),this.defineAccessor("fullscreen",r=>{this.set$({isFullscreen:L(r)})}),this.defineAccessor("text",r=>{typeof r=="string"?this.bindL10n("text",()=>this.l10n(r)||r):this.bindL10n("text",()=>this.l10n("drop-files-here"))}),this._destroyDropzone=Br({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:r=>{this.$.state=r},onItems:r=>{r.length&&(r.forEach(o=>{o.type==="url"?this.addFileFromUrl(o.url,{source:j.DROP_AREA}):o.type==="file"&&this.addFileFromObject(o.file,{source:j.DROP_AREA,fullPath:o.fullPath})}),this.uploadCollection.size&&(this.set$({"*currentActivity":v.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0)))}});let e=this.ref["content-wrapper"];e&&(this._destroyContentWrapperDropzone=Br({element:e,onChange:r=>{let o=Object.entries(V).find(([,s])=>s===r)?.[0].toLowerCase();o&&e.setAttribute("drag-state",o)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",r=>{let o=Object.entries(V).find(([,s])=>s===r)?.[0].toLowerCase();o&&this.setAttribute("drag-state",o)}),this.subConfigValue("sourceList",r=>{let o=R(r);this.$.isEnabled=o.includes(k.sourceTypes.LOCAL),this.$.isVisible=this.$.isEnabled||!this.querySelector("[data-default-slot]")}),this.sub("isVisible",r=>{this.toggleAttribute("hidden",!r)}),this.sub("isClickable",r=>{this.toggleAttribute("clickable",r)}),this.$.isClickable&&(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return!this.$.isEnabled||!this._couldHandleFiles()?!0:this.$.isFullscreen?[...this.$[We]].filter(o=>o!==this).filter(o=>o.isActive()).length>0:!1}_couldHandleFiles(){let e=this.cfg.multiple,r=this.cfg.multipleMax,o=this.uploadCollection.size;return!(e&&r&&o>=r||!e&&o>0)}destroyCallback(){super.destroyCallback();let e=this.$[We];e&&(e.delete(this),e.size===0&&A.deleteCtx(_o)),this._destroyDropzone?.(),this._destroyContentWrapperDropzone?.(),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}}return i.template=`
  <slot>
    <div data-default-slot hidden></div>
    <div ref="content-wrapper" class="content-wrapper" set="@hidden: !isVisible">
      <div class="icon-container" set="@hidden: !withIcon">
        <lr-icon name="default"></lr-icon>
        <lr-icon name="arrow-down"></lr-icon>
      </div>
      <span class="text">{{text}}</span>
    </div>
  </slot>
`,i})();Hr.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null});var ga="src-type-",jr=(()=>{class i extends k{couldBeCtxOwner=!0;type=void 0;_registeredTypes={};constructor(){super(),this.init$=g(p({},this.init$),{iconName:"default","src-type":""})}initTypes(){this.registerType({type:k.sourceTypes.LOCAL,activate:()=>(this.openSystemDialog(),!1)}),this.registerType({type:k.sourceTypes.URL,activity:v.activities.URL,textKey:"from-url"}),this.registerType({type:k.sourceTypes.CAMERA,activity:v.activities.CAMERA,activate:()=>{let e="capture"in document.createElement("input");return e&&this.openSystemDialog({captureCamera:!0}),!e}}),this.registerType({type:"draw",activity:v.activities.DRAW,icon:"edit-draw"});for(let e of Object.values(k.extSrcList))this.registerType({type:e,activity:v.activities.EXTERNAL,activityParams:{externalSourceType:e}})}initCallback(){super.initCallback(),this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",e=>{e&&this.applyType(e)})}registerType(e){this._registeredTypes[e.type]=e}getType(e){return this._registeredTypes[e]}activate(){if(!this.type)return;let e=this._registeredTypes[this.type],{activity:r,activate:o,activityParams:s={}}=e;(o?o():!!r)&&this.set$({"*currentActivityParams":s,"*currentActivity":r})}applyType(e){let r=this._registeredTypes[e];if(!r){console.warn("Unsupported source type: "+e);return}let{textKey:o=e,icon:s=e}=r;this.$["src-type"]=`${ga}${o}`,this.$.iconName=s,this.onclick=()=>{this.activate()}}}return i.template=`
  <lr-icon set="@name: iconName"></lr-icon>
  <div class="txt" l10n="src-type"></div>
`,i})();jr.bindAttributes({type:null});var Jt=class extends _{initCallback(){super.initCallback(),this.subConfigValue("sourceList",t=>{let e=R(t),r="";e.forEach(o=>{r+=`<lr-source-btn type="${o}"></lr-source-btn>`}),this.cfg.sourceListWrap?this.innerHTML=r:this.outerHTML=r})}};var er=()=>{let i=[];return{stack:i,promiseReadJpegChunks:e=>new Promise((r,o)=>{let s=2,n=(c,d)=>{let h=new FileReader;h.addEventListener("load",()=>{d(new DataView(h.result))}),h.addEventListener("error",u=>{o(`Reader error: ${u}`)}),h.readAsArrayBuffer(c)},a=()=>n(e.slice(s,s+128),c=>{let d,h,u;for(d=h=0,u=c.byteLength;u>=0?h<u:h>u;d=u>=0?++h:--h)if(c.getUint8(d)===255){s+=d;break}l()}),l=()=>{let c=s;return n(e.slice(s,s+=4),d=>{if(d.byteLength!==4||d.getUint8(0)!==255){o("Corrupted");return}let h=d.getUint8(1);if(h===218){r(!0);return}let u=d.getUint16(2)-2;return n(e.slice(s,s+=u),f=>{if(f.byteLength!==u){o("Corrupted");return}i.push({startPos:c,length:u,marker:h,view:f}),a()})})};FileReader&&DataView||o("Not Support"),n(e.slice(0,2),c=>{c.getUint16(0)!==65496&&o("Not jpeg"),a()})})}},ba=i=>b(void 0,null,function*(){let t=[],{promiseReadJpegChunks:e,stack:r}=er();return yield e(i),r.forEach(({marker:o,view:s})=>{o===226&&s.getUint32(0)===1229144927&&s.getUint32(4)===1347571526&&s.getUint32(8)===1229735168&&t.push(s)}),t}),wo=(i,t,e)=>b(void 0,null,function*(){{let r=[],o=[],{promiseReadJpegChunks:s,stack:n}=er();yield s(i),n.forEach(c=>{if(c.marker===t)return r.push(c.startPos),o.push(c.length)});let a=[i.slice(0,2)];for(let c of e){let d=new DataView(new ArrayBuffer(4));d.setUint16(0,65280+t),d.setUint16(2,c.byteLength+2),a.push(d.buffer),a.push(c)}let l=2;for(let c=0;c<r.length;c++)r[c]>l&&a.push(i.slice(l,r[c])),l=r[c]+o[c]+4;return a.push(i.slice(l,i.size)),new Blob(a,{type:i.type})}});var xo=(i,t)=>wo(i,226,t.map(e=>e.buffer)),va=i=>b(void 0,null,function*(){try{return yield xo(i,[])}catch(t){throw new Error(`Failed to strip ICC profile: ${t}`)}}),_a=(i,t,e)=>new Promise((r,o)=>{let s=n=>{if(!n){o("Failed to convert canvas to blob");return}r(n)};i.toBlob(s,t,e),i.width=i.height=1}),mt=()=>{let i=document.createElement("canvas"),t=i.getContext("2d");return{canvas:i,ctx:t}},ya=i=>{let{ctx:e,canvas:r}=mt();r.width=r.height=50,e.drawImage(i,0,0,50,50);let o=e.getImageData(0,0,50,50).data;r.width=r.height=1;for(let s=3;s<o.length;s+=4)if(o[s]<254)return!0;return!1},wa=i=>b(void 0,null,function*(){let t=null,{promiseReadJpegChunks:e,stack:r}=er();return yield e(i),r.forEach(({marker:o,view:s})=>{if(!t&&o===225&&s.byteLength>=14&&s.getUint32(0)===1165519206&&s.getUint16(4)===0){t=s;return}}),t}),xa="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=",Qt,Ca=()=>new Promise(i=>{if(Qt!==void 0)i(Qt);else{let t=new Image;t.addEventListener("load",()=>{Qt=t.naturalWidth<t.naturalHeight,t.src="//:0",i(Qt)}),t.src=xa}}),Aa=(i,t)=>{let e,r,o,s;if(!i||i.byteLength<14||i.getUint32(0)!==1165519206||i.getUint16(4)!==0)return;if(i.getUint16(6)===18761)r=!0;else if(i.getUint16(6)===19789)r=!1;else return;if(i.getUint16(8,r)!==42)return;o=8+i.getUint32(10,r);let n=i.getUint16(o-2,r);for(e=0,s=n;s>=0?e<s:e>s;s>=0?++e:--e){if(i.byteLength<o+10)return;i.getUint16(o,r)===274&&t(o+8,r),o+=12}},Ea=(i,t)=>{Aa(i,(e,r)=>i.setUint16(e,t,r))},ka=(i,t,e)=>b(void 0,null,function*(){return e&&Ea(t,1),wo(i,225,[t.buffer])}),Ta=(i,t)=>new Promise((e,r)=>{t&&(i.src=t),i.complete?e(i):(i.addEventListener("load",()=>{e(i)}),i.addEventListener("error",()=>{r(new Error("Failed to load image. Probably not an image."))}))}),Sa=i=>Ta(new Image,i),Ia=[1,3],$a=[192,193,194,195,197,198,199,201,202,203,205,206,207],yo={squareSide:[Math.floor(Math.sqrt(5*1e3*1e3)),4096,8192,11180,10836,11402,14188,16384],dimension:[4096,8192,16384,32767,65535]},Oa=i=>b(void 0,null,function*(){let t=!1,{promiseReadJpegChunks:e,stack:r}=er();return yield e(i).then(()=>(r.forEach(({marker:o,view:s})=>{if(!t&&$a.indexOf(o)>=0){let n=s.getUint8(5);Ia.indexOf(n)<0&&(t=!0)}}),t)).catch(()=>t)}),Co=(i,t)=>{let e={};return(...r)=>{let o=t(r,e);return o in e?e[o]:e[o]=i(...r)}},Ao=(i,t)=>{let[e]=i,r=Object.keys(t).map(o=>parseInt(o,10)).sort((o,s)=>o-s);for(let o=0;o<r.length;o++){let s=r[o],n=!!t[s];if(s>e&&n||s<e&&!n)return s}return e},we={R:55,G:110,B:165,A:255},La=`rgba(${we.R}, ${we.G}, ${we.B}, ${we.A/255})`,Eo=(i,t)=>{try{let e=[i-1,t-1,1,1],{canvas:r,ctx:o}=mt();r.width=1,r.height=1;let{canvas:s,ctx:n}=mt();s.width=i,s.height=t,n&&(n.fillStyle=La,n.fillRect(...e),o.drawImage(s,i-1,t-1,1,1,0,0,1,1));let a=o&&o.getImageData(0,0,1,1).data,l=!1;return a&&(l=a[0]===we.R&&a[1]===we.G&&a[2]===we.B&&a[3]===we.A),s.width=s.height=1,l}catch{return console.error(`Failed to test for max canvas size of ${i}x${t}.`),!1}};function ko(i){return(...t)=>new Promise(e=>{setTimeout(()=>{let r=i(...t);e(r)},0)})}var Ma=ko(Co(Eo,Ao)),Ua=ko(Co(Eo,Ao)),To=(i,t)=>b(void 0,null,function*(){let e=yo.squareSide.find(n=>n*n>=i*t),r=yo.dimension.find(n=>n>=i&&n>=t);if(!e||!r)throw new Error("Not supported");let[o,s]=yield Promise.all([Ma(e,e),Ua(r,1)]);if(o&&s)return!0;throw new Error("Not supported")}),So=(i,t,e)=>b(void 0,null,function*(){try{let{ctx:r,canvas:o}=mt();return o.width=t,o.height=e,r.imageSmoothingQuality="high",r.drawImage(i,0,0,t,e),i instanceof HTMLImageElement&&(i.src="//:0"),i instanceof HTMLCanvasElement&&(i.width=i.height=1),o}catch(r){throw new Error("Canvas resize error",{cause:r})}}),Pa=({img:i,targetW:t,targetH:e})=>So(i,t,e),Ra=function({sourceW:i,targetW:t,targetH:e,step:r}){let o=[],s=t,n=e;do o.push([s,n]),s=Math.round(s/r),n=Math.round(n/r);while(s<i*r);return o.reverse()},Fa=({img:i,sourceW:t,targetW:e,targetH:r,step:o})=>Ra({sourceW:t,targetW:e,targetH:r,step:o}).reduce((n,[a,l])=>n.then(c=>To(a,l).then(()=>So(c,a,l)).catch(()=>c)),Promise.resolve(i)),za=()=>/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),Da=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),Gr=.71,Na=(i,t)=>{if(i.width*Gr*i.height*Gr<t.size)throw new Error("Not required");let e=i.width,r=i.height,o=e/r,s=Math.floor(Math.sqrt(t.size*o)),n=Math.floor(t.size/Math.sqrt(t.size*o));return To(s,n).then(()=>{let{ctx:a}=mt();return"imageSmoothingQuality"in a&&!za()&&!Da?Pa({img:i,targetW:s,targetH:n}):Fa({img:i,sourceW:e,targetW:s,targetH:n,step:Gr})}).catch(()=>Promise.reject("Not supported"))},Io=(i,t)=>b(void 0,null,function*(){try{if(yield Oa(i))throw new Error("Should skipped");let r=yield Promise.allSettled([wa(i),Ca(),ba(i)]),s=!r.some(y=>y.status==="rejected"),[n,a,l]=r,c=yield va(i).catch(()=>i),d=yield Sa(URL.createObjectURL(c));URL.revokeObjectURL(d.src);let h=yield Na(d,t),u="image/jpeg",f=t?.quality||.8;!s&&ya(h)&&(u="image/png",f=void 0);let m=yield _a(h,u,f);if(s&&n.status==="fulfilled"&&n.value){let y=n.value,S=a.status==="fulfilled"?a.value:!1;m=yield ka(m,y,S)}return s&&l.status==="fulfilled"&&l.value.length>0&&(m=yield xo(m,l.value)),m}catch(e){let r;throw e instanceof Error&&(r=e.message),typeof e=="string"&&(r=e),new Error(`Failed to shrink image. ${r?`Message: "${r}".`:""}`,{cause:e})}});function $o(i){let t=new Blob([i],{type:"image/svg+xml"});return URL.createObjectURL(t)}function Oo(i="#fff",t="rgba(0, 0, 0, .1)"){return $o(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
    <rect x="0" y="0" width="20" height="20" fill="${i}" />
    <rect x="0" y="0" width="10" height="10" fill="${t}" />
    <rect x="10" y="10" width="10" height="10" fill="${t}" />
  </svg>`)}function Wr(i="hsl(209, 21%, 65%)",t=32,e=32){return $o(`
  <svg width="${t}" height="${e}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" fill="${i}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/>
  </svg>
  `)}function Lo(i,t=40){if(i.type==="image/svg+xml")return URL.createObjectURL(i);let e=document.createElement("canvas"),r=e.getContext("2d"),o=new Image,s=new Promise((n,a)=>{o.onload=()=>{let l=o.height/o.width;l>1?(e.width=t,e.height=t*l):(e.height=t,e.width=t/l),r.fillStyle="rgb(240, 240, 240)",r.fillRect(0,0,e.width,e.height),r.drawImage(o,0,0,e.width,e.height),e.toBlob(c=>{if(!c){a();return}let d=URL.createObjectURL(c);n(d)})},o.onerror=l=>{a(l)}});return o.src=URL.createObjectURL(i),s}var Va=/^([0-9]+)x([0-9]+)(?:\s+(\d{1,2}|100)%)?$/i,Mo=i=>{let t=Va.exec(i?.toLocaleLowerCase())||[];if(!t.length)return!1;let e=t[1]*t[2],r=16384*16384;return e>r?(console.warn(`Shrinked size can not be larger than ${Math.floor(r/1e3/1e3)}MP. You have set ${t[1]}x${t[2]} (${Math.ceil(e/1e3/100)/10}MP).`),!1):{quality:t[3]?t[3]/100:void 0,size:e}};var K=Object.freeze({FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3)}),qe=class i extends k{couldBeCtxOwner=!0;pauseRender=!0;_entrySubs=new Set;_entry=null;_isIntersecting=!1;_debouncedGenerateThumb=M(this._generateThumbnail.bind(this),100);_debouncedCalculateState=M(this._calculateState.bind(this),100);_renderedOnce=!1;constructor(){super(),this.init$=g(p({},this.init$),{uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,progressVisible:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,state:K.IDLE,onEdit:()=>{this.set$({"*focusedEntry":this._entry}),this.hasBlockInCtx(t=>t.activityType===v.activities.DETAILS)?this.$["*currentActivity"]=v.activities.DETAILS:this.$["*currentActivity"]=v.activities.CLOUD_IMG_EDIT},onRemove:()=>{this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}})}_reset(){for(let t of this._entrySubs)t.remove();this._debouncedGenerateThumb.cancel(),this._debouncedCalculateState.cancel(),this._entrySubs=new Set,this._entry=null}_observerCallback(t){let[e]=t;this._isIntersecting=e.isIntersecting,e.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),e.intersectionRatio===0?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){if(!this._entry)return;let t=this._entry,e=K.IDLE;t.getValue("errors").length>0?e=K.FAILED:t.getValue("isUploading")?e=K.UPLOADING:t.getValue("fileInfo")&&(e=K.FINISHED),this.$.state=e}_generateThumbnail(){return b(this,null,function*(){if(!this._entry)return;let t=this._entry;if(t.getValue("fileInfo")&&t.getValue("isImage")){let e=this.cfg.thumbSize,r=this.proxyUrl(U(ve(this.cfg.cdnCname,this._entry.getValue("uuid")),N(t.getValue("cdnUrlModifiers"),`scale_crop/${e}x${e}/center`))),o=t.getValue("thumbUrl");o!==r&&(t.setValue("thumbUrl",r),o?.startsWith("blob:")&&URL.revokeObjectURL(o));return}if(!t.getValue("thumbUrl"))if(t.getValue("file")?.type.includes("image"))try{let e=yield Lo(t.getValue("file"),this.cfg.thumbSize);t.setValue("thumbUrl",e)}catch{let r=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",Wr(r))}else{let e=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",Wr(e))}})}_subEntry(t,e){let r=this._entry.subscribe(t,o=>{this.isConnected&&e(o)});this._entrySubs.add(r)}_handleEntryId(t){this._reset();let e=this.uploadCollection?.read(t);this._entry=e,e&&(this._subEntry("uploadProgress",r=>{this.$.progressValue=r}),this._subEntry("fileName",r=>{this.$.itemName=r||e.getValue("externalUrl")||this.l10n("file-no-name"),this._debouncedCalculateState()}),this._subEntry("externalUrl",r=>{this.$.itemName=e.getValue("fileName")||r||this.l10n("file-no-name")}),this._subEntry("fileInfo",r=>{this._debouncedCalculateState(),r&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",r=>{this.$.thumbUrl=r?`url(${r})`:""}),this._subEntry("errors",()=>this._debouncedCalculateState()),this._subEntry("isUploading",()=>this._debouncedCalculateState()),this._subEntry("fileSize",()=>this._debouncedCalculateState()),this._subEntry("mimeType",()=>this._debouncedCalculateState()),this._subEntry("isImage",()=>this._debouncedCalculateState()),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",t=>{this._handleEntryId(t)}),this.sub("state",t=>{this._handleState(t)}),this.subConfigValue("useCloudImageEditor",()=>this._debouncedCalculateState()),this.onclick=()=>{i.activeInstances.forEach(t=>{t===this?t.setAttribute("focused",""):t.removeAttribute("focused")})},this.sub("*uploadTrigger",t=>{t.has(this._entry.uid)&&setTimeout(()=>this.isConnected&&this.upload())}),i.activeInstances.add(this)}_handleState(t){t===K.FAILED?this.$.badgeIcon="badge-error":t===K.FINISHED&&(this.$.badgeIcon="badge-success"),t===K.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0,this.set$({isFailed:t===K.FAILED,isUploading:t===K.UPLOADING,isFinished:t===K.FINISHED,progressVisible:t===K.UPLOADING,isEditable:this.cfg.useCloudImageEditor&&this._entry?.getValue("isImage")&&this._entry?.getValue("cdnUrl"),errorText:this._entry.getValue("errors")?.[0]?.message})}destroyCallback(){super.destroyCallback(),i.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),this._observer?.disconnect()}_settingsOfShrink(){return Mo(this.cfg.imageShrink)}_processShrink(t){return Io(t,this._settingsOfShrink())}upload(){return b(this,null,function*(){let t=this._entry;if(!this.uploadCollection.read(t.uid)||t.getValue("fileInfo")||t.getValue("isUploading")||t.getValue("errors").length>0)return;let e=this.cfg.multiple?this.cfg.multipleMax:1;if(!(e&&this.uploadCollection.size>e)){this._debouncedCalculateState(),t.setValue("isUploading",!0),t.setValue("errors",[]);try{let r=new AbortController;t.setValue("abortController",r);let o=()=>b(this,null,function*(){let n=t.getValue("file");n&&this.cfg.imageShrink&&(n=yield this._processShrink(n).catch(()=>n));let a=n||t.getValue("externalUrl")||t.getValue("uuid"),l=this.getUploadClientOptions(),c=g(p({},l),{fileName:t.getValue("fileName"),source:t.getValue("source"),onProgress:d=>{if(d.isComputable){let h=d.value*100;t.setValue("uploadProgress",h)}},signal:r.signal,metadata:yield this.getMetadataFor(t.uid)});return this.debugPrint("upload options",a,c),Cr(a,c)}),s=yield this.$["*uploadQueue"].add(o);t.setMultipleValues({fileInfo:s,isUploading:!1,fileName:s.originalFilename,fileSize:s.size,isImage:s.isImage,mimeType:s.contentInfo?.mime?.mime??s.mimeType,uuid:s.uuid,cdnUrl:t.getValue("cdnUrl")??s.cdnUrl,cdnUrlModifiers:t.getValue("cdnUrlModifiers")??"",uploadProgress:100}),t===this._entry&&this._debouncedCalculateState()}catch(r){r instanceof fe&&r.isCancel?t.setMultipleValues({isUploading:!1,uploadProgress:0}):t.setMultipleValues({isUploading:!1,uploadProgress:0,uploadError:r}),t===this._entry&&this._debouncedCalculateState()}}})}};qe.template=`
  <div class="inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @focused: isFocused">
    <div class="thumb" set="style.backgroundImage: thumbUrl">
      <div class="badge">
        <lr-icon set="@name: badgeIcon"></lr-icon>
      </div>
    </div>
    <div class="file-name-wrapper">
      <span class="file-name" set="@title: itemName">{{itemName}}</span>
      <span class="file-error" set="@hidden: !errorText">{{errorText}}</span>
    </div>
    <div class="file-actions">
      <button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable">
        <lr-icon name="edit-file"></lr-icon>
      </button>
      <button type="button" class="remove-btn mini-btn" set="onclick: onRemove;">
        <lr-icon name="remove-file"></lr-icon>
      </button>
      <button type="button" class="upload-btn mini-btn" set="onclick: onUpload;">
        <lr-icon name="upload"></lr-icon>
      </button>
    </div>
    <lr-progress-bar class="progress-bar" set="value: progressValue; visible: progressVisible;"> </lr-progress-bar>
  </div>
`;qe.activeInstances=new Set;var Uo=(()=>{class i extends _{static StateConsumerScope="modal";constructor(){super(),this.init$=g(p({},this.init$),{"*modalActive":!1,isOpen:!1,closeClicked:this._handleDialogClose})}_handleBackdropClick=()=>{this._closeDialog()};_closeDialog=()=>{this.setOrAddState("*modalActive",!1)};_handleDialogClose=()=>{this._closeDialog()};_handleDialogMouseDown=e=>{this._mouseDownTarget=e.target};_handleDialogMouseUp=e=>{e.target===this.ref.dialog&&e.target===this._mouseDownTarget&&this._closeDialog()};show(){this.ref.dialog.showModal?this.ref.dialog.showModal():this.ref.dialog.setAttribute("open","")}hide(){this.ref.dialog.close?this.ref.dialog.close():this.ref.dialog.removeAttribute("open")}initCallback(){if(super.initCallback(),typeof HTMLDialogElement=="function")this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.addEventListener("mouseup",this._handleDialogMouseUp);else{this.setAttribute("dialog-fallback","");let e=document.createElement("div");e.className="backdrop",this.appendChild(e),e.addEventListener("click",this._handleBackdropClick)}this.sub("*modalActive",e=>{this.$.isOpen!==e&&(this.$.isOpen=e),e&&this.cfg.modalScrollLock?document.body.style.overflow="hidden":document.body.style.overflow=""}),this.subConfigValue("modalBackdropStrokes",e=>{e?this.setAttribute("strokes",""):this.removeAttribute("strokes")}),this.sub("isOpen",e=>{e?this.show():this.hide()})}destroyCallback(){super.destroyCallback(),document.body.style.overflow="",this._mouseDownTarget=void 0,this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.removeEventListener("mouseup",this._handleDialogMouseUp)}}return i.template=`
  <dialog ref="dialog">
    <slot></slot>
  </dialog>
`,i})();var tr=(i,t)=>{let e,r,o,s=(...n)=>{e?(clearTimeout(r),r=setTimeout(()=>{Date.now()-o>=t&&(i(...n),o=Date.now())},Math.max(t-(Date.now()-o),0))):(i(...n),o=Date.now(),e=!0)};return Object.defineProperty(s,"cancel",{configurable:!1,writable:!1,enumerable:!1,value:()=>{clearTimeout(r)}}),s};var Po=(()=>{class i extends k{couldBeCtxOwner=!0;historyTracked=!0;activityType=v.activities.UPLOAD_LIST;constructor(){super(),this.init$=g(p({},this.init$),{doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",commonErrorMessage:"",hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.emit($.UPLOAD_CLICK),this.uploadAll(),this._throttledHandleCollectionUpdate()},onDone:()=>{this.emit($.DONE_CLICK,this.getOutputCollectionState()),this.doneFlow()},onCancel:()=>{this.uploadCollection.clearAll()}})}_throttledHandleCollectionUpdate=tr(()=>{this.isConnected&&(this._updateUploadsState(),!this.couldOpenActivity&&this.$["*currentActivity"]===this.activityType&&this.historyBack())},300);_updateUploadsState(){let e=this.getOutputCollectionState(),r={total:e.totalCount,succeed:e.successCount,uploading:e.uploadingCount,failed:e.failedCount},o=!e.errors.some(u=>u.type==="TOO_MANY_FILES"||u.type==="TOO_FEW_FILES"),s=e.errors.some(u=>u.type==="TOO_MANY_FILES"),n=e.totalCount===(this.cfg.multiple?this.cfg.multipleMax:1),a=r.failed===0,l=!1,c=!1,d=!1;r.total-r.succeed-r.uploading-r.failed>0&&o?l=!0:(c=!0,d=r.total===r.succeed&&o&&a),this.set$({doneBtnVisible:c,doneBtnEnabled:d,uploadBtnVisible:l,addMoreBtnEnabled:r.total===0||!s&&!n,addMoreBtnVisible:!n||this.cfg.multiple}),this.bindL10n("headerText",()=>this._getHeaderText(r))}_getHeaderText(e){let r=o=>{let s=e[o];return this.l10n(`header-${o}`,{count:s})};return e.uploading>0?r("uploading"):e.failed>0?r("failed"):e.succeed>0?r("succeed"):r("total")}get couldOpenActivity(){return this.cfg.showEmptyList||this.uploadCollection.size>0}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.subConfigValue("multiple",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMin",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMax",this._throttledHandleCollectionUpdate),this.sub("*currentActivity",e=>{!this.couldOpenActivity&&e===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observeProperties(this._throttledHandleCollectionUpdate),this.sub("*uploadList",e=>{this._throttledHandleCollectionUpdate(),this.set$({hasFiles:e.length>0}),this.cfg.confirmUpload||this.uploadAll()},!1),this.sub("*collectionErrors",e=>{let r=e.filter(o=>o.type!=="SOME_FILES_HAS_ERRORS")[0];if(!r){this.set$({commonErrorMessage:null});return}this.set$({commonErrorMessage:r.message})})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._throttledHandleCollectionUpdate)}}return i.template=`
  <lr-activity-header>
    <span class="header-text">{{headerText}}</span>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>

  <div class="no-files" set="@hidden: hasFiles">
    <slot name="empty"><span l10n="no-files"></span></slot>
  </div>

  <div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item"></div>

  <div class="common-error" set="@hidden: !commonErrorMessage; textContent: commonErrorMessage;"></div>

  <div class="toolbar">
    <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button>
    <div class="toolbar-spacer"></div>
    <button
      type="button"
      class="add-more-btn secondary-btn"
      set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible"
    >
      <lr-icon name="add"></lr-icon><span l10n="add-more"></span>
    </button>
    <button
      type="button"
      class="upload-btn primary-btn"
      set="@hidden: !uploadBtnVisible; onclick: onUpload;"
      l10n="upload"
    ></button>
    <button
      type="button"
      class="done-btn primary-btn"
      set="@hidden: !doneBtnVisible; onclick: onDone;  @disabled: !doneBtnEnabled"
      l10n="done"
    ></button>
  </div>

  <lr-drop-area ghost></lr-drop-area>
`,i})();var Ro=(()=>{class i extends k{couldBeCtxOwner=!0;activityType=v.activities.URL;init$=g(p({},this.init$),{importDisabled:!0,onUpload:e=>{e.preventDefault();let r=this.ref.input.value;this.addFileFromUrl(r,{source:j.URL_TAB}),this.$["*currentActivity"]=v.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:e=>{let r=e.target.value;this.set$({importDisabled:!r})}});initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.ref.input.value="",this.ref.input.focus()}})}}return i.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <div>
      <lr-icon name="url"></lr-icon>
      <span l10n="caption-from-url"></span>
    </div>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <form class="content">
    <input placeholder="https://" class="url-input" type="text" ref="input" set="oninput: onInput" />
    <button
      type="submit"
      class="url-upload-btn primary-btn"
      set="onclick: onUpload; @disabled: importDisabled"
      l10n="upload-url"
    ></button>
  </form>
`,i})();var qr=()=>typeof navigator.permissions<"u";var Fo=(()=>{class i extends k{couldBeCtxOwner=!0;activityType=v.activities.CAMERA;_unsubPermissions=null;init$=g(p({},this.init$),{video:null,videoTransformCss:null,shotBtnDisabled:!0,videoHidden:!0,messageHidden:!0,requestBtnHidden:qr(),cameraSelectOptions:null,cameraSelectHidden:!0,l10nMessage:"",onCameraSelectChange:e=>{this._selectedCameraId=e.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}});_onActivate=()=>{qr()&&this._subscribePermissions(),this._capture()};_onDeactivate=()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()};_handlePermissionsChange=()=>{this._capture()};_setPermissionsState=M(e=>{this.classList.toggle("initialized",e==="granted"),e==="granted"?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):e==="prompt"?(this.$.l10nMessage="camera-permissions-prompt",this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage="camera-permissions-denied",this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())},300);_subscribePermissions(){return b(this,null,function*(){try{(yield navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(e){console.log("Failed to use permissions API. Fallback to manual request mode.",e),this._capture()}})}_capture(){return b(this,null,function*(){let e={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._selectedCameraId&&(e.video.deviceId={exact:this._selectedCameraId}),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let r=yield navigator.mediaDevices.getUserMedia(e);r.addEventListener("inactive",()=>{this._setPermissionsState("denied")}),this.$.video=r,this._capturing=!0,this._setPermissionsState("granted")}catch(r){this._setPermissionsState("denied"),console.error("Failed to capture camera",r)}})}_stopCapture(){this._capturing&&(this.$.video?.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let e=Date.now(),r=`camera-${e}.jpeg`,o="image/jpeg";this._canvas.toBlob(s=>{let n=new File([s],r,{lastModified:e,type:o});this.addFileFromObject(n,{source:j.CAMERA}),this.set$({"*currentActivity":v.activities.UPLOAD_LIST})},o)}initCallback(){return b(this,null,function*(){xt(i.prototype,this,"initCallback").call(this),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.subConfigValue("cameraMirror",e=>{this.$.videoTransformCss=e?"scaleX(-1)":null});try{let r=(yield navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput").map((o,s)=>({text:o.label.trim()||`${this.l10n("caption-camera")} ${s+1}`,value:o.deviceId}));r.length>1&&(this.$.cameraSelectOptions=r,this.$.cameraSelectHidden=!1),this._selectedCameraId=r[0]?.value}catch{}})}}return i.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <div set="@hidden: !cameraSelectHidden">
      <lr-icon name="camera"></lr-icon>
      <span l10n="caption-camera"></span>
    </div>
    <lr-select
      class="camera-select"
      set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange"
    >
    </lr-select>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <div class="content">
    <video
      autoplay
      playsinline
      set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden"
      ref="video"
    ></video>
    <div class="message-box" set="@hidden: messageHidden">
      <span l10n="l10nMessage"></span>
      <button
        type="button"
        set="onclick: onRequestPermissions; @hidden: requestBtnHidden"
        l10n="camera-permissions-request"
      ></button>
    </div>
    <button type="button" class="shot-btn" set="onclick: onShot; @disabled: shotBtnDisabled">
      <lr-icon name="camera"></lr-icon>
    </button>
  </div>
`,i})();var Ba=(()=>{class i extends k{requireCtxName=!0;initCallback(){super.initCallback(),this.$["*eventEmitter"].bindTarget(this)}destroyCallback(){super.destroyCallback(),this.$["*eventEmitter"].unbindTarget(this)}}return i.EventType=$,i})(),zo=Ba;var Xr=class{captionL10nStr="confirm-your-action";messageL10Str="are-you-sure";confirmL10nStr="yes";denyL10nStr="no";confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}},Do=(()=>{class i extends v{activityType=v.activities.CONFIRMATION;_defaults=new Xr;init$=g(p({},this.init$),{activityCaption:"",messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)});initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",e=>{e&&this.set$({"*currentActivity":v.activities.CONFIRMATION,activityCaption:this.l10n(e.captionL10nStr),messageTxt:this.l10n(e.messageL10Str),confirmBtnTxt:this.l10n(e.confirmL10nStr),denyBtnTxt:this.l10n(e.denyL10nStr),onDeny:()=>{e.denyAction()},onConfirm:()=>{e.confirmAction()}})})}}return i.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <span>{{activityCaption}}</span>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>

  <div class="message">{{messageTxt}}</div>
  <div class="toolbar">
    <button type="button" class="deny-btn secondary-btn" set="onclick: onDeny">{{denyBtnTxt}}</button>
    <button type="button" class="confirm-btn primary-btn" set="onclick: onConfirm">{{confirmBtnTxt}}</button>
  </div>
`,i})();var No=(()=>{class i extends k{init$=g(p({},this.init$),{visible:!1,value:0,"*commonProgress":0});initCallback(){super.initCallback(),this._unobserveCollection=this.uploadCollection.observeProperties(()=>{let e=this.uploadCollection.items().some(r=>this.uploadCollection.read(r).getValue("isUploading"));this.$.visible=e}),this.sub("visible",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")}),this.sub("*commonProgress",e=>{this.$.value=e})}destroyCallback(){super.destroyCallback(),this._unobserveCollection?.()}}return i.template=' <lr-progress-bar set="visible: visible; value: value"></lr-progress-bar> ',i})();var Vo=(()=>{class i extends _{_value=0;init$=g(p({},this.init$),{width:0,opacity:0});initCallback(){super.initCallback(),this.defineAccessor("value",e=>{if(e===void 0)return;let r=this._value;if(this._value=e,e===0&&r>0){this.ref.line.addEventListener("transitionend",()=>{this.style.setProperty("--l-width",this._value.toString())});return}this.style.setProperty("--l-width",this._value.toString())}),this.defineAccessor("visible",e=>{this.ref.line.classList.toggle("progress--hidden",!e)})}}return i.template=' <div ref="line" class="progress"></div> ',i})();var X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";var Zr=(()=>{class i extends _{init$=g(p({},this.init$),{checkerboard:!1,src:X});constructor(){super()}initCallback(){super.initCallback(),this.sub("checkerboard",()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${Oo()})`:"unset"})}destroyCallback(){super.destroyCallback(),URL.revokeObjectURL(this._lastObjectUrl)}setImage(e){this.$.src=e.src}setImageFile(e){let r=URL.createObjectURL(e);this.$.src=r,this._lastObjectUrl=r}setImageUrl(e){this.$.src=e}clear(){URL.revokeObjectURL(this._lastObjectUrl),this.$.src=X}}return i.template=' <lr-img class="img-view" ref="img" set="@src: src; style.aa: src;" /> ',i})();Zr.bindAttributes({checkerboard:"checkerboard"});function Bo(...i){return i.reduce((t,e)=>{if(typeof e=="string")return t[e]=!0,t;for(let r of Object.keys(e))t[r]=e[r];return t},{})}function z(...i){let t=Bo(...i);return Object.keys(t).reduce((e,r)=>(t[r]&&e.push(r),e),[]).join(" ")}function Ho(i,...t){let e=Bo(...t);for(let r of Object.keys(e))i.classList.toggle(r,e[r])}var jo=i=>{if(!i)return H;let t=Vi(i).filter(e=>H.includes(e));return t.length===0?H:t};function Go(i){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},"*cropPresetList":[],"*tabList":H,"*tabId":P.CROP,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:X,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,cropPreset:"",tabs:ze(H),"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let t=i.querySelectorAll("img");for(let e of t){let r=e.src;e.src=X,e.src=r}i.$["*networkProblems"]=!1},"*on.apply":t=>{if(!t)return;let e=i.$["*originalUrl"],r=N(_e(t),"preview"),o=U(e,r),s={originalUrl:e,cdnUrlModifiers:r,cdnUrl:o,transformations:t};i.dispatchEvent(new CustomEvent("apply",{detail:s,bubbles:!0,composed:!0})),i.remove()},"*on.cancel":()=>{i.remove(),i.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}var Wo=`
  <div class="wrapper wrapper_desktop">
    <lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;">
      <div class="network_problems_content">
        <div class="network_problems_icon">
          <lr-icon size="20" name="sad"></lr-icon>
        </div>
        <div class="network_problems_text">Network error</div>
      </div>
      <div class="network_problems_footer">
        <lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui>
      </div>
    </lr-presence-toggle>
    <div class="viewport">
      <div class="file_type_outer">
        <div class="file_type">{{fileType}}</div>
      </div>
      <div class="image_container" ref="img-container-el">
        <img src="${X}" class="image image_visible_from_editor" ref="img-el" />
        <lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper>
        <lr-editor-image-fader ref="fader-el"></lr-editor-image-fader>
      </div>
      <div class="info_pan">{{msg}}</div>
    </div>
    <div class="toolbar">
      <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>
      <div class="toolbar_content toolbar_content__editor">
        <lr-editor-toolbar></lr-editor-toolbar>
      </div>
    </div>
  </div>
`;var $e=(()=>{class i extends _{ctxOwner=!0;static className="cloud-image-editor";constructor(){super(),this.init$=p(p({},this.init$),Go(this))}_debouncedShowLoader=M(this._showLoader.bind(this),300);_showLoader(e){this.$.showLoader=e}_waitForSize(){return new Promise((r,o)=>{let s=setTimeout(()=>{o(new Error("[cloud-image-editor] timeout waiting for non-zero container size"))},3e3),n=new ResizeObserver(([a])=>{a.contentRect.width>0&&a.contentRect.height>0&&(r(),clearTimeout(s),n.disconnect())});n.observe(this)})}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}updateImage(){return b(this,null,function*(){if(this.isConnected){if(yield this._waitForSize(),this.$.cdnUrl){let e=$i(this.$.cdnUrl),r=ve(this.$.cdnUrl,e);if(r===this.$["*originalUrl"])return;this.$["*originalUrl"]=r;let o=Oi(this.$.cdnUrl),s=Fi(o);this.$["*editorTransformations"]=s}else if(this.$.uuid){let e=ve(this.cfg.cdnCname,this.$.uuid);if(e===this.$["*originalUrl"])return;this.$["*originalUrl"]=e,this.$["*editorTransformations"]={}}else throw new Error("No UUID nor CDN URL provided");this.$["*tabId"]===P.CROP?this.$["*cropperEl"].deactivate({reset:!0}):this.$["*faderEl"].deactivate();try{let e=U(this.$["*originalUrl"],N("json")),r=yield fetch(e).then(n=>n.json()),{width:o,height:s}=r;this.$["*imageSize"]={width:o,height:s},this.$["*tabId"]===P.CROP?this.$["*cropperEl"].activate(this.$["*imageSize"]):this.$["*faderEl"].activate({url:this.$["*originalUrl"]})}catch(e){e&&console.error("Failed to load image info",e)}}})}initEditor(){return b(this,null,function*(){try{yield this._waitForSize()}catch(e){this.isConnected&&console.error(e.message);return}this.ref["img-el"].addEventListener("load",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==X&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",e=>{let r=this.ref["img-el"];r.src!==e&&(this._imgLoading=!0,r.src=e||X)}),this.sub("cropPreset",e=>{this.$["*cropPresetList"]=Vt(e)}),this.sub("tabs",e=>{this.$["*tabList"]=jo(e)}),this.sub("*tabId",e=>{this.ref["img-el"].className=z("image",{image_hidden_to_cropper:e===P.CROP,image_hidden_effects:e!==P.CROP})}),this.classList.add("editor_ON"),this.sub("*networkProblems",e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e}),this.sub("*editorTransformations",e=>{if(Object.keys(e).length===0)return;let r=this.$["*originalUrl"],o=N(_e(e),"preview"),s=U(r,o),n={originalUrl:r,cdnUrlModifiers:o,cdnUrl:s,transformations:e};this.dispatchEvent(new CustomEvent("change",{detail:n,bubbles:!0,composed:!0}))},!1),this.sub("uuid",e=>e&&this.updateImage()),this.sub("cdnUrl",e=>e&&this.updateImage())})}}return i.template=Wo,i})();$e.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl","crop-preset":"cropPreset",tabs:"tabs"});var qo=(()=>{class i extends _{constructor(){super(),this.init$=g(p({},this.init$),{dragging:!1}),this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let r=this.$["*imageBox"];if(!r)return;if(e===""&&r.height<=x&&r.width<=x)return!0;let o=r.height<=x&&(e.includes("n")||e.includes("s")),s=r.width<=x&&(e.includes("e")||e.includes("w"));return o||s}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:r,y:o,width:s,height:n}=e,a=this.ref["svg-el"],l=Z("mask",{id:"backdrop-mask"}),c=Z("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),d=Z("rect",{x:r,y:o,width:s,height:n,fill:"black"});l.appendChild(c),l.appendChild(d);let h=Z("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});a.appendChild(h),a.appendChild(l),this._backdropMask=l,this._backdropMaskInner=d}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask&&(this._backdropMask.style.display="block")}))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:r,y:o,width:s,height:n}=e;this._backdropMaskInner&&Te(this._backdropMaskInner,{x:r,y:o,width:s,height:n})}_updateFrame(){let e=this.$["*cropBox"];if(!(!e||!this._frameGuides||!this._frameThumbs)){for(let r of Object.values(this._frameThumbs)){let{direction:o,pathNode:s,interactionNode:n,groupNode:a}=r,l=o==="",c=o.length===2,{x:d,y:h,width:u,height:f}=e;if(l){let y={x:d+u/3,y:h+f/3,width:u/3,height:f/3};Te(n,y)}else{let y=ye(Math.min(u,f)/(24*2+34)/2,0,1),{d:S,center:E}=c?ji(e,o,y):Gi(e,o,y),w=Math.max(Ir*ye(Math.min(u,f)/Ir/3,0,1),Hi);Te(n,{x:E[0]-w,y:E[1]-w,width:w*2,height:w*2}),Te(s,{d:S})}let m=this._shouldThumbBeDisabled(o);a.setAttribute("class",z("thumb",{"thumb--hidden":m,"thumb--visible":!m}))}Te(this._frameGuides,{x:e.x-1*.5,y:e.y-1*.5,width:e.width+1,height:e.height+1})}}_createThumbs(){let e={};for(let r=0;r<3;r++)for(let o=0;o<3;o++){let s=`${["n","","s"][r]}${["w","","e"][o]}`,n=Z("g");n.classList.add("thumb"),n.setAttribute("with-effects","");let a=Z("rect",{fill:"transparent"}),l=Z("path",{stroke:"currentColor",fill:"none","stroke-width":3});n.appendChild(l),n.appendChild(a),e[s]={direction:s,pathNode:l,interactionNode:a,groupNode:n},a.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return e}_createGuides(){let e=Z("svg"),r=Z("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});e.appendChild(r);for(let o=1;o<=2;o++){let s=Z("line",{x1:`${dt*o}%`,y1:"0%",x2:`${dt*o}%`,y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(s)}for(let o=1;o<=2;o++){let s=Z("line",{x1:"0%",y1:`${dt*o}%`,x2:"100%",y2:`${dt*o}%`,stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(s)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],r=document.createDocumentFragment(),o=this._createGuides();r.appendChild(o);let s=this._createThumbs();for(let{groupNode:n}of Object.values(s))r.appendChild(n);e.appendChild(r),this._frameThumbs=s,this._frameGuides=o}_handlePointerDown(e,r){if(!this._frameThumbs)return;let o=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let s=this.$["*cropBox"],{x:n,y:a}=this.ref["svg-el"].getBoundingClientRect(),l=r.x-n,c=r.y-a;this.$.dragging=!0,this._draggingThumb=o,this._dragStartPoint=[l,c],this._dragStartCrop=p({},s)}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging||!this._dragStartPoint||!this._draggingThumb)return;e.stopPropagation(),e.preventDefault();let r=this.ref["svg-el"],{x:o,y:s}=r.getBoundingClientRect(),n=e.x-o,a=e.y-s,l=n-this._dragStartPoint[0],c=a-this._dragStartPoint[1],{direction:d}=this._draggingThumb,h=this._calcCropBox(d,[l,c]);h&&(this.$["*cropBox"]=h)}_calcCropBox(e,r){let[o,s]=r,n=this.$["*imageBox"],a=this._dragStartCrop??this.$["*cropBox"],l=this.$["*cropPresetList"]?.[0],c=l?l.width/l.height:void 0;if(e===""?a=qi({rect:a,delta:[o,s],imageBox:n}):a=Xi({rect:a,delta:[o,s],direction:e,aspectRatio:c,imageBox:n}),!Object.values(a).every(d=>Number.isFinite(d)&&d>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:a});return}return Ne(Be(a),this.$["*imageBox"])}_handleSvgPointerMove_(e){if(!this._frameThumbs)return;let r=Object.values(this._frameThumbs).find(o=>{if(this._shouldThumbBeDisabled(o.direction))return!1;let n=o.interactionNode.getBoundingClientRect(),a={x:n.x,y:n.y,width:n.width,height:n.height};return Zi(a,[e.x,e.y])});this._hoverThumb=r,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;this.ref["svg-el"].style.cursor=e?Wi(e.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){this._frameThumbs&&Object.values(this._frameThumbs).map(({groupNode:r})=>r).forEach(r=>{r.setAttribute("class",z("thumb",{"thumb--hidden":!e,"thumb--visible":e}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",e=>{e&&(this._guidesHidden=e.height<=x||e.width<=x,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",e=>{this._frameGuides&&this._frameGuides.setAttribute("class",z({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}}return i.template=' <svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg> ',i})();var Xe=(()=>{class i extends _{init$=g(p({},this.init$),{active:!1,title:"",icon:"","on.click":null});initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")}),this.sub("active",e=>{this.className=z({active:e,not_active:!e})}),this.sub("on.click",e=>{this.onclick=e})}}return i.template=`
  <div class="before"></div>
  <lr-icon size="20" set="@name: icon;"></lr-icon>
  <div class="title" ref="title-el">{{title}}</div>
`,i})();function ja(i){let t=i+90;return t=t>=360?0:t,t}function Ga(i,t){return i==="rotate"?ja(t):["mirror","flip"].includes(i)?!t:null}var Ze=class extends Xe{initCallback(){super.initCallback(),this.defineAccessor("operation",t=>{t&&(this._operation=t,this.$.icon=t)}),this.$["on.click"]=t=>{let e=this.$["*cropperEl"].getValue(this._operation),r=Ga(this._operation,e);this.$["*cropperEl"].setValue(this._operation,r)}}};var ft={FILTER:"filter",COLOR_OPERATION:"color_operation"},oe="original",Xo=(()=>{class i extends _{init$=g(p({},this.init$),{disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}});setOperation(e,r){this._controlType=e==="filter"?ft.FILTER:ft.COLOR_OPERATION,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=r,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===oe?void 0:this.$.value,filter:this._filter===oe?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:r}=ee[this._operation],[o,s]=e;this.$.min=o,this.$.max=s,this.$.zero=r;let n=this.$["*editorTransformations"][this._operation];if(this._controlType===ft.FILTER){let a=s;if(n){let{name:l,amount:c}=n;a=l===this._filter?c:s}this.$.value=a,this.$.defaultValue=a}if(this._controlType===ft.COLOR_OPERATION){let a=typeof n<"u"?n:r;this.$.value=a,this.$.defaultValue=a}}apply(){let e;this._controlType===ft.FILTER?this._filter===oe?e=null:e={name:this._filter,amount:this.$.value}:e=this.$.value;let r=g(p({},this.$["*editorTransformations"]),{[this._operation]:e});this.$["*editorTransformations"]=r}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",e=>{this._originalUrl=e}),this.sub("value",e=>{let r=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=r})}}return i.template=`
  <lr-slider-ui
    ref="slider-el"
    set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"
  ></lr-slider-ui>
`,i})();function gt(i){let t=new Image;return{promise:new Promise((o,s)=>{t.src=i,t.onload=o,t.onerror=s}),image:t,cancel:()=>{t.naturalWidth===0&&(t.src=X)}}}function bt(i){let t=[];for(let s of i){let n=gt(s);t.push(n)}let e=t.map(s=>s.image);return{promise:Promise.allSettled(t.map(s=>s.promise)),images:e,cancel:()=>{t.forEach(s=>{s.cancel()})}}}var rr=(()=>{class i extends Xe{init$=g(p({},this.init$),{active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null});_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),r=window.devicePixelRatio,o=Math.ceil(r*e),s=r>=2?"lightest":"normal",n=100,a=p({},this.$["*editorTransformations"]);return a[this._operation]=this._filter!==oe?{name:this._filter,amount:n}:void 0,U(this._originalUrl,N(Dt,_e(a),`quality/${s}`,`scale_crop/${o}x${o}/center`))}_observerCallback(e,r){if(e[0].isIntersecting){let s=this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"],{promise:a,cancel:l}=gt(s);this._cancelPreload=l,a.catch(c=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:c})}).finally(()=>{n.style.backgroundImage=`url(${s})`,n.setAttribute("loaded",""),r.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=r=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",r=>{this._operation="filter",this._filter=r,this.$.isOriginal=r===oe,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",r=>{this.$.active=r&&r===this._filter}),this.sub("isOriginal",r=>{this.$.iconSize=r?40:20}),this.sub("active",r=>{if(this.$.isOriginal)return;let o=this.ref["icon-el"];o.style.opacity=r?"1":"0";let s=this.ref["preview-el"];r?s.style.opacity="0":s.style.backgroundImage&&(s.style.opacity="1")}),this.sub("*networkProblems",r=>{if(!r){let o=this.proxyUrl(this._previewSrc()),s=this.ref["preview-el"];s.style.backgroundImage&&(s.style.backgroundImage="none",s.style.backgroundImage=`url(${o})`)}})}destroyCallback(){super.destroyCallback(),this._observer?.disconnect(),this._cancelPreload&&this._cancelPreload()}}return i.template=`
  <div class="before"></div>
  <div class="preview" ref="preview-el"></div>
  <lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>
`,i})();var Ke=class extends Xe{_operation="";initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",t=>{t&&(this._operation=t,this.$.icon=t,this.bindL10n("title",()=>this.l10n(t)))}),this.sub("*editorTransformations",t=>{if(!this._operation)return;let{zero:e}=ee[this._operation],r=t[this._operation],o=typeof r<"u"?r!==e:!1;this.$.active=o})}};function Zo(i,t){let e={};for(let r of t){let o=i[r];(i.hasOwnProperty(r)||o!==void 0)&&(e[r]=o)}return e}function Ye(i,t,e){let o=window.devicePixelRatio,s=Math.min(Math.ceil(t*o),3e3),n=o>=2?"lightest":"normal";return U(i,N(Dt,_e(e),`quality/${n}`,`stretch/off/-/resize/${s}x`))}function Wa(i){return i?[({dimensions:e,coords:r})=>[...e,...r].every(o=>Number.isInteger(o)&&Number.isFinite(o)),({dimensions:e,coords:r})=>e.every(o=>o>0)&&r.every(o=>o>=0)].every(e=>e(i)):!0}var Ko=(()=>{class i extends _{ctxOwner=!0;constructor(){super(),this.init$=g(p({},this.init$),{image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}}),this._commitDebounced=M(this._commit.bind(this),300),this._handleResizeThrottled=tr(this._handleResize.bind(this),100),this._imageSize={width:0,height:0}}_handleResize(){!this.isConnected||!this._isActive||(this._initCanvas(),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let e=this.$["*editorTransformations"],r=Zo(e,Object.keys(this.$["*operations"])),o=p(p({},this.$["*operations"]),r);this.$["*operations"]=o}_initCanvas(){let e=this.ref["canvas-el"],r=e.getContext("2d"),o=this.offsetWidth,s=this.offsetHeight,n=window.devicePixelRatio;e.style.width=`${o}px`,e.style.height=`${s}px`,e.width=o*n,e.height=s*n,r?.scale(n,n),this._canvas=e,this._ctx=r}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,r=this.$["*padding"],o=this.$["*operations"],{rotate:s}=o,n={width:this.offsetWidth,height:this.offsetHeight},a=Ve({width:e.naturalWidth,height:e.naturalHeight},s),l;if(a.width>n.width-r*2||a.height>n.height-r*2){let c=a.width/a.height,d=n.width/n.height;if(c>d){let h=n.width-r*2,u=h/c,f=0+r,m=r+(n.height-r*2)/2-u/2;l={x:f,y:m,width:h,height:u}}else{let h=n.height-r*2,u=h*c,f=r+(n.width-r*2)/2-u/2,m=0+r;l={x:f,y:m,width:u,height:h}}}else{let{width:c,height:d}=a,h=r+(n.width-r*2)/2-c/2,u=r+(n.height-r*2)/2-d/2;l={x:h,y:u,width:c,height:d}}this.$["*imageBox"]=Be(l)}_alignCrop(){let e=this.$["*cropBox"],r=this.$["*imageBox"],o=this.$["*operations"],{rotate:s}=o,n=this.$["*editorTransformations"].crop,{width:a,x:l,y:c}=this.$["*imageBox"];if(n){let{dimensions:[u,f],coords:[m,y]}=n,{width:S}=Ve(this._imageSize,s),E=a/S;e=Ne(Be({x:l+m*E,y:c+y*E,width:u*E,height:f*E}),this.$["*imageBox"])}let d=this.$["*cropPresetList"]?.[0],h=d?d.width/d.height:void 0;if(!Ki(e,r)||h&&!Yi(e,h)){let u=r.width/r.height,f=r.width,m=r.height;h&&(u>h?f=Math.min(r.height*h,r.width):m=Math.min(r.width/h,r.height)),e={x:r.x+r.width/2-f/2,y:r.y+r.height/2-m/2,width:f,height:m}}this.$["*cropBox"]=Ne(Be(e),this.$["*imageBox"])}_drawImage(){let e=this._ctx;if(!e)return;let r=this.$.image,o=this.$["*imageBox"],s=this.$["*operations"],{mirror:n,flip:a,rotate:l}=s,c=Ve({width:o.width,height:o.height},l);e.save(),e.translate(o.x+o.width/2,o.y+o.height/2),e.rotate(l*Math.PI*-1/180),e.scale(n?-1:1,a?-1:1),e.drawImage(r,-c.width/2,-c.height/2,c.width,c.height),e.restore()}_draw(){if(!this._isActive||!this.$.image||!this._canvas||!this._ctx)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=z({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1})}))}_getCropDimensions(){let e=this.$["*cropBox"],r=this.$["*imageBox"],o=this.$["*operations"],{rotate:s}=o,{width:n,height:a}=r,{width:l,height:c}=Ve(this._imageSize,s),{width:d,height:h}=e,u=n/l,f=a/c;return[ye(Math.round(d/u),1,l),ye(Math.round(h/f),1,c)]}_getCropTransformation(){let e=this.$["*cropBox"],r=this.$["*imageBox"],o=this.$["*operations"],{rotate:s}=o,{width:n,height:a,x:l,y:c}=r,{width:d,height:h}=Ve(this._imageSize,s),{x:u,y:f}=e,m=n/d,y=a/h,S=this._getCropDimensions(),E={dimensions:S,coords:[ye(Math.round((u-l)/m),0,d-S[0]),ye(Math.round((f-c)/y),0,h-S[1])]};if(!Wa(E)){console.error("Cropper is trying to create invalid crop object",{payload:E});return}if(!(S[0]===d&&S[1]===h))return E}_commit(){if(!this.isConnected)return;let e=this.$["*operations"],{rotate:r,mirror:o,flip:s}=e,n=this._getCropTransformation(),a=this.$["*editorTransformations"],l=g(p({},a),{crop:n,rotate:r,mirror:o,flip:s});this.$["*editorTransformations"]=l}setValue(e,r){this.$["*operations"]=g(p({},this.$["*operations"]),{[e]:r}),this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}activate(o){return b(this,arguments,function*(e,{fromViewer:r}={}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset);try{this.$.image=yield this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._animateIn({fromViewer:r})}catch(s){console.error("Failed to activate cropper",{error:s})}this._observer=new ResizeObserver(([s])=>{s.contentRect.width>0&&s.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeThrottled()}),this._observer.observe(this)}})}deactivate({reset:e=!1}={}){this._isActive&&(!e&&this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=z({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}),this._observer?.disconnect())}_transitionToCrop(){let e=this._getCropDimensions(),r=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,o=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,s=Math.min(r,o),n=this.$["*cropBox"].x+this.$["*cropBox"].width/2,a=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${s}) translate(${(this.offsetWidth/2-n)/s}px, ${(this.offsetHeight/2-a)/s}px)`,this.style.transformOrigin=`${n}px ${a}px`}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,r=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${e}px ${r}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,r){let o=this.offsetWidth;r=g(p({},r),{crop:void 0,rotate:void 0,flip:void 0,mirror:void 0});let s=this.proxyUrl(Ye(e,o,r)),{promise:n,cancel:a,image:l}=gt(s),c=this._handleImageLoading(s);return l.addEventListener("load",c,{once:!0}),l.addEventListener("error",c,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=a,n.then(()=>l).catch(d=>(console.error("Failed to load image",{error:d}),this.$["*networkProblems"]=!0,Promise.resolve(l)))}_handleImageLoading(e){let r="crop",o=this.$["*loadingOperations"];return o.get(r)||o.set(r,new Map),o.get(r).get(e)||(o.set(r,o.get(r).set(e,!0)),this.$["*loadingOperations"]=o),()=>{o?.get(r)?.has(e)&&(o.get(r).delete(e),this.$["*loadingOperations"]=o)}}initCallback(){super.initCallback(),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",()=>{this.$.image&&this._commitDebounced()}),this.sub("*cropPresetList",()=>{this._alignCrop()}),setTimeout(()=>{this.sub("*networkProblems",e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){super.destroyCallback(),this._observer?.disconnect()}}return i.template=`
  <canvas class="canvas" ref="canvas-el"></canvas>
  <lr-crop-frame ref="frame-el"></lr-crop-frame>
`,i})();function Kr(i,t,e){let r=Array(e);e--;for(let o=e;o>=0;o--)r[o]=Math.ceil((o*t+(e-o)*i)/e);return r}function qa(i){return i.reduce((t,e,r)=>r<i.length-1?[...t,[e,i[r+1]]]:t,[])}function Xa(i,t,e){let r=qa(i).find(([o,s])=>o<=t&&t<=s);return i.map(o=>{let s=Math.abs(r[0]-r[1]),n=Math.abs(t-r[0])/s;return r[0]===o?t>e?1:1-n:r[1]===o?t>=e?n:1:0})}function Za(i,t){return i.map((e,r)=>e<t?i.length-r:r)}function Yo(i,t){let e=ee[i].keypointsNumber,{range:r,zero:o}=ee[i];return[...new Set([...Kr(r[0],o,e+1),...Kr(o,r[1],e+1),o,t])].sort((s,n)=>s-n)}var ir=class extends _{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=M(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(t){let e=this._operation,r=this.$["*loadingOperations"];return r.get(e)||r.set(e,new Map),r.get(e).get(t)||(r.set(e,r.get(e).set(t,!0)),this.$["*loadingOperations"]=r),()=>{r?.get(e)?.has(t)&&(r.get(e).delete(t),this.$["*loadingOperations"]=r)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let t of this._keypoints){let{image:e}=t;e&&(e.style.opacity=t.opacity.toString(),e.style.zIndex=t.zIndex.toString())}})}_imageSrc({url:t=this._url,filter:e=this._filter,operation:r,value:o}={}){let s=p({},this._transformations);r&&(s[r]=e?{name:e,amount:o}:o);let n=this.offsetWidth;return this.proxyUrl(Ye(t,n,s))}_constructKeypoint(t,e){return{src:this._imageSrc({operation:t,value:e}),image:null,opacity:0,zIndex:0,value:e}}_isSame(t,e){return this._operation===t&&this._filter===e}_addKeypoint(t,e,r){let o=()=>!this._isSame(t,e)||this._value!==r||!!this._keypoints.find(l=>l.value===r);if(o())return;let s=this._constructKeypoint(t,r),n=new Image;n.src=s.src;let a=this._handleImageLoading(s.src);n.addEventListener("load",a,{once:!0}),n.addEventListener("error",a,{once:!0}),s.image=n,n.classList.add("fader-image"),n.addEventListener("load",()=>{if(o())return;let l=this._keypoints,c=l.findIndex(h=>h.value>r),d=c<l.length?l[c].image:null;!this._container||d&&!this._container.contains(d)||(l.splice(c,0,s),this._container.insertBefore(n,d),this._update(t,r))},{once:!0}),n.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(t){t=typeof t=="string"?parseInt(t,10):t,this._update(this._operation,t),this._addKeypointDebounced(this._operation,this._filter,t)}_update(t,e){this._operation=t,this._value=e;let{zero:r}=ee[t],o=this._keypoints.map(a=>a.value),s=Xa(o,e,r),n=Za(o,r);for(let[a,l]of Object.entries(this._keypoints))l.opacity=s[a],l.zIndex=n[a];this._flush()}_createPreviewImage(){let t=new Image;return t.classList.add("fader-image","fader-image--preview"),t.style.opacity="0",t}_initNodes(){return b(this,null,function*(){let t=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&t.appendChild(this._previewImage);let e=document.createElement("div");t.appendChild(e);let r=this._keypoints.map(c=>c.src),{images:o,promise:s,cancel:n}=bt(r);o.forEach(c=>{let d=this._handleImageLoading(c.src);c.addEventListener("load",d),c.addEventListener("error",d)}),this._cancelLastImages=()=>{n(),this._cancelLastImages=void 0};let a=this._operation,l=this._filter;yield s,this._isActive&&this._isSame(a,l)&&(this._container&&this._container.remove(),this._container=e,this._keypoints.forEach((c,d)=>{let h=o[d];h.classList.add("fader-image"),c.image=h,this._container.appendChild(h)}),this.appendChild(t),this._flush())})}setTransformations(t){if(this._transformations=t,this._previewImage){let e=this._imageSrc(),r=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",r,{once:!0}),this._previewImage.addEventListener("error",r,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:t,filter:e,operation:r,value:o}){this._cancelBatchPreload&&this._cancelBatchPreload();let n=Yo(r,o).map(l=>this._imageSrc({url:t,filter:e,operation:r,value:l})),{cancel:a}=bt(n);this._cancelBatchPreload=a}_setOriginalSrc(t){let e=this._previewImage||this._createPreviewImage();if(!this.contains(e)&&this.appendChild(e),this._previewImage=e,e.src===t){e.style.opacity="1",e.style.transform="scale(1)",this.className=z({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1});return}e.style.opacity="0";let r=this._handleImageLoading(t);e.addEventListener("error",r,{once:!0}),e.src=t,e.addEventListener("load",()=>{r(),e&&(e.style.opacity="1",e.style.transform="scale(1)",this.className=z({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))},{once:!0}),e.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:t,operation:e,value:r,filter:o,fromViewer:s}){if(this._isActive=!0,this._hidden=!1,this._url=t,this._operation=e||"initial",this._value=r,this._filter=o,this._fromViewer=s,typeof r!="number"&&!o){let a=this._imageSrc({operation:e,value:r});this._setOriginalSrc(a),this._container&&this._container.remove();return}this._keypoints=Yo(e,r).map(a=>this._constructKeypoint(e,a)),this._update(e,r),this._initNodes()}deactivate({hide:t=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),t&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=z({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}};var Ka=1,Jo=(()=>{class i extends _{initCallback(){super.initCallback(),this.addEventListener("wheel",e=>{e.preventDefault();let{deltaY:r,deltaX:o}=e;Math.abs(o)>Ka?this.scrollLeft+=o:this.scrollLeft+=r})}}return i.template=" <slot></slot> ",i})();function Ya(i){return`
    <lr-presence-toggle class="tab-toggle" set="visible: presence.tabToggle.${i}; styles: presence.tabToggleStyles;">
      <lr-btn-ui
        theme="boring"
        ref="tab-toggle-${i}"
        data-id="${i}"
        icon="${i}"
        tabindex="0"
        set="onclick: on.clickTab;"
      >
      </lr-btn-ui>
    </lr-presence-toggle>
  `}function Ja(i){return`
    <lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${i}; styles: presence.tabContentStyles">
      <lr-editor-scroller hidden-scrollbar>
        <div class="controls-list_align">
          <div class="controls-list_inner" ref="controls-list-${i}"></div>
        </div>
      </lr-editor-scroller>
    </lr-presence-toggle>
  `}var vt=class extends _{constructor(){super(),this.init$=g(p({},this.init$),{"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":oe,"*currentOperation":null,showLoader:!1,filters:Di,colorOperations:zi,cropOperations:Ni,"*operationTooltip":null,"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabToggles":!0,"presence.tabContent.crop":!1,"presence.tabContent.tuning":!1,"presence.tabContent.filters":!1,"presence.tabToggle.crop":!0,"presence.tabToggle.tuning":!0,"presence.tabToggle.filters":!0,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"presence.tabToggleStyles":{hidden:"tab-toggle--hidden",visible:"tab-toggle--visible"},"presence.tabTogglesStyles":{hidden:"tab-toggles--hidden",visible:"tab-toggles--visible"},"on.cancel":()=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":()=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":()=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":()=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":t=>{let e=t.currentTarget.getAttribute("data-id");e&&this._activateTab(e,{fromViewer:!1})}}),this._debouncedShowLoader=M(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===P.TUNING&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(t){let e=new Ke;return e.operation=t,e}_createFilterControl(t){let e=new rr;return e.filter=t,e}_createToggleControl(t){let e=new Ze;return e.operation=t,e}_renderControlsList(t){let e=this.ref[`controls-list-${t}`],r=document.createDocumentFragment();t===P.CROP?this.$.cropOperations.forEach(o=>{let s=this._createToggleControl(o);r.appendChild(s)}):t===P.FILTERS?[oe,...this.$.filters].forEach(o=>{let s=this._createFilterControl(o);r.appendChild(s)}):t===P.TUNING&&this.$.colorOperations.forEach(o=>{let s=this._createOperationControl(o);r.appendChild(s)}),[...r.children].forEach((o,s)=>{s===r.childNodes.length-1&&o.classList.add("controls-list_last-item")}),e.innerHTML="",e.appendChild(r)}_activateTab(t,{fromViewer:e}){this.$["*tabId"]=t,t===P.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:e})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:e}),this.$["*cropperEl"].deactivate());for(let r of H){let o=r===t,s=this.ref[`tab-toggle-${r}`];s.active=o,o?(this._renderControlsList(t),this._syncTabIndicator()):this._unmountTabControls(r),this.$[`presence.tabContent.${r}`]=o}}_unmountTabControls(t){let e=this.ref[`controls-list-${t}`];e&&(e.innerHTML="")}_syncTabIndicator(){let t=this.ref[`tab-toggle-${this.$["*tabId"]}`],e=this.ref["tabs-indicator"];e.style.transform=`translateX(${t.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let t=this.$["*imgContainerEl"].offsetWidth,e=this.proxyUrl(Ye(this.$["*originalUrl"],t,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:r}=bt([e]);this._cancelPreload=()=>{r(),this._cancelPreload=void 0}}}_showLoader(t){this.$.showLoader=t}_updateInfoTooltip=M(()=>{let t=this.$["*editorTransformations"],e=this.$["*currentOperation"],r="",o=!1;if(this.$["*tabId"]===P.FILTERS)if(o=!0,this.$["*currentFilter"]&&t?.filter?.name===this.$["*currentFilter"]){let s=t?.filter?.amount||100;r=this.$["*currentFilter"]+" "+s}else r=this.l10n(oe);else if(this.$["*tabId"]===P.TUNING&&e){o=!0;let s=t?.[e]||ee[e].zero;r=this.l10n(e)+" "+s}o&&(this.$["*operationTooltip"]=r),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",o)},0);initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",t=>{t&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",t=>{let e=t?.filter?.name;this.$["*currentFilter"]!==e&&(this.$["*currentFilter"]=e)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",()=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",t=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(t)}),this.sub("*loadingOperations",t=>{let e=!1;for(let[,r]of t.entries()){if(e)break;for(let[,o]of r.entries())if(o){e=!0;break}}this._debouncedShowLoader(e)}),this.sub("*showSlider",t=>{this.$["presence.subToolbar"]=t,this.$["presence.mainToolbar"]=!t}),this.sub("*tabList",t=>{this.$["presence.tabToggles"]=t.length>1;for(let e of H){this.$[`presence.tabToggle.${e}`]=t.includes(e);let r=this.ref[`tab-toggle-${e}`];r.style.gridColumn=t.indexOf(e)+1}t.includes(this.$["*tabId"])||this._activateTab(t[0],{fromViewer:!1})}),this._updateInfoTooltip()}};vt.template=`
  <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>
  <div class="info-tooltip_container">
    <div class="info-tooltip_wrapper">
      <div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div>
    </div>
  </div>
  <div class="toolbar-container">
    <lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles">
      <div class="tab-content-row">${H.map(Ja).join("")}</div>
      <div class="controls-row">
        <lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"> </lr-btn-ui>
        <lr-presence-toggle class="tab-toggles" set="visible: presence.tabToggles; styles: presence.tabTogglesStyles">
          <div ref="tabs-indicator" class="tab-toggles_indicator"></div>
          ${H.map(Ya).join("")}
        </lr-presence-toggle>
        <lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"> </lr-btn-ui>
      </div>
    </lr-presence-toggle>
    <lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles">
      <div class="slider">
        <lr-editor-slider ref="slider-el"></lr-editor-slider>
      </div>
      <div class="controls-row">
        <lr-btn-ui theme="boring" set="onclick: on.cancelSlider;" l10n="@text:cancel"> </lr-btn-ui>
        <lr-btn-ui theme="primary" set="onclick: on.applySlider;" l10n="@text:apply"> </lr-btn-ui>
      </div>
    </lr-presence-toggle>
  </div>
`;var Je=class extends _{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$=g(p({},this.init$),{text:"",icon:"",iconCss:this._iconCss(),theme:null}),this.defineAccessor("active",t=>{t?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return z("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",t=>{this._iconSingle=!this.$.text,this._iconHidden=!t,this.$.iconCss=this._iconCss()}),this.sub("theme",t=>{t!=="custom"&&(this.className=t)}),this.sub("text",t=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(t){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}};Je.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});Je.template=`
  <lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon>
  <div class="text">{{text}}</div>
`;var Qo=(()=>{class i extends _{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",e=>{typeof e=="boolean"&&(e?this._start():this._stop())})}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),r=this.ref["line-el"];r.style.transition="transform 1s",r.style.opacity="1",r.style.transform=`translateX(${e}px)`,r.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}}return i.template=`
  <div class="inner">
    <div class="line" ref="line-el"></div>
  </div>
`,i})();var or={transition:"transition",visible:"visible",hidden:"hidden"},es=(()=>{class i extends _{constructor(){super(),this._visible=!1,this._visibleStyle=or.visible,this._hiddenStyle=or.hidden,this._externalTransitions=!1,this.defineAccessor("styles",e=>{e&&(this._externalTransitions=!0,this._visibleStyle=e.visible,this._hiddenStyle=e.hidden)}),this.defineAccessor("visible",e=>{typeof e=="boolean"&&(this._visible=e,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",Ho(this,{[or.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(or.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}}return i.template=" <slot></slot> ",i})();var ts=(()=>{class i extends _{init$=g(p({},this.init$),{disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}});constructor(){super(),this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",r=>{this.$.disabled=r}),this.defineAccessor("min",r=>{this.$.min=r}),this.defineAccessor("max",r=>{this.$.max=r}),this.defineAccessor("defaultValue",r=>{this.$.defaultValue=r,this.ref["input-el"].value=r,this._updateValue(r)}),this.defineAccessor("zero",r=>{this._zero=r}),this.defineAccessor("onInput",r=>{r&&(this.$.onInput=r)}),this.defineAccessor("onChange",r=>{r&&(this.$.onChange=r)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let r=parseInt(this.ref["input-el"].value,10);this._updateValue(r)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let r=parseInt(this.ref["input-el"].value,10);this._updateValue(r)},0),this.sub("disabled",r=>{let o=this.ref["input-el"];r?o.setAttribute("disabled","disabled"):o.removeAttribute("disabled")});let e=this.ref["input-el"];e.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),e.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(e){this._updateZeroDot(e);let{width:r}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(e-this.$.min)*(r-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${n}px)`})}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:r}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(r-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${n}px)`})}_updateSteps(){let r=this.ref["steps-el"],{width:o}=r.getBoundingClientRect(),s=Math.ceil(o/2),n=Math.ceil(s/15)-2;if(this._stepsCount===n)return;let a=document.createDocumentFragment(),l=document.createElement("div"),c=document.createElement("div");l.className="minor-step",c.className="border-step",a.appendChild(c);for(let h=0;h<n;h++)a.appendChild(l.cloneNode());a.appendChild(c.cloneNode());for(let h=0;h<n;h++)a.appendChild(l.cloneNode());a.appendChild(c.cloneNode());let d=document.createElement("div");d.className="zero-dot",a.appendChild(d),this._zeroDotEl=d,r.innerHTML="",r.appendChild(a),this._stepsCount=n}destroyCallback(){this._observer?.disconnect()}}return i.template=`
  <div class="steps" ref="steps-el"></div>
  <div ref="thumb-el" class="thumb"></div>
  <input
    class="input"
    type="range"
    ref="input-el"
    tabindex="0"
    set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;"
  />
`,i})();var sr=class extends k{couldBeCtxOwner=!0;activityType=v.activities.CLOUD_IMG_EDIT;constructor(){super(),this.init$=g(p({},this.init$),{cdnUrl:null})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.sub("*focusedEntry",t=>{t&&(this.entry=t,this.entry.subscribe("cdnUrl",e=>{e&&(this.$.cdnUrl=e)}))}),this.subConfigValue("cropPreset",t=>{this._instance&&this._instance.getAttribute("crop-preset")!==t&&this._instance.setAttribute("crop-preset",t)}),this.subConfigValue("cloudImageEditorTabs",t=>{this._instance&&this._instance.getAttribute("tabs")!==t&&this._instance.setAttribute("tabs",t)})}handleApply(t){if(!this.entry)return;let e=t.detail;this.entry.setMultipleValues({cdnUrl:e.cdnUrl,cdnUrlModifiers:e.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let t=new $e,e=this.$.cdnUrl,r=this.cfg.cropPreset,o=this.cfg.cloudImageEditorTabs;t.setAttribute("ctx-name",this.ctxName),t.setAttribute("cdn-url",e),r&&t.setAttribute("crop-preset",r),o&&t.setAttribute("tabs",o),t.addEventListener("apply",s=>{let n=s;this.handleApply(n),this.debugPrint('editor event "apply"',n.detail)}),t.addEventListener("cancel",s=>{let n=s;this.handleCancel(),this.debugPrint('editor event "cancel"',n.detail)}),t.addEventListener("change",s=>{let n=s;this.debugPrint('editor event "change"',n.detail)}),this.innerHTML="",this.appendChild(t),this._mounted=!0,this._instance=t}unmountEditor(){this._instance=void 0,this.innerHTML=""}};var Qa=function(i){return i.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},rs=function(i,t="i"){let e=i.split("*").map(Qa);return new RegExp("^"+e.join(".+")+"$",t)};var el=i=>Object.keys(i).reduce((e,r)=>{let o=i[r],s=Object.keys(o).reduce((n,a)=>{let l=o[a];return n+`${a}: ${l};`},"");return e+`${r}{${s}}`},"");function is({textColor:i,backgroundColor:t,linkColor:e,linkColorHover:r,shadeColor:o}){let s=`solid 1px ${o}`;return el({body:{color:i,"background-color":t},".side-bar":{background:"inherit","border-right":s},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:o},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":s},".list-table-body .list-items":{"border-bottom":s},".bread-crumbs a":{color:e},".bread-crumbs a:hover":{color:r},".main-content.loading":{background:`${t} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{"background-color":o},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:e},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:r},".side-bar-menu a":{color:e},".side-bar-menu a:hover":{color:r},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:r},".source-vk .side-bar-menu a":{color:e},".source-vk .side-bar-menu a:hover":{color:r,background:"none"}})}var xe={};window.addEventListener("message",i=>{let t;try{t=JSON.parse(i.data)}catch{return}if(t?.type in xe){let e=xe[t.type];for(let[r,o]of e)i.source===r&&o(t)}});var os=function(i,t,e){i in xe||(xe[i]=[]),xe[i].push([t,e])},ss=function(i,t){i in xe&&(xe[i]=xe[i].filter(e=>e[0]!==t))};function ns(i){let t=[];for(let[e,r]of Object.entries(i))r==null||typeof r=="string"&&r.length===0||t.push(`${e}=${encodeURIComponent(r)}`);return t.join("&")}var as=(()=>{class i extends k{couldBeCtxOwner=!0;activityType=v.activities.EXTERNAL;constructor(){super(),this.init$=g(p({},this.init$),{activityIcon:"",activityCaption:"",selectedList:[],counter:0,multiple:!1,onDone:()=>{for(let e of this.$.selectedList){let r=this.extractUrlFromMessage(e),{filename:o}=e,{externalSourceType:s}=this.activityParams;this.addFileFromUrl(r,{fileName:o,source:s})}this.$["*currentActivity"]=v.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()}})}_iframe=null;initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:e}=this.activityParams;this.set$({activityCaption:`${e?.[0].toUpperCase()}${e?.slice(1)}`,activityIcon:e}),this.mountIframe()}}),this.sub("*currentActivity",e=>{e!==this.activityType&&this.unmountIframe()}),this.sub("selectedList",e=>{this.$.counter=e.length}),this.subConfigValue("multiple",e=>{this.$.multiple=e})}extractUrlFromMessage(e){if(e.alternatives){let r=R(this.cfg.externalSourcesPreferredTypes);for(let o of r){let s=rs(o);for(let[n,a]of Object.entries(e.alternatives))if(s.test(n))return a}}return e.url}sendMessage(e){this._iframe?.contentWindow?.postMessage(JSON.stringify(e),"*")}handleFileSelected(e){return b(this,null,function*(){!this.$.multiple&&this.$.selectedList.length||(this.$.selectedList=[...this.$.selectedList,e],this.$.multiple||this.$.onDone())})}handleIframeLoad(){this.applyStyles()}getCssValue(e){return window.getComputedStyle(this).getPropertyValue(e).trim()}applyStyles(){let e={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:is(e)})}remoteUrl(){let{pubkey:e,remoteTabSessionKey:r,socialBaseUrl:o}=this.cfg,{externalSourceType:s}=this.activityParams,a={lang:this.l10n("social-source-lang")?.split("-")?.[0]||"en",public_key:e,images_only:"false",pass_window_open:!1,session_key:r},l=new URL(`/window3/${s}`,o);return l.search=ns(a),l.toString()}mountIframe(){let e=rt({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});e.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(e),os("file-selected",e.contentWindow,this.handleFileSelected.bind(this)),this._iframe=e,this.$.selectedList=[]}unmountIframe(){this._iframe&&ss("file-selected",this._iframe.contentWindow),this.ref.iframeWrapper.innerHTML="",this._iframe=null,this.$.selectedList=[],this.$.counter=0}}return i.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <div>
      <lr-icon set="@name: activityIcon"></lr-icon>
      <span>{{activityCaption}}</span>
    </div>
    <button type="button" class="mini-btn close-btn" set="onclick: *historyBack">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <div class="content">
    <div ref="iframeWrapper" class="iframe-wrapper"></div>
    <div class="toolbar">
      <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button>
      <div></div>
      <div set="@hidden: !multiple" class="selected-counter"><span l10n="selected-count"></span>{{counter}}</div>
      <button type="button" class="done-btn primary-btn" set="onclick: onDone; @disabled: !counter">
        <lr-icon name="check"></lr-icon>
      </button>
    </div>
  </div>
`,i})();var Qe=class extends _{setCurrentTab(t){if(!t)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach(r=>{r.getAttribute("tab-ctx")===t?r.removeAttribute("hidden"):r.setAttribute("hidden","")});for(let r in this._tabMap)r===t?this._tabMap[r].setAttribute("current",""):this._tabMap[r].removeAttribute("current")}initCallback(){super.initCallback(),this._tabMap={},this.defineAccessor("tab-list",t=>{if(!t)return;R(t).forEach(r=>{let o=rt({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(r)}}});o.textContent=this.l10n(r),this.ref.row.appendChild(o),this._tabMap[r]=o})}),this.defineAccessor("default",t=>{this.setCurrentTab(t)}),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}};Qe.bindAttributes({"tab-list":null,default:null});Qe.template=`
  <div ref="row" class="tabs-row"></div>
  <div ref="context" class="tabs-context">
    <slot></slot>
  </div>
`;var nr=class extends k{requireCtxName=!0;_createValidationInput(){let t=document.createElement("input");return t.type="text",t.name=this.ctxName,t.required=this.cfg.multipleMin>0,t.tabIndex=-1,hr(t,{opacity:0,height:0,width:0}),t}initCallback(){super.initCallback(),this._validationInputElement=this._createValidationInput(),this.appendChild(this._validationInputElement),this.sub("*collectionState",t=>{{if(this._dynamicInputsContainer||(this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer)),!this._validationInputElement){let s=this._createValidationInput();this.appendChild(s),this._validationInputElement=s}if(this._dynamicInputsContainer.innerHTML="",t.status==="uploading"||t.status==="idle"){this._validationInputElement.value="",this._validationInputElement.setCustomValidity("");return}if(t.status==="failed"){let s=t.errors[0]?.message;this._validationInputElement.value="",this._validationInputElement.setCustomValidity(s);return}let e=t.group?t.group:null;if(e){this._validationInputElement.value=e.cdnUrl,this._validationInputElement.setCustomValidity("");return}let r=t.allEntries.map(s=>s.cdnUrl);if(!this.cfg.multiple&&r.length===1){this._validationInputElement.value=r[0],this._validationInputElement.setCustomValidity("");return}this._validationInputElement.remove(),this._validationInputElement=null;let o=new DocumentFragment;for(let s of r){let n=document.createElement("input");n.type="hidden",n.name=`${this.ctxName}[]`,n.value=s,o.appendChild(n)}this._dynamicInputsContainer.replaceChildren(o)}},!1)}};var ar=class extends v{};var ls=(()=>{class i extends _{init$=g(p({},this.init$),{currentText:"",options:[],selectHtml:"",onSelect:e=>{e.preventDefault(),e.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=this.$.options.find(r=>r.value==this.value)?.text||"",this.dispatchEvent(new Event("change"))}});initCallback(){super.initCallback(),this.sub("options",e=>{this.$.currentText=e?.[0]?.text||"";let r="";e?.forEach(o=>{r+=`<option value="${o.value}">${o.text}</option>`}),this.$.selectHtml=r})}}return i.template=`
  <button>
    {{currentText}}
    <lr-icon name="select"></lr-icon>
    <select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select>
  </button>
`,i})();var G={PLAY:"play",PAUSE:"pause",FS_ON:"fullscreen-on",FS_OFF:"fullscreen-off",VOL_ON:"unmute",VOL_OFF:"mute",CAP_ON:"captions",CAP_OFF:"captions-off"},cs={requestFullscreen:i=>{i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen()},exitFullscreen:()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}},Yr=(()=>{class i extends _{togglePlay(){this._video.paused||this._video.ended?this._video.play():this._video.pause()}toggleFullscreen(){(document.fullscreenElement||document.webkitFullscreenElement)===this?cs.exitFullscreen():cs.requestFullscreen(this)}toggleCaptions(){this.$.capIcon===G.CAP_OFF?(this.$.capIcon=G.CAP_ON,this._video.textTracks[0].mode="showing",window.localStorage.setItem(i.is+":captions","1")):(this.$.capIcon=G.CAP_OFF,this._video.textTracks[0].mode="hidden",window.localStorage.removeItem(i.is+":captions"))}toggleSound(){this.$.volIcon===G.VOL_ON?(this.$.volIcon=G.VOL_OFF,this.$.volumeDisabled=!0,this._video.muted=!0):(this.$.volIcon=G.VOL_ON,this.$.volumeDisabled=!1,this._video.muted=!1)}setVolume(e){window.localStorage.setItem(i.is+":volume",e);let r=e?e/100:0;this._video.volume=r}get progress(){return this.ref.progress}init$=g(p({},this.init$),{src:"",ppIcon:G.PLAY,fsIcon:G.FS_ON,volIcon:G.VOL_ON,capIcon:G.CAP_OFF,totalTime:"00:00",currentTime:"00:00",progressCssWidth:"0",hasSubtitles:!1,volumeDisabled:!1,volumeValue:0,onPP:()=>{this.togglePlay()},onFs:()=>{this.toggleFullscreen()},onCap:()=>{this.toggleCaptions()},onMute:()=>{this.toggleSound()},onVolChange:e=>{let r=parseFloat(e.currentTarget.$.value);this.setVolume(r)},progressClicked:e=>{let r=this.progress.getBoundingClientRect();this._video.currentTime=this._video.duration*(e.offsetX/r.width)}});_getUrl(e){return e.includes("/")?e:`https://ucarecdn.com/${e}/`}_desc2attrs(e){let r=[];for(let o in e){let s=o==="src"?this._getUrl(e[o]):e[o];r.push(`${o}="${s}"`)}return r.join(" ")}_timeFmt(e){let r=new Date(Math.round(e)*1e3);return[r.getMinutes(),r.getSeconds()].map(o=>o<10?"0"+o:o).join(":")}_initTracks(){[...this._video.textTracks].forEach(e=>{e.mode="hidden"}),window.localStorage.getItem(i.is+":captions")&&this.toggleCaptions()}_castAttributes(){let e=["autoplay","loop","muted"];[...this.attributes].forEach(r=>{e.includes(r.name)&&this._video.setAttribute(r.name,r.value)})}initCallback(){super.initCallback(),this._video=this.ref.video,this._castAttributes(),this._video.addEventListener("play",()=>{this.$.ppIcon=G.PAUSE,this.setAttribute("playback","")}),this._video.addEventListener("pause",()=>{this.$.ppIcon=G.PLAY,this.removeAttribute("playback")}),this.addEventListener("fullscreenchange",r=>{console.log(r),document.fullscreenElement===this?this.$.fsIcon=G.FS_OFF:this.$.fsIcon=G.FS_ON}),this.sub("src",r=>{if(!r)return;let o=this._getUrl(r);this._video.src=o}),this.sub("video",r=>b(this,null,function*(){if(!r)return;let o=yield(yield window.fetch(this._getUrl(r))).json();o.poster&&(this._video.poster=this._getUrl(o.poster));let s="";o?.sources.forEach(n=>{s+=`<source ${this._desc2attrs(n)} />`}),o.tracks&&(o.tracks.forEach(n=>{s+=`<track ${this._desc2attrs(n)} />`}),this.$.hasSubtitles=!0),this._video.innerHTML+=s,this._initTracks(),console.log(o)})),this._video.addEventListener("loadedmetadata",r=>{this.$.currentTime=this._timeFmt(this._video.currentTime),this.$.totalTime=this._timeFmt(this._video.duration)}),this._video.addEventListener("timeupdate",r=>{let o=Math.round(100*(this._video.currentTime/this._video.duration));this.$.progressCssWidth=o+"%",this.$.currentTime=this._timeFmt(this._video.currentTime)});let e=window.localStorage.getItem(i.is+":volume");if(e){let r=parseFloat(e);this.setVolume(r),this.$.volumeValue=r}}}return i.template=`
  <div class="video-wrapper">
    <video ref="video" preload="metadata" crossorigin="anonymous"></video>
  </div>

  <div class="toolbar">
    <div class="progress" ref="progress" set -onclick="progressClicked">
      <div class="bar" set -style.width="progressCssWidth"></div>
    </div>

    <div class="tb-block">
      <button set -onclick="onPP">
        <lr-icon set -@name="ppIcon"></lr-icon>
      </button>
      <div class="timer">{{currentTime}} / {{totalTime}}</div>
    </div>

    <div class="tb-block">
      <button set -onclick="onCap" -@hidden="!hasSubtitles">
        <lr-icon set -@name="capIcon"></lr-icon>
      </button>

      <button set -onclick="onMute">
        <lr-icon set -@name="volIcon"></lr-icon>
      </button>

      <lr-range type="range" set -onchange="onVolChange" -@disabled="volumeDisabled" -value="volumeValue"> </lr-range>

      <button set -onclick="onFs">
        <lr-icon set -@name="fsIcon"></lr-icon>
      </button>
    </div>
  </div>
`,i})();Yr.bindAttributes({video:"video",src:"src"});var ds=(()=>{class i extends _{initCallback(){super.initCallback(),this.subConfigValue("removeCopyright",e=>{this.toggleAttribute("hidden",!!e)})}static template=`
    <a
      href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4"
      target="_blank noopener"
      class="credits"
      >Powered by Uploadcare</a
    >
  `}return i})();var Ce=class extends _{requireCtxName=!0;init$=Pt(this);_template=null;static set template(t){this._template=t+"<slot></slot>"}static get template(){return this._template}};var hs=(()=>{class i extends Ce{initCallback(){super.initCallback(),this.sub("*modalActive",e=>{this._lastModalActive!==e&&this.emit(e?$.MODAL_OPEN:$.MODAL_CLOSE,void 0,{debounce:!0}),this._lastModalActive=e},!1)}}return i.template=`
  <lr-simple-btn></lr-simple-btn>

  <lr-modal strokes block-body-scrolling>
    <lr-start-from>
      <lr-drop-area with-icon clickable></lr-drop-area>
      <lr-source-list wrap></lr-source-list>
      <button type="button" l10n="start-from-cancel" class="secondary-btn" set="onclick: *historyBack"></button>
      <lr-copyright></lr-copyright>
    </lr-start-from>
    <lr-upload-list></lr-upload-list>
    <lr-camera-source></lr-camera-source>
    <lr-url-source></lr-url-source>
    <lr-external-source></lr-external-source>
    <lr-cloud-image-editor-activity></lr-cloud-image-editor-activity>
  </lr-modal>

  <lr-progress-bar-common></lr-progress-bar-common>
`,i})();var us=(()=>{class i extends Ce{initCallback(){super.initCallback();let e=this.ref.uBlock;this.sub("*currentActivity",r=>{r||(this.$["*currentActivity"]=e.initActivity||v.activities.START_FROM)}),this.sub("*uploadList",r=>{r?.length>0?this.$["*currentActivity"]=v.activities.UPLOAD_LIST:this.$["*currentActivity"]=e.initActivity||v.activities.START_FROM}),this.subConfigValue("sourceList",r=>{r!=="local"&&(this.cfg.sourceList="local")}),this.subConfigValue("confirmUpload",r=>{r!==!1&&(this.cfg.confirmUpload=!1)})}}return i.template=`
  <lr-start-from>
    <lr-drop-area clickable l10n="choose-file"></lr-drop-area>
    <lr-copyright></lr-copyright>
  </lr-start-from>
  <lr-upload-list ref="uBlock"></lr-upload-list>
`,i})();var ps=(()=>{class i extends Ce{constructor(){super(),this.init$=g(p({},this.init$),{couldCancel:!1,cancel:()=>{this.couldHistoryBack?this.$["*historyBack"]():this.couldShowList&&(this.$["*currentActivity"]=v.activities.UPLOAD_LIST)}})}get couldHistoryBack(){let e=this.$["*history"];return e.length>1&&e[e.length-1]!==v.activities.START_FROM}get couldShowList(){return this.cfg.showEmptyList||this.$["*uploadList"].length>0}initCallback(){super.initCallback();let e=this.ref.uBlock;this.sub("*currentActivity",r=>{r||(this.$["*currentActivity"]=e.initActivity||v.activities.START_FROM)}),this.sub("*uploadList",r=>{r?.length>0&&this.$["*currentActivity"]===(e.initActivity||v.activities.START_FROM)&&(this.$["*currentActivity"]=v.activities.UPLOAD_LIST)}),this.sub("*history",()=>{this.$.couldCancel=this.couldHistoryBack||this.couldShowList})}}return i.template=` <lr-start-from>
    <lr-drop-area with-icon clickable></lr-drop-area>
    <lr-source-list wrap></lr-source-list>
    <button
      type="button"
      l10n="start-from-cancel"
      class="cancel-btn secondary-btn"
      set="onclick: cancel; @hidden: !couldCancel"
    ></button>
    <lr-copyright></lr-copyright>
  </lr-start-from>
  <lr-upload-list ref="uBlock"></lr-upload-list>
  <lr-camera-source></lr-camera-source>
  <lr-url-source></lr-url-source>
  <lr-external-source></lr-external-source>
  <lr-progress-bar></lr-progress-bar>
  <lr-cloud-image-editor-activity></lr-cloud-image-editor-activity>`,i})();var lr=class i extends $e{initCallback(){super.initCallback(),this.__shadowReady=!0,this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}initEditor(){return b(this,null,function*(){this.__shadowReady&&(yield xt(i.prototype,this,"initEditor").call(this))})}};var Jr="LR";function ms(i,t=!1){return b(this,null,function*(){return new Promise((e,r)=>{if(typeof document!="object"){e(null);return}if(typeof window=="object"&&window[Jr]){e(window[Jr]);return}let o=document.createElement("script");o.async=!0,o.src=i,o.onerror=()=>{r()},o.onload=()=>{let s=window[Jr];t&&Ct(s),e(s)},document.head.appendChild(o)})})}export{Ct as a,tl as b};
